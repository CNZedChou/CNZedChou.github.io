<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Solidity Study | ZedChou&#39;s Blog</title>
<link rel="shortcut icon" href="https://CNZedChou.github.io/favicon.ico?v=1676222959031">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://CNZedChou.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="Solidity Study | ZedChou&#39;s Blog - Atom Feed" href="https://CNZedChou.github.io/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="@Description:   ç”¨äºè®°å½•WTF-Solidity å­¦ä¹ è¿‡ç¨‹
@Author:    Zed Chou
@LastModified:    Tue 15 Nov 2022

Solidity Study
Solidityæ˜¯ä»¥å¤ª..." />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://CNZedChou.github.io">
  <img class="avatar" src="https://CNZedChou.github.io/images/avatar.png?v=1676222959031" alt="">
  </a>
  <h1 class="site-title">
    ZedChou&#39;s Blog
  </h1>
  <p class="site-description">
    æ¸©æ•…è€ŒçŸ¥æ–°
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              Solidity Study
            </h2>
            <div class="post-info">
              <span>
                2022-11-08
              </span>
              <span>
                93 min read
              </span>
              
            </div>
            
            <div class="post-content-wrapper">
              <div class="post-content" v-pre>
                <p>@Description:   ç”¨äºè®°å½•WTF-Solidity å­¦ä¹ è¿‡ç¨‹<br>
@Author:    Zed Chou<br>
@LastModified:    Tue 15 Nov 2022</p>
<!-- more -->
<h1 id="solidity-study">Solidity Study</h1>
<p><code>Solidity</code>æ˜¯ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆ<code>EVM</code>ï¼‰æ™ºèƒ½åˆçº¦çš„è¯­è¨€ã€‚åŒæ—¶ï¼Œæˆ‘è®¤ä¸º<code>solidity</code>æ˜¯ç©é“¾ä¸Šé¡¹ç›®å¿…å¤‡çš„æŠ€èƒ½ï¼šåŒºå—é“¾é¡¹ç›®å¤§éƒ¨åˆ†æ˜¯å¼€æºçš„ï¼Œå¦‚æœä½ èƒ½è¯»æ‡‚ä»£ç ï¼Œå°±å¯ä»¥è§„é¿å¾ˆå¤šäºé’±é¡¹ç›®ã€‚</p>
<p><code>Solidity</code>å…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>åŸºäºå¯¹è±¡ï¼šå­¦ä¼šä¹‹åï¼Œèƒ½å¸®ä½ æŒ£é’±æ‰¾å¯¹è±¡ã€‚</li>
<li>é«˜çº§ï¼šä¸ä¼š<code>solidity</code>ï¼Œåœ¨å¸åœˆæ˜¾å¾—å¾ˆlowã€‚</li>
</ol>
<h2 id="solidity-å·¥å…·">Solidity å·¥å…·</h2>
<h3 id="remix">Remix</h3>
<p>å®˜ç½‘ï¼šã€<a href="https://remix.ethereum.org/">remix.ethereum.org</a>ã€‘</p>
<h4 id="1-æ‰“å¼€remix">1. æ‰“å¼€remix</h4>
<figure data-type="image" tabindex="1"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108160622311.png" alt="remixé¢æ¿" loading="lazy"></figure>
<p>æ‰“å¼€å®˜ç½‘è¿›å…¥<code>Remix</code>ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Remixç”±å››ä¸ªé¢æ¿ç»„æˆï¼š</p>
<ol>
<li>å›¾æ ‡é¢æ¿ï¼šä¸Šé¢æœ‰ä»£è¡¨ä¸åŒåŠŸèƒ½çš„å›¾æ ‡ï¼Œç‚¹å‡»åï¼Œç›¸åº”çš„åŠŸèƒ½ä¸ªä¼šæ˜¾ç¤ºåœ¨ä¾§é¢ç‰ˆä¸Šã€‚</li>
<li>ä¾§é¢ç‰ˆï¼šå„ç§åŠŸèƒ½çš„ <code>GUI</code>ã€‚</li>
<li>ä¸»é¢æ¿ï¼šä»£ç ç¼–è¾‘å™¨ã€‚</li>
<li>ç»ˆç«¯ï¼šå°†æ˜¾ç¤ºä¸ <code>GUI</code> äº¤äº’çš„ç»“æœï¼Œä¹Ÿå¯ä»¥åœ¨æ­¤å¤„è¿è¡Œè„šæœ¬ã€‚</li>
</ol>
<h4 id="2-å›¾æ ‡é¢æ¿">2. å›¾æ ‡é¢æ¿</h4>
<p>å›¾æ ‡é¢æ¿é»˜è®¤æœ‰4ä¸ªå›¾æ ‡ï¼Œå…¶ä¸­<code>æ–‡ä»¶</code>ï¼Œ<code>ç¼–è¯‘</code>ï¼Œ<code>éƒ¨ç½²</code>æ˜¯æœ€å¸¸ç”¨çš„ã€‚åœ¨ä½ æ·»åŠ æ›´å¤šçš„<code>remix</code>æ’ä»¶åï¼Œå®ƒä»¬ä¹Ÿä¼šæ˜¾ç¤ºåœ¨å›¾æ ‡é¢æ¿ä¸Šã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108160935992.png" alt="å›¾æ ‡é¢æ¿" loading="lazy"></figure>
<h4 id="3-éƒ¨ç½²ç®€å•åˆçº¦">3. éƒ¨ç½²ç®€å•åˆçº¦</h4>
<p>åœ¨<code>contract</code>æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæœ‰ä¸‰ä¸ª<code>remix</code>è‡ªå¸¦çš„åˆçº¦ä¾‹å­ï¼Œåˆ†åˆ«æ˜¯<code>1_Storage.sol</code>, <code>2_Owner.sol</code>å’Œ<code>3_Ballot.sol</code>ã€‚</p>
<p>ç‚¹å‡»<code>1_Storage.sol</code>ï¼Œä»£ç ä¼šæ˜¾ç¤ºåœ¨ä¸»é¢æ¿çš„ä»£ç ç¼–è¾‘å™¨ä¸Šã€‚è¿™ä¸ªåˆçº¦éå¸¸ç®€å•ï¼šå®ƒä¸€ä¸ªçŠ¶æ€å˜é‡<code>number</code>ï¼Œåœ¨é“¾ä¸Šå­˜å‚¨ä¸€ä¸ª<code>uint256</code>ç±»å‹çš„æ•°å­—ï¼›å®ƒæœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œ<code>store()</code>å‡½æ•°å°†ä¸€ä¸ªæ•°å­—èµ‹å€¼ç»™<code>number</code>å˜é‡ï¼›<code>retrieve()</code>å±•ç¤º<code>number</code>å˜é‡çš„æ•°å€¼ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œç‚¹å‡»<code>ç¼–è¯‘</code>å›¾æ ‡ï¼Œè¿›å…¥<code>Solidity Compiler</code>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©<code>Solidity 0.8.7</code>ç‰ˆæœ¬ï¼Œç„¶åç‚¹å‡»<code>Compile 1_Storage.sol</code>æŒ‰é’®è¿›è¡Œç¼–è¯‘ã€‚åœ¨åˆçº¦æˆåŠŸç¼–è¯‘åï¼Œ<code>ç¼–è¯‘</code>å›¾æ ‡ä¸Šä¼šæ˜¾ç¤ºç»¿è‰²å¯¹å‹¾ã€‚</p>
<h5 id="ç¼–è¯‘">ç¼–è¯‘</h5>
<figure data-type="image" tabindex="3"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108162510379.png" alt="ç®€å•ç¼–è¯‘" loading="lazy"></figure>
<p>ä½ ä¹Ÿå¯ä»¥å°è¯•åœ¨ä¼˜åŒ–ä¸­é€‰åœ¨ä¼˜åŒ–ï¼ˆ<code>Enable Optimization</code>ï¼‰ï¼Œæ¬¡æ•°è®¾ç½®ä¸º<code>200</code>ï¼Œæœ‰æ—¶ä¼šçœ<code>gas</code>æ¶ˆè€—ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108162622972.png" alt="ç¼–è¯‘æˆåŠŸ" loading="lazy"></figure>
<h5 id="éƒ¨ç½²"><strong>éƒ¨ç½²</strong></h5>
<p>åœ¨<code>ENVIRONMENT</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æˆ‘ä»¬éƒ¨ç½²çš„ç¯å¢ƒï¼Œé»˜è®¤çš„æ˜¯<code>JavaScript VM</code>ï¼Œæ‰€æœ‰äº¤æ˜“éƒ½åœ¨æœ¬åœ°æµè§ˆå™¨çš„æ²™ç›’åŒºå—é“¾ä¸­æ‰§è¡Œï¼Œä½¿ç”¨çš„æ˜¯å®ƒç»™ä½ çš„è™šæ‹Ÿé’±åŒ…åœ°å€ï¼›ä½ ä¹Ÿå¯ä»¥é€‰æ‹©<code>Injected Web3</code>ï¼Œå³è¿æ¥ä½ çš„<code>metamask</code>é’±åŒ…ï¼Œæ‰€æœ‰äº¤æ˜“ä¼šåœ¨çœŸå®çš„åŒºå—é“¾ä¸­æ‰§è¡Œã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©<code>JavaScript VM</code>ï¼Œä½ å¯ä»¥åœ¨é’±åŒ…åœ°å€ï¼ˆ<code>ACCOUNT</code>ï¼‰æ çœ‹åˆ°è™šæ‹Ÿæœºç»™ä½ åˆ†é…çš„æµ‹è¯•åœ°å€ã€‚ä¸éœ€è¦è°ƒæ•´<code>Gas</code>ï¼Œä¹Ÿä¸ç”¨å¾€åˆçº¦é‡Œå‘é€<code>ETH</code>ã€‚åœ¨<code>CONTRACT</code>æ ä¸­é€‰æ‹©ä½ è¦éƒ¨ç½²çš„åˆçº¦<code>Storage</code>ã€‚<code>1_Storage.sol</code>æ–‡ä»¶ä¸­åªæœ‰ä¸€ä¸ªåˆçº¦ï¼Œå› æ­¤é»˜è®¤å°±æ˜¯éƒ¨ç½²å®ƒï¼›ä½†å½“æ–‡ä»¶åŒ…å«å¤šä¸ªåˆçº¦æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é€‰æ‹©è¦éƒ¨ç½²çš„åˆçº¦ã€‚</p>
<p>ç‚¹å‡»<code>DEPLOY</code>é”®ï¼Œéƒ¨ç½²å®Œæ¯•ï¼</p>
<p><strong>æ³¨æ„ï¼šå¦‚æœæˆ‘ä»¬é€‰æ‹©çš„æ˜¯<code>Injected Web3</code>æ¥éƒ¨ç½²åˆçº¦ï¼Œæ¯ä¸€ç¬”äº¤æ˜“éƒ½å°†ä¸Šé“¾ï¼Œéœ€è¦é’±åŒ…ç¡®è®¤äº¤æ˜“å¹¶æ”¯ä»˜<code>gas</code>ã€‚</strong></p>
<figure data-type="image" tabindex="5"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108162904584.png" alt="éƒ¨ç½²ç•Œé¢" loading="lazy"></figure>
<h5 id="è°ƒç”¨">è°ƒç”¨</h5>
<p>åœ¨åˆçº¦éƒ¨ç½²æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Deployed Contracts</code>ä¸­æ‰¾åˆ°æˆ‘ä»¬éƒ¨ç½²çš„åˆçº¦<code>Storage</code>ã€‚å±•å¼€å®ƒï¼Œæˆ‘ä»¬çœ‹åˆ°åˆçº¦ä¸­çš„å¤–éƒ¨å‡½æ•°ï¼š<code>store</code>å’Œ<code>retrieve</code>ã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108163219213.png" alt="å·²éƒ¨ç½²çš„åˆçº¦" loading="lazy"></figure>
<p>æˆ‘ä»¬åœ¨<code>store</code>å‡½æ•°é‚£è¡Œçš„æ–‡æœ¬æ¡†ä¸­è¾“å…¥<code>100</code>ï¼Œå¹¶ç‚¹å‡»å‡½æ•°åè°ƒç”¨å®ƒã€‚è°ƒç”¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸Šçœ‹åˆ°<code>log</code>ä¿¡æ¯ï¼Œç‚¹å‡»<code>Debug</code>æŒ‰é’®å¯ä»¥æŸ¥çœ‹äº¤æ˜“è¯¦æƒ…ã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108163435894.png" alt="äº¤æ˜“è¯¦æƒ…" loading="lazy"></figure>
<p>ä¹‹åï¼Œæˆ‘ä»¬è°ƒç”¨<code>retrieve</code>å‡½æ•°ï¼Œæ˜¾ç¤º<code>number</code>å˜é‡è¢«æˆåŠŸæ›´æ–°ä¸º<code>100</code>ã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108163517416.png" alt="è°ƒç”¨retrieve" loading="lazy"></figure>
<h2 id="solidity-å…¥é—¨">Solidity å…¥é—¨</h2>
<p><a href="https://wtf.academy/solidity-start/">Solidity å…¥é—¨</a></p>
<h3 id="1-helloweb3">1. HelloWeb3</h3>
<p><a href="https://wtf.academy/solidity-start/HelloWeb3">HelloWeb3</a></p>
<h4 id="ç¬¬ä¸€ä¸ªsolidityç¨‹åº">ç¬¬ä¸€ä¸ªsolidityç¨‹åº</h4>
<p>å¾ˆç®€å•ï¼Œåªæœ‰1è¡Œæ³¨é‡Š+3è¡Œä»£ç ï¼š</p>
<pre><code class="language-solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
contract HelloWeb3{
    string public _string = &quot;Hello Web3!&quot;;
}
</code></pre>
<p>æˆ‘ä»¬æ‹†å¼€åˆ†æï¼Œå­¦ä¹ solidityä»£ç æºæ–‡ä»¶çš„ç»“æ„ï¼š</p>
<ol>
<li>ç¬¬1è¡Œæ˜¯æ³¨é‡Šï¼Œä¼šå†™ä¸€ä¸‹è¿™ä¸ªä»£ç æ‰€ç”¨çš„è½¯ä»¶è®¸å¯ï¼ˆlicenseï¼‰ï¼Œè¿™é‡Œç”¨çš„æ˜¯MIT licenseã€‚å¦‚æœä¸å†™è®¸å¯ï¼Œç¼–è¯‘æ—¶ä¼šè­¦å‘Šï¼ˆwarningï¼‰ï¼Œä½†ç¨‹åºå¯ä»¥è¿è¡Œã€‚solidityçš„æ³¨é‡Šç”±â€œ//â€å¼€å¤´ï¼Œåé¢è·Ÿæ³¨é‡Šçš„å†…å®¹ï¼ˆä¸ä¼šè¢«ç¨‹åºè¿è¡Œï¼‰ã€‚</li>
</ol>
<pre><code class="language-solidity">// SPDX-License-Identifier: MIT
</code></pre>
<ol start="2">
<li>ç¬¬2è¡Œå£°æ˜æºæ–‡ä»¶æ‰€ç”¨çš„solidityç‰ˆæœ¬ï¼Œå› ä¸ºä¸åŒç‰ˆæœ¬è¯­æ³•æœ‰å·®åˆ«ã€‚è¿™è¡Œä»£ç æ„æ€æ˜¯æºæ–‡ä»¶å°†ä¸å…è®¸å°äº 0.8.4 ç‰ˆæœ¬æˆ–å¤§äºç­‰äº 0.9.0 ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ç¼–è¯‘ï¼ˆç¬¬äºŒä¸ªæ¡ä»¶ç”±<code>^</code>æä¾›ï¼‰ã€‚Solidity è¯­å¥ä»¥åˆ†å·ï¼ˆ;ï¼‰ç»“å°¾ã€‚</li>
</ol>
<pre><code class="language-solidity">pragma solidity ^0.8.4;
</code></pre>
<ol start="3">
<li>ç¬¬3-4è¡Œæ˜¯åˆçº¦éƒ¨åˆ†ï¼Œç¬¬3è¡Œåˆ›å»ºåˆçº¦ï¼ˆcontractï¼‰ï¼Œå¹¶å£°æ˜åˆçº¦çš„åå­— HelloWeb3ã€‚ç¬¬4è¡Œæ˜¯åˆçº¦çš„å†…å®¹ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªstringï¼ˆå­—ç¬¦ä¸²ï¼‰å˜é‡_stringï¼Œå¹¶ç»™ä»–èµ‹å€¼ â€œHello Web3!â€ã€‚</li>
</ol>
<pre><code class="language-solidity">contract HelloWeb3{
    string public _string = &quot;Hello Web3!&quot;;
}
</code></pre>
<p>ä»¥åæˆ‘ä»¬ä¼šæ›´ç»†çš„ä»‹ç»solidityä¸­çš„å˜é‡ã€‚</p>
<h4 id="ç¼–è¯‘å¹¶éƒ¨ç½²ä»£ç ">ç¼–è¯‘å¹¶éƒ¨ç½²ä»£ç </h4>
<p>åœ¨ç¼–è¾‘ä»£ç çš„é¡µé¢ï¼ŒæŒ‰ctrl+Så°±å¯ä»¥ç¼–è¯‘ä»£ç ï¼Œéå¸¸æ–¹ä¾¿ã€‚ç¼–è¯‘å¥½ä¹‹åï¼Œç‚¹å‡»å·¦ä¾§èœå•çš„â€œéƒ¨ç½²â€æŒ‰é’®ï¼Œè¿›å…¥éƒ¨ç½²é¡µé¢ã€‚</p>
<figure data-type="image" tabindex="9"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108164138102.png" alt="ç¼–è¯‘é€šè¿‡" loading="lazy"></figure>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œremixä¼šç”¨JSè™šæ‹Ÿæœºæ¥æ¨¡æ‹Ÿä»¥å¤ªåŠé“¾ï¼Œè¿è¡Œæ™ºèƒ½åˆçº¦ï¼Œç±»ä¼¼åœ¨æµè§ˆå™¨é‡Œè·‘ä¸€æ¡æµ‹è¯•é“¾ã€‚å¹¶ä¸”remixä¼šåˆ†é…å‡ ä¸ªæµ‹è¯•è´¦æˆ·ç»™ä½ ï¼Œæ¯ä¸ªé‡Œé¢æœ‰100 ETHï¼ˆæµ‹è¯•ä»£å¸ï¼‰ï¼Œå¯åŠ²å„¿ç”¨ã€‚ä½ ç‚¹Deployï¼ˆé»„è‰²æŒ‰é’®ï¼‰ï¼Œå°±å¯ä»¥éƒ¨ç½²å’±ä»¬å†™å¥½çš„åˆçº¦äº†ã€‚</p>
<p>éƒ¨ç½²æˆåŠŸåï¼Œä½ ä¼šåœ¨ä¸‹é¢çœ‹åˆ°åä¸º<code>HelloWeb3</code>çš„åˆçº¦ï¼Œç‚¹å‡»<code>_string</code>ï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä»£ç ä¸­å†™çš„ â€œHello Web3!â€ äº†ã€‚</p>
<figure data-type="image" tabindex="10"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108164255236.png" alt="è°ƒç”¨æ™ºèƒ½åˆçº¦" loading="lazy"></figure>
<h3 id="2-æ•°å€¼ç±»å‹">2. æ•°å€¼ç±»å‹</h3>
<p><a href="https://wtf.academy/solidity-start/ValueTypes/">æ•°å€¼ç±»å‹</a></p>
<h4 id="solidity-ä¸­çš„å˜é‡ç±»å‹">solidity ä¸­çš„å˜é‡ç±»å‹</h4>
<ol>
<li><strong>æ•°å€¼ç±»å‹(Value Type)</strong>ï¼šåŒ…æ‹¬å¸ƒå°”å‹ï¼Œæ•´æ•°å‹ç­‰ç­‰ï¼Œè¿™ç±»å˜é‡èµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’æ•°å€¼ã€‚</li>
<li><strong>å¼•ç”¨ç±»å‹(Reference Type)</strong>ï¼šåŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚</li>
<li><strong>æ˜ å°„ç±»å‹(Mapping Type)</strong>ï¼š <code>Solidity</code>é‡Œçš„å“ˆå¸Œè¡¨ã€‚</li>
<li><strong>å‡½æ•°ç±»å‹(Function Type)</strong>ï¼š<code>Solidity</code>æ–‡æ¡£é‡ŒæŠŠå‡½æ•°å½’åˆ°æ•°å€¼ç±»å‹ï¼Œä½†æˆ‘è§‰å¾—ä»–è·Ÿå…¶ä»–ç±»å‹å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥å•ç‹¬åˆ†ä¸€ç±»ã€‚</li>
</ol>
<p>æˆ‘ä»¬åªä»‹ç»ä¸€äº›å¸¸ç”¨çš„ç±»å‹ï¼Œä¸å¸¸ç”¨çš„ä¸è®²ã€‚è¿™ç¯‡ä»‹ç»æ•°å€¼ç±»å‹ï¼Œç¬¬3è®²ä»‹ç»å‡½æ•°ç±»å‹ï¼Œç¬¬4è®²ä»‹ç»å¼•ç”¨å’Œæ˜ å°„ã€‚</p>
<h4 id="1-æ•°å€¼ç±»å‹value-type">1. æ•°å€¼ç±»å‹Value type</h4>
<h5 id="1-å¸ƒå°”å‹">1. å¸ƒå°”å‹</h5>
<p>å¸ƒå°”å‹æ˜¯äºŒå€¼å˜é‡ï¼Œå–å€¼ä¸º<code>true</code>æˆ–<code>false</code>ã€‚</p>
<pre><code class="language-solidity">// å¸ƒå°”å€¼
bool public _bool = true;
</code></pre>
<p>å¸ƒå°”å€¼çš„è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>! ï¼ˆé€»è¾‘éï¼‰</li>
<li>&amp;&amp; ï¼ˆé€»è¾‘ä¸ï¼Œ &quot;and&quot; ï¼‰</li>
<li>|| ï¼ˆé€»è¾‘æˆ–ï¼Œ &quot;or&quot; ï¼‰</li>
<li>== ï¼ˆç­‰äºï¼‰</li>
<li>!= ï¼ˆä¸ç­‰äºï¼‰</li>
</ul>
<p>ä»£ç ï¼š</p>
<pre><code class="language-solidity">// å¸ƒå°”è¿ç®—
bool public _bool1 = !_bool; //å–é ï¼ˆfalseï¼‰
bool public _bool2 = _bool &amp;&amp; _bool1; //ä¸ ï¼ˆfalseï¼‰
bool public _bool3 = _bool || _bool1; //æˆ– ï¼ˆtrueï¼‰
bool public _bool4 = _bool == _bool1; //ç›¸ç­‰ ï¼ˆfalseï¼‰
bool public _bool5 = _bool != _bool1; //ä¸ç›¸ç­‰ ï¼ˆtrueï¼‰
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼šå˜é‡<code>_bool</code>çš„å–å€¼æ˜¯<code>true</code>ï¼›<code>_bool1</code>æ˜¯<code>_bool</code>çš„éï¼Œä¸º<code>false</code>ï¼›<code>_bool &amp;&amp; _bool1</code>ä¸º<code>false</code>ï¼›<code>_bool || _bool1</code>ä¸º<code>true</code>ï¼›<code>_bool == _bool1</code>ä¸º<code>false</code>ï¼›<code>_bool != _bool1</code>ä¸º<code>true</code>ã€‚</p>
<p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</strong><code>&amp;&amp;</code> å’Œ <code>||</code>è¿ç®—ç¬¦éµå¾ªçŸ­è·¯è§„åˆ™ï¼Œè¿™æ„å‘³ç€ï¼Œå‡å¦‚å­˜åœ¨<code>f(x) || g(y)</code>çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ<code>f(x)</code>æ˜¯<code>true</code>ï¼Œ<code>g(y)</code>ä¸ä¼šè¢«è®¡ç®—ï¼Œå³ä½¿å®ƒå’Œ<code>f(x)</code>çš„ç»“æœæ˜¯ç›¸åçš„</p>
<h5 id="2-æ•´å‹">2. æ•´å‹</h5>
<p>æ•´å‹æ˜¯<code>solidity</code>ä¸­çš„æ•´æ•°ï¼Œæœ€å¸¸ç”¨çš„åŒ…æ‹¬</p>
<pre><code class="language-solidity">// æ•´å‹
int public _int = -1; // æ•´æ•°ï¼ŒåŒ…æ‹¬è´Ÿæ•°
uint public _uint = 1; // æ­£æ•´æ•°
uint256 public _number = 20220330; // 256ä½æ­£æ•´æ•°
</code></pre>
<p>å¸¸ç”¨çš„æ•´å‹è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰ï¼š <code>&lt;=</code>ï¼Œ <code>&lt;</code>ï¼Œ <code>==</code>ï¼Œ <code>!=</code>ï¼Œ <code>&gt;=</code>ï¼Œ <code>&gt;</code></li>
<li>ç®—æ•°è¿ç®—ç¬¦ï¼š <code>+</code>ï¼Œ <code>-</code>ï¼Œ ä¸€å…ƒè¿ç®— <code>-</code>ï¼Œ <code>+</code>ï¼Œ <code>*</code>ï¼Œ <code>/</code>ï¼Œ <code>%</code>ï¼ˆå–ä½™ï¼‰ï¼Œ<code>**</code>ï¼ˆå¹‚ï¼‰</li>
</ul>
<p>ä»£ç ï¼š</p>
<pre><code class="language-solidity">// æ•´æ•°è¿ç®—
uint256 public _number1 = _number + 1; // +ï¼Œ-ï¼Œ*ï¼Œ/
uint256 public _number2 = 2**2; // æŒ‡æ•°
uint256 public _number3 = 7 % 2; // å–ä½™æ•°
bool public _numberbool = _number2 &gt; _number3; // æ¯”å¤§å°
</code></pre>
<p>å¤§å®¶å¯ä»¥è·‘ä¸€ä¸‹ä»£ç ï¼Œçœ‹çœ‹è¿™4ä¸ªå˜é‡åˆ†åˆ«æ˜¯å¤šå°‘ã€‚ç­”å¯¹å¥–åŠ±ä¸ª<code>POAP</code>ï¼Ÿ</p>
<h5 id="3-åœ°å€ç±»å‹">3. åœ°å€ç±»å‹</h5>
<p>åœ°å€ç±»å‹(address)å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚åœ°å€ç±»å‹ä¹Ÿæœ‰æˆå‘˜å˜é‡ï¼Œå¹¶ä½œä¸ºæ‰€æœ‰åˆçº¦çš„åŸºç¡€ã€‚æœ‰æ™®é€šçš„åœ°å€å’Œå¯ä»¥è½¬è´¦<code>ETH</code>çš„åœ°å€ï¼ˆ<code>payable</code>ï¼‰ã€‚<code>payable</code>çš„åœ°å€æ‹¥æœ‰<code>balance</code>å’Œ<code>transfer()</code>ä¸¤ä¸ªæˆå‘˜ï¼Œæ–¹ä¾¿æŸ¥è¯¢<code>ETH</code>ä½™é¢ä»¥åŠè½¬è´¦ã€‚</p>
<p>ä»£ç </p>
<pre><code class="language-solidity">// åœ°å€
address public _address = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
address payable public _address1 = payable(_address); // payable addressï¼Œå¯ä»¥è½¬è´¦ã€æŸ¥ä½™é¢
// åœ°å€ç±»å‹çš„æˆå‘˜
uint256 public balance = _address1.balance; // balance of address
</code></pre>
<p>ä¸‹ä¸€è®²ä»‹ç»å‡½æ•°çš„æ—¶å€™ï¼Œä¼šä»‹ç»å¦‚ä½•ä½¿ç”¨åœ°å€ç±»å‹ã€‚</p>
<h5 id="4-å®šé•¿å­—èŠ‚æ•°ç»„">4. å®šé•¿å­—èŠ‚æ•°ç»„</h5>
<p>å­—èŠ‚æ•°ç»„<code>bytes</code>åˆ†ä¸¤ç§ï¼Œä¸€ç§å®šé•¿ï¼ˆ<code>byte</code>, <code>bytes8</code>, <code>bytes32</code>ï¼‰ï¼Œå¦ä¸€ç§ä¸å®šé•¿ã€‚å®šé•¿çš„å±äºæ•°å€¼ç±»å‹ï¼Œä¸å®šé•¿çš„æ˜¯å¼•ç”¨ç±»å‹ï¼ˆä¹‹åè®²ï¼‰ã€‚ å®šé•¿<code>bytes</code>å¯ä»¥å­˜ä¸€äº›æ•°æ®ï¼Œæ¶ˆè€—<code>gas</code>æ¯”è¾ƒå°‘ã€‚</p>
<p>ä»£ç ï¼š</p>
<pre><code class="language-solidity">// å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„
bytes32 public _byte32 = &quot;MiniSolidity&quot;; 
bytes1 public _byte = _byte32[0]; 
</code></pre>
<pre><code>MiniSolidity`å˜é‡ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨è¿›å˜é‡`_byte32`ï¼Œè½¬æ¢æˆ`16è¿›åˆ¶`ä¸ºï¼š`0x4d696e69536f6c69646974790000000000000000000000000000000000000000
</code></pre>
<p><code>_byte</code>å˜é‡å­˜å‚¨<code>_byte32</code>çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œä¸º<code>0x4d</code>ã€‚</p>
<h5 id="5-æšä¸¾-enum">5. æšä¸¾ enum</h5>
<p>æšä¸¾ï¼ˆ<code>enum</code>ï¼‰æ˜¯<code>solidity</code>ä¸­ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸»è¦ç”¨äºä¸º<code>uint</code>åˆ†é…åç§°ï¼Œä½¿ç¨‹åºæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚å®ƒä¸<code>Cè¯­è¨€</code>ä¸­çš„<code>enum</code>ç±»ä¼¼ï¼Œä½¿ç”¨åç§°æ¥ä»£æ›¿ä»<code>0</code>å¼€å§‹çš„<code>uint</code>ï¼š</p>
<pre><code class="language-solidity">// ç”¨enumå°†uint 0ï¼Œ 1ï¼Œ 2è¡¨ç¤ºä¸ºBuy, Hold, Sell
enum ActionSet { Buy, Hold, Sell }
// åˆ›å»ºenumå˜é‡ action
ActionSet action = ActionSet.Buy;
</code></pre>
<p>å®ƒå¯ä»¥æ˜¾å¼çš„å’Œ<code>uint</code>ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¼šæ£€æŸ¥è½¬æ¢çš„æ­£æ•´æ•°æ˜¯å¦åœ¨æšä¸¾çš„é•¿åº¦å†…ï¼Œä¸ç„¶ä¼šæŠ¥é”™ï¼š</p>
<pre><code class="language-solidity">// enumå¯ä»¥å’Œuintæ˜¾å¼çš„è½¬æ¢
function enumToUint() external view returns(uint){
return uint(action);
}
</code></pre>
<p><code>enum</code>çš„ä¸€ä¸ªæ¯”è¾ƒå†·é—¨çš„å˜é‡ï¼Œå‡ ä¹æ²¡ä»€ä¹ˆäººç”¨ã€‚</p>
<h5 id="åœ¨remixä¸ŠéªŒè¯">åœ¨remixä¸ŠéªŒè¯</h5>
<p>éƒ¨ç½²åˆçº¦åå¯ä»¥æŸ¥çœ‹æ¯ä¸ªç±»å‹çš„å˜é‡å…·ä½“çš„æ•°å€¼</p>
<figure data-type="image" tabindex="11"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108170612062.png" alt="éªŒè¯value typesçš„å†…å®¹" loading="lazy"></figure>
<h4 id="æ€»ç»“">æ€»ç»“</h4>
<p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†<code>solidity</code>ä¸­4ç§å˜é‡ç±»å‹ï¼Œå¹¶è¯¦ç»†ä»‹ç»äº†æ•°å€¼å˜é‡ï¼ˆ<code>value type</code>)ä¸­çš„å¸ƒå°”å‹ï¼Œæ•´å‹ï¼Œåœ°å€ï¼Œå®šé•¿å­—èŠ‚æ•°ç»„å’Œæšä¸¾ã€‚ä¹‹åæˆ‘ä»¬ä¼šä»‹ç»å…¶ä»–å‡ ç§ç±»å‹ã€‚</p>
<h3 id="3-å‡½æ•°ç±»å‹">3. å‡½æ•°ç±»å‹</h3>
<p><a href="https://wtf.academy/solidity-start/Function/">å‡½æ•°ç±»å‹</a></p>
<h4 id="solidityä¸­çš„å‡½æ•°">Solidityä¸­çš„å‡½æ•°</h4>
<p>solidityå®˜æ–¹æ–‡æ¡£é‡ŒæŠŠå‡½æ•°å½’åˆ°æ•°å€¼ç±»å‹ï¼Œä½†æˆ‘è§‰å¾—å·®åˆ«å¾ˆå¤§ï¼Œæ‰€ä»¥å•ç‹¬åˆ†ä¸€ç±»ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹solidityä¸­å‡½æ•°çš„å½¢å¼ï¼š</p>
<pre><code class="language-solidity">function &lt;function name&gt; (&lt;parameter types&gt;) {internal|external|public|private} [pure|view|payable] [returns (&lt;return types&gt;)]
</code></pre>
<p>ä»å‰å¾€åï¼ˆæ–¹æ‹¬å·ä¸­çš„æ˜¯å¯å†™å¯ä¸å†™çš„å…³é”®å­—ï¼‰ï¼š</p>
<ol>
<li><code>function</code>ï¼š<strong>å£°æ˜å‡½æ•°æ—¶çš„å›ºå®šç”¨æ³•</strong>ï¼Œæƒ³å†™å‡½æ•°ï¼Œå°±è¦ä»¥functionå…³é”®å­—å¼€å¤´ã€‚</li>
<li><code>&lt;function name&gt;</code>ï¼šå‡½æ•°åã€‚</li>
<li><code>(&lt;parameter types&gt;)</code>ï¼šåœ†æ‹¬å·é‡Œå†™å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¦è¾“å…¥åˆ°å‡½æ•°çš„å˜é‡ç±»å‹å’Œåå­—ã€‚</li>
<li><code>{internal|external|public|private}</code>ï¼šå‡½æ•°å¯<strong>è§æ€§è¯´æ˜ç¬¦</strong>ï¼Œä¸€å…±4ç§ã€‚<strong>æ²¡æ ‡æ˜å‡½æ•°ç±»å‹çš„ï¼Œé»˜è®¤</strong><code>internal</code>ã€‚
<ul>
<li><code>public</code>: å†…éƒ¨å¤–éƒ¨å‡å¯è§ã€‚(ä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼Œ<strong>publicå˜é‡ä¼šè‡ªåŠ¨ç”Ÿæˆ <code>getter</code>å‡½æ•°</strong>ï¼Œç”¨äºæŸ¥è¯¢æ•°å€¼).</li>
<li><code>private</code>: åªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿä¸èƒ½ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚</li>
<li><code>external</code>: åªèƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ï¼ˆä½†æ˜¯å¯ä»¥ç”¨<code>this.f()</code>æ¥è°ƒç”¨ï¼Œ<code>f</code>æ˜¯å‡½æ•°åï¼‰</li>
<li><code>internal</code>: åªèƒ½ä»åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦å¯ä»¥ç”¨ï¼ˆä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡ï¼‰ã€‚</li>
</ul>
</li>
<li><code>[pure|view|payable]</code>ï¼šå†³å®šå‡½æ•°<strong>æƒé™/åŠŸèƒ½</strong>çš„å…³é”®å­—ã€‚<code>payable</code>ï¼ˆå¯æ”¯ä»˜çš„ï¼‰å¾ˆå¥½ç†è§£ï¼Œå¸¦ç€å®ƒçš„å‡½æ•°ï¼Œè¿è¡Œçš„æ—¶å€™å¯ä»¥ç»™åˆçº¦è½¬å…¥<code>ETH</code>ã€‚<code>pure</code>å’Œ<code>view</code>çš„ä»‹ç»è§ä¸‹ä¸€èŠ‚ã€‚</li>
<li><code>[returns ()]</code>ï¼šå‡½æ•°è¿”å›çš„å˜é‡ç±»å‹å’Œåç§°ã€‚</li>
</ol>
<p><code>solidity</code>åŠ å…¥è¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œæˆ‘è®¤ä¸ºæ˜¯å› ä¸º<code>gas fee</code>ã€‚åˆçº¦çš„çŠ¶æ€å˜é‡å­˜å‚¨åœ¨é“¾ä¸Šï¼Œ<code>gas fee</code>å¾ˆè´µï¼Œå¦‚æœä¸æ”¹å˜é“¾ä¸ŠçŠ¶æ€ï¼Œå°±ä¸ç”¨ä»˜<code>gas</code>ã€‚åŒ…å«<code>pure</code>è·Ÿ<code>view</code>å…³é”®å­—çš„å‡½æ•°æ˜¯ä¸æ”¹å†™é“¾ä¸ŠçŠ¶æ€çš„ï¼Œå› æ­¤ç”¨æˆ·ç›´æ¥è°ƒç”¨ä»–ä»¬æ˜¯ä¸éœ€è¦ä»˜gasçš„ï¼ˆåˆçº¦ä¸­é<code>pure</code>/<code>view</code>å‡½æ•°è°ƒç”¨å®ƒä»¬åˆ™ä¼šæ”¹å†™é“¾ä¸ŠçŠ¶æ€ï¼Œéœ€è¦ä»˜gasï¼‰ã€‚</p>
<p>åœ¨ä»¥å¤ªåŠä¸­ï¼Œä»¥ä¸‹è¯­å¥è¢«è§†ä¸ºä¿®æ”¹é“¾ä¸ŠçŠ¶æ€ï¼š</p>
<ol>
<li>å†™å…¥çŠ¶æ€å˜é‡ã€‚</li>
<li>é‡Šæ”¾äº‹ä»¶ã€‚</li>
<li>åˆ›å»ºå…¶ä»–åˆåŒã€‚</li>
<li>ä½¿ç”¨<code>selfdestruct</code>.</li>
<li>é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ã€‚</li>
<li>è°ƒç”¨ä»»ä½•æœªæ ‡è®°<code>view</code>æˆ–<code>pure</code>çš„å‡½æ•°ã€‚</li>
<li>ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆlow-level callsï¼‰ã€‚</li>
<li>ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚</li>
</ol>
<p>æˆ‘ç”»äº†ä¸€ä¸ªé©¬é‡Œå¥¥æ’ç”»ï¼Œå¸®åŠ©å¤§å®¶ç†è§£ã€‚åœ¨æ’ç”»é‡Œï¼Œæˆ‘æŠŠåˆçº¦ä¸­çš„çŠ¶æ€å˜é‡ï¼ˆå­˜å‚¨åœ¨é“¾ä¸Šï¼‰æ¯”ä½œç¢§æ± å…¬ä¸»ï¼Œä¸‰ç§ä¸åŒçš„è§’è‰²ä»£è¡¨ä¸åŒçš„å…³é”®å­—</p>
<figure data-type="image" tabindex="12"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108171552704.png" alt="pure view" loading="lazy"></figure>
<ul>
<li><code>pure</code>ï¼Œä¸­æ–‡æ„æ€æ˜¯â€œçº¯â€ï¼Œåœ¨<code>solidity</code>é‡Œç†è§£ä¸ºâ€œçº¯çº¯ç‰›é©¬â€ã€‚åŒ…å«<code>pure</code>å…³é”®å­—çš„å‡½æ•°ï¼Œä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½å†™å…¥å­˜å‚¨åœ¨é“¾ä¸Šçš„çŠ¶æ€å˜é‡ã€‚å°±åƒå°æ€ªä¸€æ ·ï¼Œçœ‹ä¸åˆ°ä¹Ÿæ‘¸ä¸åˆ°ç¢§æ± å…¬ä¸»ã€‚</li>
<li><code>view</code>ï¼Œâ€œçœ‹â€ï¼Œåœ¨<code>solidity</code>é‡Œç†è§£ä¸ºâ€œçœ‹å®¢â€ã€‚åŒ…å«<code>view</code>å…³é”®å­—çš„å‡½æ•°ï¼Œèƒ½è¯»å–ä½†ä¹Ÿä¸èƒ½å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ï¼Œèƒ½çœ‹åˆ°ç¢§æ± ï¼Œä½†ç»ˆç©¶æ˜¯çœ‹å®¢ï¼Œä¸èƒ½å…¥æ´æˆ¿ã€‚</li>
<li>ä¸å†™<code>pure</code>ä¹Ÿä¸å†™<code>view</code>ï¼Œå‡½æ•°æ—¢å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥é‡Œçš„<code>boss</code>ï¼Œå¯ä»¥å¯¹ç¢§æ± å…¬ä¸»ä¸ºæ‰€æ¬²ä¸ºğŸ¶ã€‚</li>
</ul>
<h5 id="1-pure-vs-view">1. pure v.s. view</h5>
<p>æˆ‘ä»¬åœ¨åˆçº¦é‡Œå®šä¹‰ä¸€ä¸ªçŠ¶æ€å˜é‡ <code>number = 5</code>ã€‚</p>
<pre><code class="language-solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;
contract FunctionTypes{
uint256 public number = 5;
</code></pre>
<p>å®šä¹‰ä¸€ä¸ª<code>add()</code>å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡ç»™<code>number + 1</code>ã€‚</p>
<pre><code class="language-solidity">// é»˜è®¤
function add() external{
	number = number + 1;
}
</code></pre>
<p>å¦‚æœ<code>add()</code>åŒ…å«äº†<code>pure</code>å…³é”®å­—ï¼Œä¾‹å¦‚ <code>function add() pure external</code>ï¼Œå°±ä¼šæŠ¥é”™ã€‚å› ä¸º<code>pure</code>ï¼ˆçº¯çº¯ç‰›é©¬ï¼‰æ˜¯ä¸é…è¯»å–åˆçº¦é‡Œçš„çŠ¶æ€å˜é‡çš„ï¼Œæ›´ä¸é…æ”¹å†™ã€‚é‚£<code>pure</code>å‡½æ•°èƒ½åšäº›ä»€ä¹ˆï¼Ÿä¸¾ä¸ªä¾‹å­ï¼Œä½ å¯ä»¥ç»™å‡½æ•°ä¼ é€’ä¸€ä¸ªå‚æ•° <code>_number</code>ï¼Œç„¶åè®©ä»–è¿”å› <code>_number+1</code>ã€‚</p>
<pre><code class="language-solidity">// pure: çº¯çº¯ç‰›é©¬
function addPure(uint256 _number) external pure returns(uint256 new_number){
	new_number = _number+1;
}
</code></pre>
<p>å¦‚æœ<code>add()</code>åŒ…å«<code>view</code>ï¼Œæ¯”å¦‚<code>function add() view external</code>ï¼Œä¹Ÿä¼šæŠ¥é”™ã€‚å› ä¸º<code>view</code>èƒ½è¯»å–ï¼Œä½†ä¸èƒ½å¤Ÿæ”¹å†™çŠ¶æ€å˜é‡ã€‚å¯ä»¥ç¨å¾®æ”¹å†™ä¸‹æ–¹ç¨‹ï¼Œè®©ä»–ä¸æ”¹å†™<code>number</code>ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å˜é‡ã€‚</p>
<pre><code class="language-solidity">// view: çœ‹å®¢
function addView() external view returns(uint256 new_number) {
	new_number = number + 1;
}
</code></pre>
<figure data-type="image" tabindex="13"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108172634601.png" alt="remix æµ‹è¯•" loading="lazy"></figure>
<h5 id="2-internal-vs-external">2. internal v.s. external</h5>
<pre><code class="language-solidity">// internal: å†…éƒ¨
function minus() internal {
	number = number - 1;
}

// åˆçº¦å†…çš„å‡½æ•°å¯ä»¥è°ƒç”¨å†…éƒ¨å‡½æ•°
function minusCall() external {
	minus();
}
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>internal</code>çš„<code>minus()</code>å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨ä½¿å¾—<code>number</code>å˜é‡å‡1ã€‚ç”±äºæ˜¯<code>internal</code>ï¼Œåªèƒ½ç”±åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œè€Œå¤–éƒ¨ä¸èƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»å†å®šä¹‰ä¸€ä¸ª<code>external</code>çš„<code>minusCall()</code>å‡½æ•°ï¼Œæ¥é—´æ¥è°ƒç”¨å†…éƒ¨çš„<code>minus()</code>ã€‚</p>
<figure data-type="image" tabindex="14"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108190644289.png" alt="é—´æ¥è°ƒç”¨å†…éƒ¨å‡½æ•°" loading="lazy"></figure>
<h5 id="3-payable">3. payable</h5>
<pre><code class="language-solidity">constructor() payable {}

// payable: é€’é’±ï¼Œèƒ½ç»™åˆçº¦æ”¯ä»˜ethçš„å‡½æ•°
function minusPayable() external payable returns(uint256 balance) {
    minus();    
    balance = address(this).balance;
}
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>external payable</code>çš„<code>minusPayable()</code>å‡½æ•°ï¼Œé—´æ¥çš„è°ƒç”¨<code>minus()</code>ï¼Œå¹¶ä¸”è¿”å›åˆçº¦é‡Œçš„<code>ETH</code>ä½™é¢ï¼ˆ<code>this</code>å…³é”®å­—å¯ä»¥è®©æˆ‘ä»¬å¼•ç”¨åˆçº¦åœ°å€)ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨<code>minusPayable()</code>æ—¶ï¼Œå¾€åˆçº¦é‡Œè½¬å…¥1ä¸ª<code>ETH</code>ã€‚</p>
<figure data-type="image" tabindex="15"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108191539090.png" alt="payable æ–¹æ³•å®šä¹‰" loading="lazy"></figure>
<h4 id="æ€»ç»“-2">æ€»ç»“</h4>
<p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†<code>solidity</code>ä¸­çš„å‡½æ•°ç±»å‹ï¼Œæ¯”è¾ƒéš¾ç†è§£çš„æ˜¯<code>pure</code>å’Œ<code>view</code>ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­æ²¡å‡ºç°è¿‡ã€‚<code>solidity</code>å¼•å…¥<code>pure</code>å’Œ<code>view</code>å…³é”®å­—ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çœ<code>gas</code>å’Œæ§åˆ¶å‡½æ•°æƒé™ï¼šå¦‚æœç”¨æˆ·ç›´æ¥è°ƒç”¨<code>pure</code>/<code>view</code>æ–¹ç¨‹æ˜¯ä¸æ¶ˆè€—<code>gas</code>çš„ï¼ˆåˆçº¦ä¸­é<code>pure</code>/<code>view</code>å‡½æ•°è°ƒç”¨å®ƒä»¬åˆ™ä¼šæ”¹å†™é“¾ä¸ŠçŠ¶æ€ï¼Œéœ€è¦ä»˜gasï¼‰</p>
<h3 id="4-å‡½æ•°è¾“å‡º">4. å‡½æ•°è¾“å‡º</h3>
<p><a href="https://wtf.academy/solidity-start/Return/">å‡½æ•°è¾“å‡º</a></p>
<p><code>Solidity</code>å‡½æ•°è¾“å‡ºï¼ŒåŒ…æ‹¬ï¼šè¿”å›å¤šç§å˜é‡ï¼Œå‘½åå¼è¿”å›ï¼Œä»¥åŠåˆ©ç”¨è§£æ„å¼èµ‹å€¼è¯»å–å…¨éƒ¨å’Œéƒ¨åˆ†è¿”å›å€¼ã€‚</p>
<h4 id="è¿”å›å€¼-returnå’Œreturns">è¿”å›å€¼ returnå’Œreturns</h4>
<p><code>Solidity</code>æœ‰ä¸¤ä¸ªå…³é”®å­—ä¸å‡½æ•°è¾“å‡ºç›¸å…³ï¼š<code>return</code>å’Œ<code>returns</code>ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li><code>returns</code>åŠ åœ¨å‡½æ•°ååé¢ï¼Œç”¨äºå£°æ˜è¿”å›çš„å˜é‡ç±»å‹åŠå˜é‡åï¼›</li>
<li><code>return</code>ç”¨äº<strong>å‡½æ•°ä¸»ä½“ä¸­</strong>ï¼Œè¿”å›æŒ‡å®šçš„å˜é‡ã€‚</li>
</ul>
<p>ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†<code>returnMultiple()</code>å‡½æ•°å°†æœ‰å¤šä¸ªè¾“å‡ºï¼š<code>returns(uint256, bool, uint256[3] memory)</code>ï¼Œæ¥ç€æˆ‘ä»¬åœ¨å‡½æ•°ä¸»ä½“ä¸­ç”¨<code>return(1, true, [uint256(1),2,5])</code>ç¡®å®šäº†è¿”å›å€¼ã€‚</p>
<pre><code class="language-solidity">// è¿”å›å¤šä¸ªå˜é‡
function returnMultiple() public pure returns(uint256, bool, uint256[3] memory){
	return(1, true, [uint256(1),2,5]);
}
</code></pre>
<h4 id="å‘½åå¼è¿”å›">å‘½åå¼è¿”å›</h4>
<p>æˆ‘ä»¬å¯ä»¥åœ¨<code>returns</code>ä¸­æ ‡æ˜è¿”å›å˜é‡çš„åç§°ï¼Œè¿™æ ·<code>solidity</code>ä¼šè‡ªåŠ¨ç»™è¿™äº›å˜é‡åˆå§‹åŒ–ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿”å›è¿™äº›å‡½æ•°çš„å€¼ï¼Œä¸éœ€è¦åŠ <code>return</code>ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨<code>returns(uint256 _number, bool _bool, uint256[3] memory _array)</code>å£°æ˜äº†è¿”å›å˜é‡ç±»å‹ä»¥åŠå˜é‡åã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ä¸»ä½“ä¸­åªéœ€è¦ç»™å˜é‡<code>_number</code>ï¼Œ<code>_bool</code>å’Œ<code>_array</code>èµ‹å€¼å°±å¯ä»¥è‡ªåŠ¨è¿”å›äº†ã€‚</p>
<pre><code class="language-solidity">// å‘½åå¼è¿”å›
function returnNamed() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array){
    _number = 2;
    _bool = false; 
    _array = [uint256(3),2,1];
}
</code></pre>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½åå¼è¿”å›ä¸­ç”¨<code>return</code>æ¥è¿”å›å˜é‡ï¼š</p>
<pre><code class="language-solidity">// å‘½åå¼è¿”å›ï¼Œä¾ç„¶æ”¯æŒreturn
function returnNamed2() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array){
	return(1, true, [uint256(1),2,5]);
}
</code></pre>
<p>å¦‚æœï¼Œå‘½åå¼è¿”å›ä¸­ï¼Œåªæœ‰ä¸€ä¸ªè¿”å›é¡¹</p>
<figure data-type="image" tabindex="16"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108194159024.png" alt="åªæœ‰ä¸€ä¸ªè¿”å›é¡¹" loading="lazy"></figure>
<h4 id="è§£æ„å¼èµ‹å€¼">è§£æ„å¼èµ‹å€¼</h4>
<p><code>solidity</code>ä½¿ç”¨è§£æ„å¼èµ‹å€¼çš„è§„åˆ™ï¼Œæ”¯æŒè¯»å–å‡½æ•°çš„å…¨éƒ¨æˆ–éƒ¨åˆ†è¿”å›å€¼ã€‚</p>
<ul>
<li>è¯»å–æ‰€æœ‰è¿”å›å€¼ï¼šå£°æ˜å˜é‡ï¼Œå¹¶ä¸”å°†è¦èµ‹å€¼çš„å˜é‡ç”¨<code>,</code>éš”å¼€ï¼ŒæŒ‰é¡ºåºæ’åˆ—ã€‚</li>
</ul>
<pre><code class="language-solidity">uint256 _number;
bool _bool;
uint256[3] memory _array;
(_number, _bool, _array) = returnNamed();
</code></pre>
<ul>
<li>è¯»å–éƒ¨åˆ†è¿”å›å€¼ï¼šå£°æ˜è¦è¯»å–çš„è¿”å›å€¼å¯¹åº”çš„å˜é‡ï¼Œä¸è¯»å–çš„ç•™ç©ºã€‚ä¸‹é¢è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åªè¯»å–<code>_bool</code>ï¼Œè€Œä¸è¯»å–è¿”å›çš„<code>_number</code>å’Œ<code>_array</code>ï¼š</li>
</ul>
<pre><code class="language-solidity">(, _bool2, ) = returnNamed();
</code></pre>
<figure data-type="image" tabindex="17"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108193736398.png" alt="3ç§returnæ–¹å¼çš„åŒºåˆ«" loading="lazy"></figure>
<h3 id="5-å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ">5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ</h3>
<p><a href="https://wtf.academy/solidity-start/DataStorage/">å˜é‡æ•°æ®å­˜å‚¨ä¸ä½œç”¨åŸŸ</a></p>
<h4 id="solidityä¸­çš„å¼•ç”¨ç±»å‹">Solidityä¸­çš„å¼•ç”¨ç±»å‹</h4>
<p><strong>å¼•ç”¨ç±»å‹(Reference Type)</strong>ï¼šåŒ…æ‹¬æ•°ç»„ï¼ˆ<code>array</code>ï¼‰ï¼Œç»“æ„ä½“ï¼ˆ<code>struct</code>ï¼‰å’Œæ˜ å°„ï¼ˆ<code>mapping</code>ï¼‰ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚ç”±äºè¿™ç±»å˜é‡æ¯”è¾ƒå¤æ‚ï¼Œå ç”¨å­˜å‚¨ç©ºé—´å¤§ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶å¿…é¡»è¦å£°æ˜æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚</p>
<h4 id="æ•°æ®ä½ç½®">æ•°æ®ä½ç½®</h4>
<p>solidity<strong>æ•°æ®å­˜å‚¨ä½ç½®</strong>æœ‰ä¸‰ç±»ï¼š<code>storage</code>ï¼Œ<code>memory</code>å’Œ<code>calldata</code>ã€‚ä¸åŒå­˜å‚¨ä½ç½®çš„<code>gas</code>æˆæœ¬ä¸åŒã€‚</p>
<p><code>storage</code>ç±»å‹çš„æ•°æ®å­˜åœ¨<strong>é“¾ä¸Š</strong>ï¼Œç±»ä¼¼è®¡ç®—æœºçš„ç¡¬ç›˜ï¼Œæ¶ˆè€—<code>gas</code><strong>å¤š</strong>ï¼›<code>memory</code>å’Œ<code>calldata</code>ç±»å‹çš„ä¸´æ—¶å­˜åœ¨<strong>å†…å­˜</strong>é‡Œï¼Œæ¶ˆè€—<code>gas</code>å°‘ã€‚</p>
<p>å¤§è‡´ç”¨æ³•ï¼š</p>
<ol>
<li><code>storage</code>ï¼šåˆçº¦é‡Œçš„<strong>çŠ¶æ€å˜é‡</strong>é»˜è®¤éƒ½æ˜¯<code>storage</code>ï¼Œå­˜å‚¨åœ¨é“¾ä¸Šã€‚</li>
<li><code>memory</code>ï¼šå‡½æ•°é‡Œçš„<strong>å‚æ•°å’Œä¸´æ—¶å˜é‡</strong>ä¸€èˆ¬ç”¨<code>memory</code>ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ã€‚</li>
<li><code>calldata</code>ï¼šå’Œ<code>memory</code>ç±»ä¼¼ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ã€‚ä¸<code>memory</code>çš„ä¸åŒç‚¹åœ¨äº<code>calldata</code>å˜é‡<strong>ä¸èƒ½ä¿®æ”¹</strong>ï¼ˆ<code>immutable</code>ï¼‰ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„å‚æ•°ã€‚ä¾‹å­ï¼š</li>
</ol>
<pre><code class="language-solidity">function fCalldata(uint[] calldata _x) public pure returns(uint[] calldata){
    //å‚æ•°ä¸ºcalldataæ•°ç»„ï¼Œä¸èƒ½è¢«ä¿®æ”¹
    // _x[0] = 0 //è¿™æ ·ä¿®æ”¹ä¼šæŠ¥é”™
    return(_x);
}
</code></pre>
<figure data-type="image" tabindex="18"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108194922500.png" alt="calldata ä¸èƒ½ä¿®æ”¹" loading="lazy"></figure>
<h4 id="æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™">æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™</h4>
<p>åœ¨ä¸åŒå­˜å‚¨ç±»å‹ç›¸äº’èµ‹å€¼æ—¶å€™ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿç‹¬ç«‹çš„å‰¯æœ¬ï¼ˆä¿®æ”¹æ–°å˜é‡ä¸ä¼šå½±å“åŸå˜é‡ï¼‰ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿå¼•ç”¨ï¼ˆä¿®æ”¹æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ï¼‰ã€‚è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>storage</code>ï¼ˆåˆçº¦çš„çŠ¶æ€å˜é‡ï¼‰èµ‹å€¼ç»™æœ¬åœ°<code>storage</code>ï¼ˆå‡½æ•°é‡Œçš„ï¼‰æ—¶å€™ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚ä¾‹å­ï¼š</li>
</ol>
<pre><code class="language-solidity">uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ x

function fStorage() public{
    //å£°æ˜ä¸€ä¸ªstorageçš„å˜é‡ xStorageï¼ŒæŒ‡å‘xã€‚ä¿®æ”¹xStorageä¹Ÿä¼šå½±å“x
    uint[] storage xStorage = x;
    xStorage[0] = 100;
}
</code></pre>
<figure data-type="image" tabindex="19"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108202437307.png" alt="ä¿®æ”¹storageçš„å€¼ä¼šå½±å“x" loading="lazy"></figure>
<ol start="2">
<li><code>storage</code>èµ‹å€¼ç»™<code>memory</code>ï¼Œä¼šåˆ›å»ºç‹¬ç«‹çš„å¤æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªï¼›åä¹‹äº¦ç„¶ã€‚ä¾‹å­ï¼š</li>
</ol>
<pre><code class="language-solidity">uint[] x = [1,2,3]; // çŠ¶æ€å˜é‡ï¼šæ•°ç»„ x

function fMemory() public view{
    //å£°æ˜ä¸€ä¸ªMemoryçš„å˜é‡xMemoryï¼Œå¤åˆ¶xã€‚ä¿®æ”¹xMemoryä¸ä¼šå½±å“x
    uint[] memory xMemory = x;
    xMemory[0] = 100;
    xMemory[1] = 200;
    uint[] memory xMemory2 = x;
    xMemory2[0] = 300;
}
</code></pre>
<figure data-type="image" tabindex="20"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108202323798.png" alt="ä¿®æ”¹memoryçš„å€¼ä¸ä¼šå½±å“x" loading="lazy"></figure>
<ol start="3">
<li>
<p><code>memory</code>èµ‹å€¼ç»™<code>memory</code>ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚</p>
</li>
<li>
<p>å…¶ä»–æƒ…å†µï¼Œå˜é‡èµ‹å€¼ç»™<code>storage</code>ï¼Œä¼šåˆ›å»ºç‹¬ç«‹çš„å¤æœ¬ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚</p>
</li>
</ol>
<h4 id="å˜é‡çš„ä½œç”¨åŸŸ">å˜é‡çš„ä½œç”¨åŸŸ</h4>
<p><code>Solidity</code>ä¸­å˜é‡æŒ‰ä½œç”¨åŸŸåˆ’åˆ†æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯çŠ¶æ€å˜é‡ï¼ˆstate variableï¼‰ï¼Œå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰å’Œå…¨å±€å˜é‡(global variable)</p>
<h5 id="1-çŠ¶æ€å˜é‡">1. çŠ¶æ€å˜é‡</h5>
<p>çŠ¶æ€å˜é‡æ˜¯æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šçš„å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—® ï¼Œ<code>gas</code>æ¶ˆè€—é«˜ã€‚çŠ¶æ€å˜é‡åœ¨åˆçº¦å†…ã€å‡½æ•°å¤–å£°æ˜ï¼š</p>
<pre><code class="language-solidity">contract Variables {
    uint public x = 1;
    uint public y;
    string public z;
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ï¼š</p>
<pre><code class="language-solidity">function foo() external{
    // å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼
    x = 5;
    y = 2;
    z = &quot;0xAA&quot;;
}
</code></pre>
<h5 id="2-å±€éƒ¨å˜é‡">2. å±€éƒ¨å˜é‡</h5>
<p>å±€éƒ¨å˜é‡æ˜¯ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆã€‚å±€éƒ¨å˜é‡çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œä¸ä¸Šé“¾ï¼Œ<code>gas</code>ä½ã€‚å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼š</p>
<pre><code class="language-solidity">function bar() external pure returns(uint){
    uint xx = 1;
    uint yy = 3;
    uint zz = xx + yy;
    return(zz);
}
</code></pre>
<h5 id="3-å…¨å±€å˜é‡">3. å…¨å±€å˜é‡</h5>
<p>å…¨å±€å˜é‡æ˜¯å…¨å±€èŒƒå›´å·¥ä½œçš„å˜é‡ï¼Œéƒ½æ˜¯<code>solidity</code>é¢„ç•™å…³é”®å­—ã€‚ä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ï¼š</p>
<pre><code class="language-solidity">function global() external view returns(address, uint, bytes memory){
    address sender = msg.sender;
    uint blockNum = block.number;
    bytes memory data = msg.data;
    return(sender, blockNum, data);
}
</code></pre>
<p>åœ¨ä¸Šé¢ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†3ä¸ªå¸¸ç”¨çš„å…¨å±€å˜é‡ï¼š<code>msg.sender</code>, <code>block.number</code>å’Œ<code>msg.data</code>ï¼Œä»–ä»¬åˆ†åˆ«ä»£è¡¨è¯·æ±‚å‘èµ·åœ°å€ï¼Œå½“å‰åŒºå—é«˜åº¦ï¼Œå’Œè¯·æ±‚æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å…¨å±€å˜é‡ï¼Œæ›´å®Œæ•´çš„åˆ—è¡¨è¯·çœ‹è¿™ä¸ª<a href="https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#special-variables-and-functions">é“¾æ¥</a>ï¼š</p>
<ul>
<li><code>blockhash(uint blockNumber)</code>: (<code>bytes32</code>)ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äº256æœ€è¿‘åŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚</li>
<li><code>block.coinbase</code>: (<code>address payable</code>) å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€</li>
<li><code>block.gaslimit</code>: (<code>uint</code>) å½“å‰åŒºå—çš„gaslimit</li>
<li><code>block.number</code>: (<code>uint</code>) å½“å‰åŒºå—çš„number</li>
<li><code>block.timestamp</code>: (<code>uint</code>) å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’</li>
<li><code>gasleft()</code>: (<code>uint256</code>) å‰©ä½™ gas</li>
<li><code>msg.data</code>: (<code>bytes calldata</code>) å®Œæ•´call data</li>
<li><code>msg.sender</code>: (<code>address payable</code>) æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)</li>
<li><code>msg.sig</code>: (<code>bytes4</code>) calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)</li>
<li><code>msg.value</code>: (<code>uint</code>) å½“å‰äº¤æ˜“å‘é€çš„<code>wei</code>å€¼</li>
</ul>
<figure data-type="image" tabindex="21"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221108203818692.png" alt="å˜é‡çš„ä½œç”¨åŸŸ" loading="lazy"></figure>
<h3 id="6-å¼•ç”¨ç±»å‹">6. å¼•ç”¨ç±»å‹</h3>
<p><code>solidity</code>ä¸­çš„ä¸¤ä¸ªé‡è¦å˜é‡ç±»å‹ï¼šæ•°ç»„ï¼ˆ<code>array</code>ï¼‰å’Œç»“æ„ä½“ï¼ˆ<code>struct</code>ï¼‰ã€‚</p>
<h4 id="æ•°ç»„array">æ•°ç»„array</h4>
<p>æ•°ç»„ï¼ˆ<code>Array</code>ï¼‰æ˜¯<code>solidity</code>å¸¸ç”¨çš„ä¸€ç§å˜é‡ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼ˆæ•´æ•°ï¼Œå­—èŠ‚ï¼Œåœ°å€ç­‰ç­‰ï¼‰ã€‚æ•°ç»„åˆ†ä¸ºå›ºå®šé•¿åº¦æ•°ç»„å’Œå¯å˜é•¿åº¦æ•°ç»„ä¸¤ç§ï¼š</p>
<ul>
<li><strong>å›ºå®š</strong>é•¿åº¦æ•°ç»„ï¼šåœ¨<strong>å£°æ˜æ—¶æŒ‡å®šæ•°ç»„çš„é•¿åº¦</strong>ã€‚ç”¨<code>T[k]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œ<code>k</code>æ˜¯é•¿åº¦ï¼Œä¾‹å¦‚ï¼š</li>
</ul>
<pre><code class="language-solidity">// å›ºå®šé•¿åº¦ Array
uint[8] array1;
bytes1[5] array2;
address[100] array3;
</code></pre>
<ul>
<li><strong>å¯å˜é•¿åº¦æ•°ç»„ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰</strong>ï¼šåœ¨å£°æ˜æ—¶ä¸æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨<code>T[]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼ˆ<code>bytes</code>æ¯”è¾ƒ<strong>ç‰¹æ®Š</strong>ï¼Œæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸ç”¨åŠ <code>[]</code>ï¼‰ï¼š</li>
</ul>
<pre><code class="language-solidity">// å¯å˜é•¿åº¦ Array
uint[] array4;
bytes1[] array5;
address[] array6;
bytes array7;
</code></pre>
<h5 id="åˆ›å»ºæ•°ç»„çš„è§„åˆ™">åˆ›å»ºæ•°ç»„çš„è§„åˆ™</h5>
<p>åœ¨solidityé‡Œï¼Œåˆ›å»ºæ•°ç»„æœ‰ä¸€äº›è§„åˆ™ï¼š</p>
<ul>
<li>å¯¹äº<code>memory</code>ä¿®é¥°çš„<code>åŠ¨æ€æ•°ç»„</code>ï¼Œå¯ä»¥ç”¨<code>new</code>æ“ä½œç¬¦æ¥åˆ›å»ºï¼Œä½†æ˜¯<strong>å¿…é¡»å£°æ˜é•¿åº¦ï¼Œå¹¶ä¸”å£°æ˜åé•¿åº¦ä¸èƒ½æ”¹å˜</strong>ã€‚ä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-solidity">// åˆå§‹åŒ–å¯å˜é•¿åº¦
uint[] array8 = new uint[](5);
bytes array9 = new bytes(9);
</code></pre>
<figure data-type="image" tabindex="22"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109093509550.png" alt="memory æ•°ç»„" loading="lazy"></figure>
<ul>
<li>æ•°ç»„å­—é¢å¸¸æ•°(Array Literals)æ˜¯å†™ä½œè¡¨è¾¾å¼å½¢å¼çš„æ•°ç»„ï¼Œç”¨æ–¹æ‹¬å·åŒ…ç€æ¥åˆå§‹åŒ–arrayçš„ä¸€ç§æ–¹å¼ï¼Œå¹¶ä¸”é‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeæ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†çš„ï¼Œä¾‹å¦‚<code>[1,2,3]</code>é‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯uint8ç±»å‹ï¼Œå› ä¸ºåœ¨solidityä¸­å¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æŒ‡å®štypeçš„è¯ï¼Œé»˜è®¤å°±æ˜¯æœ€å°å•ä½çš„è¯¥typeï¼Œè¿™é‡Œintçš„é»˜è®¤æœ€å°å•ä½ç±»å‹å°±æ˜¯uint8ã€‚è€Œ<code>[uint(1),2,3]</code>é‡Œé¢çš„å…ƒç´ éƒ½æ˜¯uintç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šäº†æ˜¯uintç±»å‹äº†ï¼Œæˆ‘ä»¬éƒ½ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†ã€‚<strong>ä¸‹é¢çš„åˆçº¦ä¸­ï¼Œå¯¹äºfå‡½æ•°é‡Œé¢çš„è°ƒç”¨ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼å¯¹ç¬¬ä¸€ä¸ªå…ƒç´ è¿›è¡Œuintå¼ºè½¬çš„è¯ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºå¦‚ä¸Šæ‰€è¿°æˆ‘ä»¬å…¶å®æ˜¯ä¼ å…¥äº†uint8ç±»å‹çš„arrayï¼Œå¯æ˜¯gå‡½æ•°éœ€è¦çš„å´æ˜¯uintç±»å‹çš„arrayï¼Œå°±ä¼šæŠ¥é”™äº†</strong>ã€‚</li>
</ul>
<pre><code class="language-solidity">// SPDX-License-Identifier: GPL-3.0
pragma solidity &gt;=0.4.16 &lt;0.9.0;
contract C {
    function f() public pure {
        g([uint(1), 2, 3]);
    }
    function g(uint[3] memory) public pure {
        // ...
    }
}
</code></pre>
<ul>
<li>å¦‚æœåˆ›å»ºçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä½ éœ€è¦<strong>ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„èµ‹å€¼</strong>ã€‚ï¼ˆåœ¨å‡½æ•°å†…è°ƒç”¨ï¼‰</li>
</ul>
<pre><code class="language-solidity">uint[] memory x = new uint[](3);
x[0] = 1;
x[1] = 3;
x[2] = 4;
</code></pre>
<h5 id="æ•°ç»„æˆå‘˜">æ•°ç»„æˆå‘˜</h5>
<ul>
<li><code>length</code>: æ•°ç»„æœ‰ä¸€ä¸ªåŒ…å«å…ƒç´ æ•°é‡çš„<code>length</code>æˆå‘˜ï¼Œ<code>memory</code>æ•°ç»„çš„é•¿åº¦åœ¨åˆ›å»ºåæ˜¯å›ºå®šçš„ã€‚</li>
<li><code>push()</code>: <code>åŠ¨æ€æ•°ç»„</code>å’Œ<code>bytes</code>æ‹¥æœ‰<code>push()</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>0</code>å…ƒç´ ã€‚</li>
<li><code>push(x)</code>: <code>åŠ¨æ€æ•°ç»„</code>å’Œ<code>bytes</code>æ‹¥æœ‰<code>push(x)</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>x</code>å…ƒç´ ã€‚</li>
<li><code>pop()</code>: <code>åŠ¨æ€æ•°ç»„</code>å’Œ<code>bytes</code>æ‹¥æœ‰<code>pop()</code>æˆå‘˜ï¼Œå¯ä»¥ç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li>
</ul>
<figure data-type="image" tabindex="23"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109095151746.png" alt="æ•°ç»„remixéªŒè¯" loading="lazy"></figure>
<h4 id="ç»“æ„ä½“struct">ç»“æ„ä½“struct</h4>
<p><code>Solidity</code>æ”¯æŒé€šè¿‡æ„é€ ç»“æ„ä½“çš„å½¢å¼å®šä¹‰æ–°çš„ç±»å‹ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-solidity">// ç»“æ„ä½“
struct Student{
    uint256 id;
    uint256 score; 
}
</code></pre>
<pre><code class="language-solidity">Student student; // åˆå§‹ä¸€ä¸ªstudentç»“æ„ä½“
</code></pre>
<p>ç»™ç»“æ„ä½“èµ‹å€¼çš„ä¸¤ç§æ–¹æ³•ï¼š</p>
<pre><code class="language-solidity">//  ç»™ç»“æ„ä½“èµ‹å€¼
// æ–¹æ³•1:åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªstorageçš„structå¼•ç”¨
function initStudent1() external{
    Student storage _student = student; // assign a copy of student
    _student.id = 11;
    _student.score = 100;
}
</code></pre>
<figure data-type="image" tabindex="24"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109100225829.png" alt="ç»“æ„ä½“èµ‹å€¼æ–¹æ³•1" loading="lazy"></figure>
<pre><code class="language-solidity">// æ–¹æ³•2:ç›´æ¥å¼•ç”¨çŠ¶æ€å˜é‡çš„struct
function initStudent2() external{
    student.id = 1;
    student.score = 80;
}
</code></pre>
<figure data-type="image" tabindex="25"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109100343565.png" alt="ç»“æ„ä½“èµ‹å€¼æ–¹æ³•2" loading="lazy"></figure>
<h3 id="7-æ˜ å°„ç±»å‹">7. æ˜ å°„ç±»å‹</h3>
<h4 id="æ˜ å°„mapping">æ˜ å°„Mapping</h4>
<p>åœ¨æ˜ å°„ä¸­ï¼Œäººä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆ<code>Key</code>ï¼‰æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼ï¼ˆ<code>Value</code>ï¼‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªäººçš„<code>id</code>æ¥æŸ¥è¯¢ä»–çš„é’±åŒ…åœ°å€ã€‚</p>
<p>å£°æ˜æ˜ å°„çš„æ ¼å¼ä¸º<code>mapping(_KeyType =&gt; _ValueType)</code>ï¼Œå…¶ä¸­<code>_KeyType</code>å’Œ<code>_ValueType</code>åˆ†åˆ«æ˜¯<code>Key</code>å’Œ<code>Value</code>çš„å˜é‡ç±»å‹ã€‚ä¾‹å­ï¼š</p>
<pre><code class="language-solidity">mapping(uint =&gt; address) public idToAddress; // idæ˜ å°„åˆ°åœ°å€
mapping(address =&gt; address) public swapPair; // å¸å¯¹çš„æ˜ å°„ï¼Œåœ°å€åˆ°åœ°å€
</code></pre>
<h4 id="æ˜ å°„çš„è§„åˆ™">æ˜ å°„çš„è§„åˆ™</h4>
<ul>
<li><strong>è§„åˆ™1</strong>ï¼šæ˜ å°„çš„<code>_KeyType</code>åªèƒ½é€‰æ‹©<code>solidity</code>é»˜è®¤çš„ç±»å‹ï¼Œæ¯”å¦‚<code>uint</code>ï¼Œ<code>address</code>ç­‰ï¼Œä¸èƒ½ç”¨è‡ªå®šä¹‰çš„ç»“æ„ä½“ã€‚è€Œ<code>_ValueType</code>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ç±»å‹ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­ä¼šæŠ¥é”™ï¼Œå› ä¸º<code>_KeyType</code>ä½¿ç”¨äº†æˆ‘ä»¬è‡ªå®šä¹‰çš„ç»“æ„ä½“ï¼š</li>
</ul>
<pre><code class="language-solidity">// æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ Struct
struct Student{
    uint256 id;
    uint256 score; 
}
mapping(Student =&gt; uint) public testVar;
</code></pre>
<figure data-type="image" tabindex="26"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109101316243.png" alt="_KeyType åªèƒ½é€‰æ‹©solidityçš„é»˜è®¤ç±»å‹" loading="lazy"></figure>
<ul>
<li><strong>è§„åˆ™2</strong>ï¼šæ˜ å°„çš„å­˜å‚¨ä½ç½®å¿…é¡»æ˜¯<code>storage</code>ï¼Œå› æ­¤å¯ä»¥ç”¨äºåˆçº¦çš„çŠ¶æ€å˜é‡ï¼Œå‡½æ•°ä¸­çš„<code>storage</code>å˜é‡ï¼Œå’Œlibraryå‡½æ•°çš„å‚æ•°ï¼ˆè§<a href="https://github.com/ethereum/solidity/issues/4635">ä¾‹å­</a>ï¼‰ã€‚ä¸èƒ½ç”¨äº<code>public</code>å‡½æ•°çš„å‚æ•°æˆ–è¿”å›ç»“æœä¸­ï¼Œå› ä¸º<code>mapping</code>è®°å½•çš„æ˜¯ä¸€ç§å…³ç³» (key - value pair)ã€‚</li>
<li><strong>è§„åˆ™3</strong>ï¼šå¦‚æœæ˜ å°„å£°æ˜ä¸º<code>public</code>ï¼Œé‚£ä¹ˆ<code>solidity</code>ä¼šè‡ªåŠ¨ç»™ä½ åˆ›å»ºä¸€ä¸ª<code>getter</code>å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡<code>Key</code>æ¥æŸ¥è¯¢å¯¹åº”çš„<code>Value</code>ã€‚</li>
<li><strong>è§„åˆ™4</strong>ï¼šç»™<strong>æ˜ å°„æ–°å¢çš„é”®å€¼å¯¹</strong>çš„è¯­æ³•ä¸º<code>_Var[_Key] = _Value</code>ï¼Œå…¶ä¸­<code>_Var</code>æ˜¯æ˜ å°„å˜é‡åï¼Œ<code>_Key</code>å’Œ<code>_Value</code>å¯¹åº”æ–°å¢çš„é”®å€¼å¯¹ã€‚ä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-solidity">function writeMap (uint _Key, address _Value) public{
	idToAddress[_Key] = _Value;
}
</code></pre>
<h4 id="æ˜ å°„çš„åŸç†">æ˜ å°„çš„åŸç†</h4>
<ul>
<li><strong>åŸç†1</strong>: æ˜ å°„ä¸å‚¨å­˜ä»»ä½•é”®ï¼ˆ<code>Key</code>ï¼‰çš„èµ„è®¯ï¼Œ<strong>ä¹Ÿæ²¡æœ‰lengthçš„èµ„è®¯</strong>ã€‚</li>
<li><strong>åŸç†2</strong>: æ˜ å°„ä½¿ç”¨<code>keccak256(key)</code>å½“æˆoffsetå­˜å–valueã€‚</li>
<li><strong>åŸç†3</strong>: å› ä¸ºEthereumä¼šå®šä¹‰æ‰€æœ‰æœªä½¿ç”¨çš„ç©ºé—´ä¸º0ï¼Œæ‰€ä»¥æœªèµ‹å€¼ï¼ˆ<code>Value</code>ï¼‰çš„é”®ï¼ˆ<code>Key</code>ï¼‰åˆå§‹å€¼éƒ½æ˜¯0ã€‚</li>
</ul>
<figure data-type="image" tabindex="27"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109101652362.png" alt="æœªèµ‹å€¼" loading="lazy"></figure>
<figure data-type="image" tabindex="28"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109101902072.png" alt="writema" loading="lazy"></figure>
<h3 id="8-å˜é‡åˆå§‹å€¼">8. å˜é‡åˆå§‹å€¼</h3>
<p>åœ¨<code>solidity</code>ä¸­ï¼Œå£°æ˜ä½†æ²¡èµ‹å€¼çš„å˜é‡éƒ½æœ‰å®ƒçš„åˆå§‹å€¼æˆ–é»˜è®¤å€¼ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¸¸ç”¨å˜é‡çš„åˆå§‹å€¼ã€‚</p>
<h4 id="å€¼ç±»å‹åˆå§‹å€¼">å€¼ç±»å‹åˆå§‹å€¼</h4>
<ul>
<li>
<p><code>boolean</code>: <code>false</code></p>
</li>
<li>
<p><code>string</code>: <code>&quot;&quot;</code></p>
</li>
<li>
<p><code>int</code>: <code>0</code></p>
</li>
<li>
<p><code>uint</code>: <code>0</code></p>
</li>
<li>
<p><code>enum</code>: æšä¸¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
</li>
<li>
<p><code>address</code>: <code>0x0000000000000000000000000000000000000000</code> (æˆ– <code>address(0)</code>)</p>
</li>
<li>
<pre><code>function
</code></pre>
<ul>
<li><code>internal</code>: ç©ºç™½æ–¹ç¨‹</li>
<li><code>external</code>: ç©ºç™½æ–¹ç¨‹</li>
</ul>
</li>
<li>
<p><code>bytes1</code>ï¼š<code>0x00</code></p>
</li>
</ul>
<p>å¯ä»¥ç”¨<code>public</code>å˜é‡çš„<code>getter</code>å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š</p>
<pre><code class="language-solidity">bool public _bool; // false
string public _string; // &quot;&quot;
int public _int; // 0
uint public _uint; // 0
address public _address; // 0x0000000000000000000000000000000000000000

enum ActionSet { Buy, Hold, Sell}
ActionSet public _enum; // ç¬¬ä¸€ä¸ªå…ƒç´  0

function fi() internal{} // internalç©ºç™½æ–¹ç¨‹ 
function fe() external{} // externalç©ºç™½æ–¹ç¨‹ 
</code></pre>
<figure data-type="image" tabindex="29"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109102811871.png" alt="å€¼ç±»å‹åˆå§‹å€¼" loading="lazy"></figure>
<h4 id="å¼•ç”¨ç±»å‹åˆå§‹å€¼">å¼•ç”¨ç±»å‹åˆå§‹å€¼</h4>
<ul>
<li>æ˜ å°„<code>mapping</code>: æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„<code>mapping</code></li>
<li>ç»“æ„ä½“<code>struct</code>: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“</li>
<li>æ•°ç»„<code>array</code>
<ul>
<li>åŠ¨æ€æ•°ç»„: <code>[]</code></li>
<li>é™æ€æ•°ç»„ï¼ˆå®šé•¿ï¼‰: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„</li>
</ul>
</li>
</ul>
<p>å¯ä»¥ç”¨<code>public</code>å˜é‡çš„<code>getter</code>å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š</p>
<pre><code class="language-solidity">// Reference Types
uint[8] public _staticArray; // æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„[0,0,0,0,0,0,0,0]
uint[] public _dynamicArray; // `[]`
mapping(uint =&gt; address) public _mapping; // æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„mapping
// æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“ 0, 0
struct Student{
    uint256 id;
    uint256 score; 
}
Student public student;
</code></pre>
<figure data-type="image" tabindex="30"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109103443921.png" alt="å¼•ç”¨ç±»å‹åˆå§‹åŒ–" loading="lazy"></figure>
<h4 id="deleteæ“ä½œç¬¦"><code>delete</code>æ“ä½œç¬¦</h4>
<p><code>delete a</code>ä¼šè®©å˜é‡<code>a</code>çš„å€¼å˜ä¸ºåˆå§‹å€¼ã€‚</p>
<pre><code class="language-solidity">// deleteæ“ä½œç¬¦
bool public _bool2 = true; 
function d() external {
    delete _bool2; // delete ä¼šè®©_bool2å˜ä¸ºé»˜è®¤å€¼ï¼Œfalse
}
</code></pre>
<figure data-type="image" tabindex="31"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109103603138.png" alt="delete æ“ä½œç¬¦" loading="lazy"></figure>
<h3 id="9-å¸¸æ•°">9. å¸¸æ•°</h3>
<p>ä»‹ç»<code>solidity</code>ä¸­ä¸¤ä¸ªå…³é”®å­—ï¼Œ<code>constant</code>ï¼ˆå¸¸é‡ï¼‰å’Œ<code>immutable</code>ï¼ˆä¸å˜é‡ï¼‰ã€‚çŠ¶æ€å˜é‡å£°æ˜è¿™ä¸ªä¸¤ä¸ªå…³é”®å­—ä¹‹åï¼Œä¸èƒ½åœ¨åˆçº¦åæ›´æ”¹æ•°å€¼ï¼›å¹¶ä¸”è¿˜å¯ä»¥èŠ‚çœ<code>gas</code>ã€‚å¦å¤–ï¼Œåªæœ‰æ•°å€¼å˜é‡å¯ä»¥å£°æ˜<code>constant</code>å’Œ<code>immutable</code>ï¼›<code>string</code>å’Œ<code>bytes</code>å¯ä»¥å£°æ˜ä¸º<code>constant</code>ï¼Œä½†ä¸èƒ½ä¸º<code>immutable</code>ã€‚</p>
<h4 id="constant">constant</h4>
<p><code>constant</code>å˜é‡å¿…é¡»åœ¨<strong>å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ”¹å˜</strong>ã€‚å°è¯•æ”¹å˜çš„è¯ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚</p>
<p><code>constant</code>å˜é‡åˆå§‹åŒ–ä¹‹åï¼Œå°è¯•æ”¹å˜å®ƒçš„å€¼ï¼Œä¼šç¼–è¯‘ä¸é€šè¿‡å¹¶æŠ›å‡º<code>TypeError: Cannot assign to a constant variable.</code>çš„é”™è¯¯ã€‚</p>
<pre><code class="language-solidity">// constantå˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜
uint256 constant CONSTANT_NUM = 10;
string constant CONSTANT_STRING = &quot;0xAA&quot;;
bytes constant CONSTANT_BYTES = &quot;WTF&quot;;
address constant CONSTANT_ADDRESS = 0x0000000000000000000000000000000000000000;
</code></pre>
<h4 id="immutableimmutable-variables-cannot-have-a-non-value-type">immutableï¼ˆImmutable variables cannot have a non-value typeï¼‰</h4>
<p><code>immutable</code>å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚</p>
<pre><code class="language-solidity">// immutableå˜é‡å¯ä»¥åœ¨constructoré‡Œåˆå§‹åŒ–ï¼Œä¹‹åä¸èƒ½æ”¹å˜
uint256 public immutable IMMUTABLE_NUM = 9999999999;
address public immutable IMMUTABLE_ADDRESS;
uint256 public immutable IMMUTABLE_BLOCK;
uint256 public immutable IMMUTABLE_TEST;
</code></pre>
<p>ä½ å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ä¾‹å¦‚<code>address(this)</code>ï¼Œ<code>block.number</code> ï¼Œæˆ–è€…è‡ªå®šä¹‰çš„å‡½æ•°ç»™<code>immutable</code>å˜é‡åˆå§‹åŒ–ã€‚</p>
<p><code>immutable</code>å˜é‡åˆå§‹åŒ–ä¹‹åï¼Œå°è¯•æ”¹å˜å®ƒçš„å€¼ï¼Œä¼šç¼–è¯‘ä¸é€šè¿‡å¹¶æŠ›å‡º<code>TypeError: Immutable state variable already initialized.</code>çš„é”™è¯¯ã€‚</p>
<p>åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†<code>test()</code>å‡½æ•°ç»™<code>IMMUTABLE_TEST</code>åˆå§‹åŒ–ä¸º<code>9</code>ï¼š</p>
<pre><code class="language-solidity">// åˆ©ç”¨constructoråˆå§‹åŒ–immutableå˜é‡ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨
constructor(){
    IMMUTABLE_ADDRESS = address(this);
    IMMUTABLE_BLOCK = block.number;
    IMMUTABLE_TEST = test();
}

function test() public pure returns(uint256){
    uint256 what = 9;
    return(what);
}
</code></pre>
<figure data-type="image" tabindex="32"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109104948188.png" alt="immutable å¸¸é‡" loading="lazy"></figure>
<h3 id="10-æ§åˆ¶æµ">10. æ§åˆ¶æµ</h3>
<p>ä»‹ç»<code>solidity</code>ä¸­çš„æ§åˆ¶æµï¼Œç„¶åè®²å¦‚ä½•ç”¨<code>solidity</code>å®ç°æ’å…¥æ’åºï¼ˆ<code>InsertionSort</code>ï¼‰ï¼Œä¸€ä¸ªçœ‹èµ·æ¥ç®€å•ï¼Œä½†å®é™…ä¸Šå¾ˆå®¹æ˜“å†™å‡º<code>bug</code>çš„ç¨‹åºã€‚</p>
<h4 id="æ§åˆ¶æµç±»å‹">æ§åˆ¶æµç±»å‹</h4>
<p><code>Solidity</code>çš„æ§åˆ¶æµä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li><code>if-else</code></li>
</ol>
<pre><code class="language-solidity">function ifElseTest(uint256 _number) public pure returns(bool){
    if(_number == 0){
    	return(true);
    }else{
    	return(false);
    }
}
</code></pre>
<ol start="2">
<li><code>forå¾ªç¯</code></li>
</ol>
<pre><code class="language-solidity">function forLoopTest() public pure returns(uint256){
    uint sum = 0;
    for(uint i = 0; i &lt; 10; i++){
    	sum += i;
    }
    return(sum);
}
</code></pre>
<ol start="3">
<li><code>whileå¾ªç¯</code></li>
</ol>
<pre><code class="language-solidity">function whileTest() public pure returns(uint256){
    uint sum = 0;
    uint i = 0;
    while(i &lt; 10){
    	sum += i;
    	i++;
    }
    return(sum);
}
</code></pre>
<ol start="4">
<li><code>do-whileå¾ªç¯</code></li>
</ol>
<pre><code class="language-solidity">function doWhileTest() public pure returns(uint256){
    uint sum = 0;
    uint i = 0;
    do{
    	sum += i;
    	i++;
    }while(i &lt; 10);
    return(sum);
}
</code></pre>
<ol start="5">
<li><code>ä¸‰å…ƒè¿ç®—ç¬¦</code> ä¸‰å…ƒè¿ç®—ç¬¦æ˜¯<code>solidity</code>ä¸­å”¯ä¸€ä¸€ä¸ªæ¥å—ä¸‰ä¸ªæ“ä½œæ•°çš„è¿ç®—ç¬¦ï¼Œè§„åˆ™<code>æ¡ä»¶? æ¡ä»¶ä¸ºçœŸçš„è¡¨è¾¾å¼:æ¡ä»¶ä¸ºå‡çš„è¡¨è¾¾å¼</code>ã€‚ æ­¤è¿ç®—ç¬¦ç»å¸¸ç”¨ä½œ if è¯­å¥çš„å¿«æ·æ–¹å¼ã€‚</li>
</ol>
<pre><code class="language-solidity">// ä¸‰å…ƒè¿ç®—ç¬¦ ternary/conditional operator
function ternaryTest(uint256 x, uint256 y) public pure returns(uint256){
    // return the max of x and y
    return x &gt;= y ? x: y; 
}
</code></pre>
<p>å¦å¤–è¿˜æœ‰<code>continue</code>ï¼ˆç«‹å³è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ï¼‰å’Œ<code>break</code>ï¼ˆè·³å‡ºå½“å‰å¾ªç¯ï¼‰å…³é”®å­—å¯ä»¥ä½¿ç”¨ã€‚</p>
<figure data-type="image" tabindex="33"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109130349335.png" alt="æ§åˆ¶æµç®€ä»‹" loading="lazy"></figure>
<h4 id="ç”¨solidityå®ç°æ’å…¥æ’åº">ç”¨solidityå®ç°æ’å…¥æ’åº</h4>
<p>æ’åºç®—æ³•è§£å†³çš„é—®é¢˜æ˜¯å°†æ— åºçš„ä¸€ç»„æ•°å­—ï¼Œä¾‹å¦‚<code>[2, 5, 3, 1]</code>ï¼Œä»å°åˆ°å¤§ä¾æ¬¡æ’åˆ—å¥½ã€‚æ’å…¥æ’åºï¼ˆ<code>InsertionSort</code>ï¼‰æ˜¯æœ€ç®€å•çš„ä¸€ç§æ’åºç®—æ³•ï¼Œä¹Ÿæ˜¯å¾ˆå¤šäººå­¦ä¹ çš„ç¬¬ä¸€ä¸ªç®—æ³•ã€‚å®ƒçš„æ€è·¯å¾ˆç®€ç­”ï¼Œä»å‰å¾€åï¼Œä¾æ¬¡å°†æ¯ä¸€ä¸ªæ•°å’Œæ’åœ¨ä»–å‰é¢çš„æ•°å­—æ¯”å¤§å°ï¼Œå¦‚æœæ¯”å‰é¢çš„æ•°å­—å°ï¼Œå°±äº’æ¢ä½ç½®ã€‚</p>
<h5 id="pythonä»£ç "><code>python</code>ä»£ç </h5>
<p>æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹æ’å…¥æ’åºçš„pythonä»£ç ï¼š</p>
<pre><code class="language-python"># Python program for implementation of Insertion Sort
def insertionSort(arr):
    for i in range(1, len(arr)):
        key = arr[i]
        j = i-1
        while j &gt;=0 and key &lt; arr[j] :
            arr[j+1] = arr[j]
            j -= 1
        arr[j+1] = key
</code></pre>
<pre><code class="language-solidity">// æ’å…¥æ’åº é”™è¯¯ç‰ˆ
function insertionSortWrong(uint[] memory a) public pure returns(uint[] memory) {
    for (uint i = 1;i &lt; a.length;i++){
        uint temp = a[i];
        uint j=i-1;
        while( (j &gt;= 0) &amp;&amp; (temp &lt; a[j])){
            a[j+1] = a[j];
            j--;
    	}
        a[j+1] = temp;
    }
    return(a);
}
</code></pre>
<figure data-type="image" tabindex="34"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109133703767.png" alt="æ’å…¥æ’åºé”™è¯¯ç‰ˆ" loading="lazy"></figure>
<p><code>solidity</code>ä¸­æœ€å¸¸ç”¨çš„å˜é‡ç±»å‹æ˜¯<code>uint</code>ï¼Œä¹Ÿå°±æ˜¯æ­£æ•´æ•°ï¼Œå–åˆ°è´Ÿå€¼çš„è¯ï¼Œä¼šæŠ¥<code>underflow</code>é”™è¯¯ã€‚è€Œåœ¨æ’å…¥ç®—æ³•ä¸­ï¼Œå˜é‡<code>j</code>æœ‰å¯èƒ½ä¼šå–åˆ°<code>-1</code>ï¼Œå¼•èµ·æŠ¥é”™ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠ<code>j</code>åŠ 1ï¼Œè®©å®ƒæ— æ³•å–åˆ°è´Ÿå€¼ã€‚æ­£ç¡®ä»£ç ï¼š</p>
<pre><code class="language-solidity">// æ’å…¥æ’åº æ­£ç¡®ç‰ˆ*
function insertionSort(uint[] memory a) public pure returns(uint[] memory) {
    // note that uint can not take negative value*
    for (uint i = 1;i &lt; a.length;i++){
        uint temp = a[i];
        uint j=i;
        while( (j &gt;= 1) &amp;&amp; (temp &lt; a[j-1])){
            a[j] = a[j-1];
            j--;
        }
        a[j] = temp;
    }
    return(a);
}
</code></pre>
<figure data-type="image" tabindex="35"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109134230450.png" alt="æ’å…¥æ’åºæ­£ç¡®ç‰ˆ" loading="lazy"></figure>
<h3 id="11-æ„é€ å‡½æ•°å’Œä¿®é¥°å™¨">11. æ„é€ å‡½æ•°å’Œä¿®é¥°å™¨</h3>
<p>ç”¨åˆçº¦æƒé™æ§åˆ¶ï¼ˆ<code>Ownable</code>ï¼‰çš„ä¾‹å­ä»‹ç»<code>solidity</code>è¯­è¨€ä¸­æ„é€ å‡½æ•°ï¼ˆ<code>constructor</code>ï¼‰å’Œç‹¬æœ‰çš„ä¿®é¥°å™¨ï¼ˆ<code>modifier</code>ï¼‰ã€‚</p>
<h4 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</h4>
<p>æ„é€ å‡½æ•°ï¼ˆ<code>constructor</code>ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œæ¯ä¸ªåˆçº¦å¯ä»¥<strong>å®šä¹‰ä¸€ä¸ª</strong>ï¼Œå¹¶åœ¨<strong>éƒ¨ç½²åˆçº¦çš„æ—¶å€™è‡ªåŠ¨è¿è¡Œä¸€æ¬¡</strong>ã€‚å®ƒå¯ä»¥ç”¨æ¥<strong>åˆå§‹åŒ–åˆçº¦</strong>çš„ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚åˆå§‹åŒ–åˆçº¦çš„<code>owner</code>åœ°å€ï¼š</p>
<pre><code class="language-solidity">address owner; // å®šä¹‰ownerå˜é‡

// æ„é€ å‡½æ•°
constructor() {
	owner = msg.sender; // åœ¨éƒ¨ç½²åˆçº¦çš„æ—¶å€™ï¼Œå°†ownerè®¾ç½®ä¸ºéƒ¨ç½²è€…çš„åœ°å€
}
</code></pre>
<p><strong>æ³¨æ„</strong>âš ï¸ï¼šæ„é€ å‡½æ•°åœ¨ä¸åŒçš„solidityç‰ˆæœ¬ä¸­çš„è¯­æ³•å¹¶ä¸ä¸€è‡´ï¼Œåœ¨Solidity 0.4.22ä¹‹å‰ï¼Œæ„é€ å‡½æ•°ä¸ä½¿ç”¨ <code>constructor</code> è€Œæ˜¯ä½¿ç”¨ä¸åˆçº¦ååŒåçš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°è€Œä½¿ç”¨ï¼Œç”±äºè¿™ç§æ—§å†™æ³•å®¹æ˜“ä½¿å¼€å‘è€…åœ¨ä¹¦å†™æ—¶å‘ç”Ÿç–æ¼ï¼ˆä¾‹å¦‚åˆçº¦åå« <code>Parents</code>ï¼Œæ„é€ å‡½æ•°åå†™æˆ <code>parents</code>ï¼‰ï¼Œä½¿å¾—æ„é€ å‡½æ•°å˜æˆæ™®é€šå‡½æ•°ï¼Œå¼•å‘æ¼æ´ï¼Œæ‰€ä»¥0.4.22ç‰ˆæœ¬åŠä¹‹åï¼Œé‡‡ç”¨äº†å…¨æ–°çš„ <code>constructor</code> å†™æ³•ã€‚</p>
<p>æ„é€ å‡½æ•°çš„æ—§å†™æ³•ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-solidity">pragma solidity =0.4.21;
contract Parents {
    // ä¸åˆçº¦åParentsåŒåçš„å‡½æ•°å°±æ˜¯æ„é€ å‡½æ•°
    function Parents () public {
    }
}
</code></pre>
<h4 id="ä¿®é¥°å™¨">ä¿®é¥°å™¨</h4>
<p>ä¿®é¥°å™¨ï¼ˆ<code>modifier</code>ï¼‰æ˜¯<code>solidity</code>ç‰¹æœ‰çš„è¯­æ³•ï¼Œç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„<code>decorator</code>ï¼Œå£°æ˜<strong>å‡½æ•°æ‹¥æœ‰çš„ç‰¹æ€§ï¼Œå¹¶å‡å°‘ä»£ç å†—ä½™</strong>ã€‚å®ƒå°±åƒé’¢é“ä¾ çš„æ™ºèƒ½ç›”ç”²ï¼Œç©¿ä¸Šå®ƒçš„å‡½æ•°ä¼šå¸¦æœ‰æŸäº›ç‰¹å®šçš„è¡Œä¸ºã€‚<code>modifier</code>çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯<strong>è¿è¡Œå‡½æ•°å‰çš„æ£€æŸ¥ï¼Œä¾‹å¦‚åœ°å€ï¼Œå˜é‡ï¼Œä½™é¢</strong>ç­‰ã€‚</p>
<p>æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªå«åšonlyOwnerçš„modifierï¼š</p>
<pre><code class="language-solidity">// å®šä¹‰modifier
modifier onlyOwner {
    require(msg.sender == owner); // æ£€æŸ¥è°ƒç”¨è€…æ˜¯å¦ä¸ºowneråœ°å€
    _; // å¦‚æœæ˜¯çš„è¯ï¼Œç»§ç»­è¿è¡Œå‡½æ•°ä¸»ä½“ï¼›å¦åˆ™æŠ¥é”™å¹¶revertäº¤æ˜“
}
</code></pre>
<p>ä»£æœ‰<code>onlyOwner</code>ä¿®é¥°ç¬¦çš„å‡½æ•°åªèƒ½è¢«<code>owner</code>åœ°å€è°ƒç”¨ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-solidity">function changeOwner(address _newOwner) external onlyOwner{
    owner = _newOwner; // åªæœ‰owneråœ°å€è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå¹¶æ”¹å˜owner
}
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>changeOwner</code>å‡½æ•°ï¼Œè¿è¡Œä»–å¯ä»¥æ”¹å˜åˆçº¦çš„<code>owner</code>ï¼Œä½†æ˜¯ç”±äº<code>onlyOwner</code>ä¿®é¥°ç¬¦çš„å­˜åœ¨ï¼Œåªæœ‰åŸå…ˆçš„<code>owner</code>å¯ä»¥è°ƒç”¨ï¼Œåˆ«äººè°ƒç”¨å°±ä¼šæŠ¥é”™ã€‚è¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ§åˆ¶æ™ºèƒ½åˆçº¦æƒé™çš„æ–¹æ³•ã€‚</p>
<figure data-type="image" tabindex="36"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109143515517.png" alt="æŸ¥çœ‹owner" loading="lazy"></figure>
<figure data-type="image" tabindex="37"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109143910469.png" alt="ä»¥ownerèº«ä»½è°ƒç”¨changeå‡½æ•°" loading="lazy"></figure>
<figure data-type="image" tabindex="38"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221109144203709.png" alt="éownerè´¦æˆ·åœ°å€ï¼Œè°ƒç”¨æŠ¥é”™" loading="lazy"></figure>
<h3 id="12-äº‹ä»¶">12. äº‹ä»¶</h3>
<p><code>Solidity</code>ä¸­çš„äº‹ä»¶ï¼ˆ<code>event</code>ï¼‰æ˜¯<code>EVM</code>ä¸Šæ—¥å¿—çš„æŠ½è±¡ï¼Œå®ƒå…·æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>å“åº”ï¼šåº”ç”¨ç¨‹åºï¼ˆ<a href="https://learnblockchain.cn/docs/ethers.js/api-contract.html#id18"><code>ether.js</code></a>ï¼‰å¯ä»¥é€šè¿‡<code>RPC</code>æ¥å£è®¢é˜…å’Œç›‘å¬è¿™äº›äº‹ä»¶ï¼Œå¹¶åœ¨å‰ç«¯åšå“åº”ã€‚</li>
<li>ç»æµï¼šäº‹ä»¶æ˜¯<code>EVM</code>ä¸Šæ¯”è¾ƒç»æµçš„å­˜å‚¨æ•°æ®çš„æ–¹å¼ï¼Œæ¯ä¸ªå¤§æ¦‚æ¶ˆè€—2,000 <code>gas</code>ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œé“¾ä¸Šå­˜å‚¨ä¸€ä¸ªæ–°å˜é‡è‡³å°‘éœ€è¦20,000 <code>gas</code>ã€‚</li>
</ul>
<h4 id="è§„åˆ™">è§„åˆ™</h4>
<p>äº‹ä»¶çš„å£°æ˜ç”±<code>event</code>å…³é”®å­—å¼€å¤´ï¼Œç„¶åè·Ÿ<strong>äº‹ä»¶åç§°</strong>ï¼Œæ‹¬å·é‡Œé¢å†™å¥½äº‹ä»¶<strong>éœ€è¦è®°å½•çš„å˜é‡ç±»å‹å’Œå˜é‡å</strong>ã€‚ä»¥<code>ERC20</code>ä»£å¸åˆçº¦çš„<code>Transfer</code>äº‹ä»¶ä¸ºä¾‹ï¼š</p>
<pre><code class="language-solidity">event Transfer(address indexed from, address indexed to, uint256 value);
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>Transfer</code>äº‹ä»¶å…±è®°å½•äº†3ä¸ªå˜é‡<code>from</code>ï¼Œ<code>to</code>å’Œ<code>value</code>ï¼Œåˆ†åˆ«å¯¹åº”ä»£å¸çš„è½¬è´¦åœ°å€ï¼Œæ¥æ”¶åœ°å€å’Œè½¬è´¦æ•°é‡ã€‚</p>
<p>åŒæ—¶<code>from</code>å’Œ<code>to</code>å‰é¢å¸¦ç€<code>indexed</code>å…³é”®å­—ï¼Œæ¯ä¸ª<code>indexed</code>æ ‡è®°çš„å˜é‡å¯ä»¥ç†è§£<strong>ä¸ºæ£€ç´¢äº‹ä»¶çš„ç´¢å¼•â€œé”®â€</strong>ï¼Œåœ¨ä»¥å¤ªåŠä¸Šå•ç‹¬ä½œä¸ºä¸€ä¸ª<code>topic</code>è¿›è¡Œå­˜å‚¨å’Œç´¢å¼•ï¼Œç¨‹åºå¯ä»¥è½»æ¾çš„ç­›é€‰å‡ºç‰¹å®šè½¬è´¦åœ°å€å’Œæ¥æ”¶åœ°å€çš„è½¬è´¦äº‹ä»¶ã€‚æ¯ä¸ª<strong>äº‹ä»¶æœ€å¤šæœ‰3ä¸ª</strong>å¸¦<code>indexed</code>çš„å˜é‡ã€‚æ¯ä¸ª <code>indexed</code> å˜é‡çš„å¤§å°ä¸ºå›ºå®šçš„256æ¯”ç‰¹ã€‚äº‹ä»¶çš„å“ˆå¸Œä»¥åŠè¿™ä¸‰ä¸ªå¸¦<code>indexed</code>çš„å˜é‡åœ¨<code>EVM</code>æ—¥å¿—ä¸­é€šå¸¸è¢«å­˜å‚¨ä¸º<code>topic</code>ã€‚å…¶ä¸­<code>topic[0]</code>æ˜¯æ­¤äº‹ä»¶çš„<code>keccak256</code>å“ˆå¸Œï¼Œ<code>topic[1]</code>åˆ°<code>topic[3]</code>å­˜å‚¨äº†å¸¦<code>indexed</code>å˜é‡çš„<code>keccak256</code>å“ˆå¸Œã€‚</p>
<p><code>value</code> ä¸å¸¦ <code>indexed</code> å…³é”®å­—ï¼Œä¼šå­˜å‚¨åœ¨äº‹ä»¶çš„ <code>data</code> éƒ¨åˆ†ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºäº‹ä»¶çš„â€œå€¼â€ã€‚<code>data</code> éƒ¨åˆ†çš„å˜é‡ä¸èƒ½è¢«ç›´æ¥æ£€ç´¢ï¼Œä½†å¯ä»¥å­˜å‚¨ä»»æ„å¤§å°çš„æ•°æ®ã€‚å› æ­¤ä¸€èˆ¬ <code>data</code> éƒ¨åˆ†å¯ä»¥ç”¨æ¥å­˜å‚¨å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚æ•°ç»„å’Œå­—ç¬¦ä¸²ç­‰ç­‰ï¼Œå› ä¸ºè¿™äº›æ•°æ®è¶…è¿‡äº†256æ¯”ç‰¹ï¼Œå³ä½¿å­˜å‚¨åœ¨äº‹ä»¶çš„ <code>topic</code> éƒ¨åˆ†ä¸­ï¼Œä¹Ÿæ˜¯ä»¥å“ˆå¸Œçš„æ–¹å¼å­˜å‚¨ã€‚å¦å¤–ï¼Œ<code>data</code> éƒ¨åˆ†çš„å˜é‡åœ¨å­˜å‚¨ä¸Šæ¶ˆè€—çš„gasç›¸æ¯”äº <code>topic</code> æ›´å°‘ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œé‡Šæ”¾äº‹ä»¶ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ¯æ¬¡ç”¨<code>_transfer()</code>å‡½æ•°è¿›è¡Œè½¬è´¦æ“ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šé‡Šæ”¾<code>Transfer</code>äº‹ä»¶ï¼Œå¹¶è®°å½•ç›¸åº”çš„å˜é‡ã€‚</p>
<pre><code class="language-solidity">// å®šä¹‰_transferå‡½æ•°ï¼Œæ‰§è¡Œè½¬è´¦é€»è¾‘
function _transfer(
    address from,
    address to,
    uint256 amount
) external {
    _balances[from] = 10000000; // ç»™è½¬è´¦åœ°å€ä¸€äº›åˆå§‹ä»£å¸

    _balances[from] -=  amount; // fromåœ°å€å‡å»è½¬è´¦æ•°é‡
    _balances[to] += amount; // toåœ°å€åŠ ä¸Šè½¬è´¦æ•°é‡

    // é‡Šæ”¾äº‹ä»¶
    emit Transfer(from, to, amount);
}
</code></pre>
<figure data-type="image" tabindex="39"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110103328402.png" alt="å‘èµ·transferäº¤æ˜“" loading="lazy"></figure>
<figure data-type="image" tabindex="40"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110103621003.png" alt="å…·ä½“å†…å®¹" loading="lazy"></figure>
<h3 id="13-ç»§æ‰¿">13. ç»§æ‰¿</h3>
<p>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹å¾ˆé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘é‡å¤ä»£ç ã€‚å¦‚æœæŠŠåˆçº¦çœ‹ä½œæ˜¯å¯¹è±¡çš„è¯ï¼Œ<code>solidity</code>ä¹Ÿæ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼Œä¹Ÿæ”¯æŒç»§æ‰¿ã€‚</p>
<h4 id="è§„åˆ™-2">è§„åˆ™</h4>
<ul>
<li><code>virtual</code>: çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œå¦‚æœå¸Œæœ›å­åˆçº¦é‡å†™ï¼Œéœ€è¦åŠ ä¸Š<code>virtual</code>å…³é”®å­—ã€‚</li>
<li><code>override</code>ï¼šå­åˆçº¦é‡å†™äº†çˆ¶åˆçº¦ä¸­çš„å‡½æ•°ï¼Œéœ€è¦åŠ ä¸Š<code>override</code>å…³é”®å­—ã€‚</li>
</ul>
<h4 id="ç®€å•ç»§æ‰¿">ç®€å•ç»§æ‰¿</h4>
<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„çˆ·çˆ·åˆçº¦<code>Yeye</code>ï¼Œé‡Œé¢åŒ…å«1ä¸ª<code>Log</code>äº‹ä»¶å’Œ3ä¸ª<code>function</code>: <code>hip()</code>, <code>pop()</code>, <code>yeye()</code>ï¼Œè¾“å‡ºéƒ½æ˜¯â€Yeyeâ€ã€‚</p>
<pre><code class="language-solidity">contract Yeye {
    event Log(string msg);

    // å®šä¹‰3ä¸ªfunction: hip(), pop(), man()ï¼ŒLogå€¼ä¸ºYeyeã€‚
    function hip() public virtual{
        emit Log(&quot;Yeye&quot;);
    }

    function pop() public virtual{
        emit Log(&quot;Yeye&quot;);
    }

    function yeye() public virtual {
        emit Log(&quot;Yeye&quot;);
    }
}
</code></pre>
<p>æˆ‘ä»¬å†å®šä¹‰ä¸€ä¸ªçˆ¸çˆ¸åˆçº¦<code>Baba</code>ï¼Œè®©ä»–ç»§æ‰¿<code>Yeye</code>åˆçº¦ï¼Œè¯­æ³•å°±æ˜¯<code>contract Baba is Yeye</code>ï¼Œéå¸¸ç›´è§‚ã€‚åœ¨<code>Baba</code>åˆçº¦é‡Œï¼Œæˆ‘ä»¬é‡å†™ä¸€ä¸‹<code>hip()</code>å’Œ<code>pop()</code>è¿™ä¸¤ä¸ªå‡½æ•°ï¼ŒåŠ ä¸Š<code>override</code>å…³é”®å­—ï¼Œå¹¶å°†ä»–ä»¬çš„è¾“å‡ºæ”¹ä¸º<code>â€Babaâ€</code>ï¼›å¹¶ä¸”åŠ ä¸€ä¸ªæ–°çš„å‡½æ•°<code>baba</code>ï¼Œè¾“å‡ºä¹Ÿæ˜¯<code>â€Babaâ€</code>ã€‚</p>
<pre><code class="language-solidity">contract Baba is Yeye{
    // ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºæ”¹ä¸ºBabaã€‚
    function hip() public virtual override{
        emit Log(&quot;Baba&quot;);
    }

    function pop() public virtual override{
        emit Log(&quot;Baba&quot;);
    }

    function baba() public virtual{
        emit Log(&quot;Baba&quot;);
    }
}
</code></pre>
<p>æˆ‘ä»¬éƒ¨ç½²åˆçº¦ï¼Œå¯ä»¥çœ‹åˆ°<code>Baba</code>åˆçº¦é‡Œæœ‰4ä¸ªå‡½æ•°ï¼Œå…¶ä¸­<code>hip()</code>å’Œ<code>pop()</code>çš„è¾“å‡ºè¢«æˆåŠŸæ”¹å†™æˆ<code>â€Babaâ€</code>ï¼Œè€Œç»§æ‰¿æ¥çš„<code>yeye()</code>çš„è¾“å‡ºä»ç„¶æ˜¯<code>â€Yeyeâ€</code>ã€‚</p>
<figure data-type="image" tabindex="41"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110104822210.png" alt="BABA ç»§æ‰¿ Yeye" loading="lazy"></figure>
<h4 id="å¤šé‡ç»§æ‰¿">å¤šé‡ç»§æ‰¿</h4>
<p><code>solidity</code>çš„åˆçº¦å¯ä»¥ç»§æ‰¿å¤šä¸ªåˆçº¦ã€‚è§„åˆ™ï¼š</p>
<p>ç»§æ‰¿æ—¶è¦æŒ‰è¾ˆåˆ†<strong>æœ€é«˜åˆ°æœ€ä½çš„é¡ºåºæ’</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬å†™ä¸€ä¸ª<code>Erzi</code>åˆçº¦ï¼Œç»§æ‰¿<code>Yeye</code>åˆçº¦å’Œ<code>Baba</code>åˆçº¦ï¼Œé‚£ä¹ˆå°±è¦å†™æˆ<code>contract Erzi is Yeye, Baba</code>ï¼Œè€Œä¸èƒ½å†™æˆ<code>contract Erzi is Baba, Yeye</code>ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ã€‚ å¦‚æœæŸä¸€ä¸ªå‡½æ•°åœ¨å¤šä¸ªç»§æ‰¿çš„åˆçº¦é‡Œéƒ½å­˜åœ¨ï¼Œæ¯”å¦‚ä¾‹å­ä¸­çš„<code>hip()</code>å’Œ<code>pop()</code>ï¼Œåœ¨<strong>å­åˆçº¦é‡Œå¿…é¡»é‡å†™</strong>ï¼Œä¸ç„¶ä¼šæŠ¥é”™ã€‚ é‡å†™åœ¨<strong>å¤šä¸ªçˆ¶åˆçº¦ä¸­éƒ½é‡å</strong>çš„å‡½æ•°æ—¶ï¼Œ<code>override</code>å…³é”®å­—åé¢è¦<strong>åŠ ä¸Šæ‰€æœ‰çˆ¶åˆçº¦åå­—</strong>ï¼Œä¾‹å¦‚<code>override(Yeye, Baba)</code>ã€‚ ä¾‹å­ï¼š</p>
<pre><code class="language-solidity">contract Erzi is Yeye, Baba{
// ç»§æ‰¿ä¸¤ä¸ªfunction: hip()å’Œpop()ï¼Œè¾“å‡ºå€¼ä¸ºErziã€‚
    function hip() public virtual override(Yeye, Baba){
    	emit Log(&quot;Erzi&quot;);
    }

    function pop() public virtual override(Yeye, Baba) {
    	emit Log(&quot;Erzi&quot;);
	}
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>Erzi</code>åˆçº¦é‡Œé¢é‡å†™äº†<code>hip()</code>å’Œ<code>pop()</code>ä¸¤ä¸ªå‡½æ•°ï¼Œå°†è¾“å‡ºæ”¹ä¸º<code>â€Erziâ€</code>ï¼Œå¹¶ä¸”è¿˜åˆ†åˆ«ä»<code>Yeye</code>å’Œ<code>Baba</code>åˆçº¦ç»§æ‰¿äº†<code>yeye()</code>å’Œ<code>baba()</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="42"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110105230795.png" alt="å¤šé‡ç»§æ‰¿" loading="lazy"></figure>
<h4 id="ä¿®é¥°å™¨çš„ç»§æ‰¿">ä¿®é¥°å™¨çš„ç»§æ‰¿</h4>
<p><code>Solidity</code>ä¸­çš„ä¿®é¥°å™¨ï¼ˆ<code>Modifier</code>ï¼‰åŒæ ·å¯ä»¥ç»§æ‰¿ï¼Œç”¨æ³•ä¸å‡½æ•°ç»§æ‰¿ç±»ä¼¼ï¼Œåœ¨ç›¸åº”çš„åœ°æ–¹åŠ <code>virtual</code>å’Œ<code>override</code>å…³é”®å­—å³å¯ã€‚</p>
<pre><code class="language-solidity">contract Base1 {
    modifier exactDividedBy2And3(uint _a) virtual {
        require(_a % 2 == 0 &amp;&amp; _a % 3 == 0);
        _;
    }
}

contract Identifier is Base1 {

    //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼ï¼Œä½†æ˜¯ä¼ å…¥çš„å‚æ•°å¿…é¡»æ˜¯2å’Œ3çš„å€æ•°
    function getExactDividedBy2And3(uint _dividend) public exactDividedBy2And3(_dividend) pure returns(uint, uint) {
        return getExactDividedBy2And3WithoutModifier(_dividend);
    }

    //è®¡ç®—ä¸€ä¸ªæ•°åˆ†åˆ«è¢«2é™¤å’Œè¢«3é™¤çš„å€¼
    function getExactDividedBy2And3WithoutModifier(uint _dividend) public pure returns(uint, uint){
        uint div2 = _dividend / 2;
        uint div3 = _dividend / 3;
        return (div2, div3);
    }
}
</code></pre>
<figure data-type="image" tabindex="43"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110110533752.png" alt="ä¿®é¥°å™¨çš„ç»§æ‰¿" loading="lazy"></figure>
<p><code>Identifier</code>åˆçº¦å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­ä½¿ç”¨çˆ¶åˆçº¦ä¸­çš„<code>exactDividedBy2And3</code>ä¿®é¥°å™¨ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨<code>override</code>å…³é”®å­—é‡å†™ä¿®é¥°å™¨ï¼š</p>
<pre><code class="language-solidity">modifier exactDividedBy2And3(uint _a) override {
    _;
    require(_a % 2 == 0 &amp;&amp; _a % 3 == 0);
}
</code></pre>
<h4 id="æ„é€ å‡½æ•°çš„ç»§æ‰¿">æ„é€ å‡½æ•°çš„ç»§æ‰¿</h4>
<p>å­åˆçº¦æœ‰ä¸¤ç§æ–¹æ³•ç»§æ‰¿çˆ¶åˆçº¦çš„æ„é€ å‡½æ•°ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œçˆ¶åˆçº¦<code>A</code>é‡Œé¢æœ‰ä¸€ä¸ªçŠ¶æ€å˜é‡<code>a</code>ï¼Œå¹¶ç”±æ„é€ å‡½æ•°çš„å‚æ•°æ¥ç¡®å®šï¼š</p>
<pre><code class="language-solidity">// æ„é€ å‡½æ•°çš„ç»§æ‰¿
abstract contract A {
    uint public a;
    constructor(uint _a) {
        a = _a;
    }
}
</code></pre>
<ol>
<li>åœ¨ç»§æ‰¿æ—¶å£°æ˜çˆ¶æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>contract B is A(1)</code></li>
<li>åœ¨å­åˆçº¦çš„æ„é€ å‡½æ•°ä¸­å£°æ˜æ„é€ å‡½æ•°çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š</li>
</ol>
<pre><code class="language-solidity">contract C is A {
    constructor(uint _c) A(_c * _c) {}
}
</code></pre>
<figure data-type="image" tabindex="44"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110130451581.png" alt="è¾“å…¥å‚æ•°éƒ¨ç½²åˆçº¦" loading="lazy"></figure>
<figure data-type="image" tabindex="45"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110130644330.png" alt="æŸ¥çœ‹açš„å€¼" loading="lazy"></figure>
<h4 id="è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°">è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°</h4>
<p>å­åˆçº¦æœ‰ä¸¤ç§æ–¹å¼è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨å’Œåˆ©ç”¨<code>super</code>å…³é”®å­—ã€‚</p>
<ol>
<li>ç›´æ¥è°ƒç”¨ï¼šå­åˆçº¦å¯ä»¥ç›´æ¥ç”¨<code>çˆ¶åˆçº¦å.å‡½æ•°å()</code>çš„æ–¹å¼æ¥è°ƒç”¨çˆ¶åˆçº¦å‡½æ•°ï¼Œä¾‹å¦‚<code>Yeye.pop()</code>ã€‚</li>
</ol>
<pre><code class="language-solidity">function callParent() public{
	Yeye.pop();
}
</code></pre>
<ol start="2">
<li><code>super</code>å…³é”®å­—ï¼šå­åˆçº¦å¯ä»¥åˆ©ç”¨<code>super.å‡½æ•°å()</code>æ¥è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ã€‚<code>solidity</code>ç»§æ‰¿å…³ç³»æŒ‰å£°æ˜æ—¶ä»å³åˆ°å·¦çš„é¡ºåºæ˜¯ï¼š<code>contract Erzi is Yeye, Baba</code>ï¼Œé‚£ä¹ˆ<code>Baba</code>æ˜¯<strong>æœ€è¿‘çš„çˆ¶åˆçº¦</strong>ï¼Œ<code>super.pop()</code>å°†è°ƒç”¨<code>Baba.pop()</code>è€Œä¸æ˜¯<code>Yeye.pop()</code>ï¼š</li>
</ol>
<pre><code class="language-solidity">function callParentSuper() public{
    // å°†è°ƒç”¨æœ€è¿‘çš„çˆ¶åˆçº¦å‡½æ•°ï¼ŒBaba.pop()
    super.pop();
}
</code></pre>
<figure data-type="image" tabindex="46"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110130028088.png" alt="è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°" loading="lazy"></figure>
<h3 id="14-æŠ½è±¡åˆçº¦ä¸æ¥å£">14. æŠ½è±¡åˆçº¦ä¸æ¥å£</h3>
<p>ç”¨<code>ERC721</code>çš„æ¥å£åˆçº¦ä¸ºä¾‹ä»‹ç»<code>solidity</code>ä¸­çš„æŠ½è±¡åˆçº¦ï¼ˆ<code>abstract</code>ï¼‰å’Œæ¥å£ï¼ˆ<code>interface</code>ï¼‰ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½çš„ç†è§£<code>ERC721</code>æ ‡å‡†ã€‚</p>
<h4 id="æŠ½è±¡åˆçº¦">æŠ½è±¡åˆçº¦</h4>
<p>å¦‚æœä¸€ä¸ªæ™ºèƒ½åˆçº¦é‡Œ<strong>è‡³å°‘æœ‰ä¸€ä¸ªæœªå®ç°çš„å‡½æ•°</strong>ï¼Œå³æŸä¸ªå‡½æ•°ç¼ºå°‘ä¸»ä½“<code>{}</code>ä¸­çš„å†…å®¹ï¼Œåˆ™å¿…é¡»å°†è¯¥åˆçº¦æ ‡ä¸º<code>abstract</code>ï¼Œä¸ç„¶ç¼–è¯‘ä¼šæŠ¥é”™ï¼›å¦å¤–ï¼Œæœªå®ç°çš„å‡½æ•°<strong>éœ€è¦åŠ </strong><code>virtual</code>ï¼Œä»¥ä¾¿å­åˆçº¦é‡å†™ã€‚æ‹¿æˆ‘ä»¬ä¹‹å‰çš„<a href="https://github.com/AmazingAng/WTFSolidity/tree/main/07_InsertionSort">æ’å…¥æ’åºåˆçº¦</a>ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æ²¡æƒ³å¥½å…·ä½“æ€ä¹ˆå®ç°æ’å…¥æ’åºå‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠåˆçº¦æ ‡ä¸º<code>abstract</code>ï¼Œä¹‹åè®©åˆ«äººè¡¥å†™ä¸Šã€‚</p>
<pre><code class="language-solidity">abstract contract InsertionSort{
    function insertionSort(uint[] memory a) public pure virtual returns(uint[] memory);
}
</code></pre>
<figure data-type="image" tabindex="47"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110131826591.png" alt="æŠ½è±¡åˆçº¦" loading="lazy"></figure>
<h4 id="æ¥å£">æ¥å£</h4>
<p>æ¥å£ç±»ä¼¼äºæŠ½è±¡åˆçº¦ï¼Œ<strong>ä½†å®ƒä¸å®ç°ä»»ä½•åŠŸèƒ½</strong>ã€‚æ¥å£çš„è§„åˆ™ï¼š</p>
<ol>
<li>ä¸èƒ½åŒ…å«çŠ¶æ€å˜é‡</li>
<li>ä¸èƒ½åŒ…å«æ„é€ å‡½æ•°</li>
<li>ä¸èƒ½ç»§æ‰¿é™¤æ¥å£å¤–çš„å…¶ä»–åˆçº¦</li>
<li><strong>æ‰€æœ‰å‡½æ•°éƒ½å¿…é¡»æ˜¯externalä¸”ä¸èƒ½æœ‰å‡½æ•°ä½“</strong></li>
<li>ç»§æ‰¿æ¥å£çš„åˆçº¦<strong>å¿…é¡»å®ç°æ¥å£å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½</strong></li>
</ol>
<p>è™½ç„¶æ¥å£ä¸å®ç°ä»»ä½•åŠŸèƒ½ï¼Œä½†å®ƒéå¸¸é‡è¦ã€‚æ¥å£æ˜¯æ™ºèƒ½åˆçº¦çš„éª¨æ¶ï¼Œå®šä¹‰äº†åˆçº¦çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•è§¦å‘å®ƒä»¬ï¼šå¦‚æœæ™ºèƒ½åˆçº¦å®ç°äº†æŸç§æ¥å£ï¼ˆæ¯”å¦‚<code>ERC20</code>æˆ–<code>ERC721</code>ï¼‰ï¼Œå…¶ä»–Dappså’Œæ™ºèƒ½åˆçº¦å°±çŸ¥é“å¦‚ä½•ä¸å®ƒäº¤äº’ã€‚å› ä¸ºæ¥å£æä¾›äº†ä¸¤ä¸ªé‡è¦çš„ä¿¡æ¯ï¼š</p>
<ol>
<li>åˆçº¦é‡Œæ¯ä¸ªå‡½æ•°çš„<code>bytes4</code>é€‰æ‹©å™¨ï¼Œä»¥åŠåŸºäºå®ƒä»¬çš„å‡½æ•°ç­¾å<code>å‡½æ•°å(æ¯ä¸ªå‚æ•°ç±»å‹ï¼‰</code>ã€‚</li>
<li>æ¥å£idï¼ˆæ›´å¤šä¿¡æ¯è§<a href="https://eips.ethereum.org/EIPS/eip-165">EIP165</a>ï¼‰</li>
</ol>
<p>å¦å¤–ï¼Œæ¥å£ä¸åˆçº¦<code>ABI</code>ï¼ˆApplication Binary Interfaceï¼‰ç­‰ä»·ï¼Œå¯ä»¥ç›¸äº’è½¬æ¢ï¼šç¼–è¯‘æ¥å£å¯ä»¥å¾—åˆ°åˆçº¦çš„<code>ABI</code>ï¼Œåˆ©ç”¨<a href="https://gnidan.github.io/abi-to-sol/">abi-to-solå·¥å…·</a>ä¹Ÿå¯ä»¥å°†<code>ABI json</code>æ–‡ä»¶è½¬æ¢ä¸º<code>æ¥å£sol</code>æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬ä»¥<code>ERC721</code>æ¥å£åˆçº¦<code>IERC721</code>ä¸ºä¾‹ï¼Œå®ƒå®šä¹‰äº†3ä¸ª<code>event</code>å’Œ9ä¸ª<code>function</code>ï¼Œæ‰€æœ‰<code>ERC721</code>æ ‡å‡†çš„NFTéƒ½å®ç°äº†è¿™äº›å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>æ¥å£å’Œå¸¸è§„åˆçº¦çš„åŒºåˆ«</strong>åœ¨äºæ¯ä¸ªå‡½æ•°éƒ½ä»¥<code>;</code>ä»£æ›¿å‡½æ•°ä½“<code>{ }</code>ç»“å°¾ã€‚</p>
<pre><code class="language-solidity">interface IERC721 is IERC165 {
    event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);
    event Approval(address indexed owner, address indexed approved, uint256 indexed tokenId);
    event ApprovalForAll(address indexed owner, address indexed operator, bool approved);
    
    function balanceOf(address owner) external view returns (uint256 balance);

    function ownerOf(uint256 tokenId) external view returns (address owner);

    function safeTransferFrom(address from, address to, uint256 tokenId) external;

    function transferFrom(address from, address to, uint256 tokenId) external;

    function approve(address to, uint256 tokenId) external;

    function getApproved(uint256 tokenId) external view returns (address operator);

    function setApprovalForAll(address operator, bool _approved) external;

    function isApprovedForAll(address owner, address operator) external view returns (bool);

    function safeTransferFrom( address from, address to, uint256 tokenId, bytes calldata data) external;
}
</code></pre>
<h5 id="ierc721äº‹ä»¶">IERC721äº‹ä»¶</h5>
<p><code>IERC721</code>åŒ…å«3ä¸ªäº‹ä»¶ï¼Œå…¶ä¸­<code>Transfer</code>å’Œ<code>Approval</code>äº‹ä»¶åœ¨<code>ERC20</code>ä¸­ä¹Ÿæœ‰ã€‚</p>
<ul>
<li><code>Transfer</code>äº‹ä»¶ï¼šåœ¨è½¬è´¦æ—¶è¢«é‡Šæ”¾ï¼Œè®°å½•ä»£å¸çš„å‘å‡ºåœ°å€<code>from</code>ï¼Œæ¥æ”¶åœ°å€<code>to</code>å’Œ<code>tokenid</code>ã€‚</li>
<li><code>Approval</code>äº‹ä»¶ï¼šåœ¨æˆæƒæ—¶é‡Šæ”¾ï¼Œè®°å½•æˆæƒåœ°å€<code>owner</code>ï¼Œè¢«æˆæƒåœ°å€<code>approved</code>å’Œ<code>tokenid</code>ã€‚</li>
<li><code>ApprovalForAll</code>äº‹ä»¶ï¼šåœ¨æ‰¹é‡æˆæƒæ—¶é‡Šæ”¾ï¼Œè®°å½•æ‰¹é‡æˆæƒçš„å‘å‡ºåœ°å€<code>owner</code>ï¼Œè¢«æˆæƒåœ°å€<code>operator</code>å’Œæˆæƒä¸å¦çš„<code>approved</code>ã€‚</li>
</ul>
<h5 id="ierc721å‡½æ•°">IERC721å‡½æ•°</h5>
<ul>
<li><code>balanceOf</code>ï¼šè¿”å›æŸåœ°å€çš„NFTæŒæœ‰é‡<code>balance</code>ã€‚</li>
<li><code>ownerOf</code>ï¼šè¿”å›æŸ<code>tokenId</code>çš„ä¸»äºº<code>owner</code>ã€‚</li>
<li><code>transferFrom</code>ï¼šæ™®é€šè½¬è´¦ï¼Œå‚æ•°ä¸ºè½¬å‡ºåœ°å€<code>from</code>ï¼Œæ¥æ”¶åœ°å€<code>to</code>å’Œ<code>tokenId</code>ã€‚</li>
<li><code>safeTransferFrom</code>ï¼šå®‰å…¨è½¬è´¦ï¼ˆå¦‚æœæ¥æ”¶æ–¹æ˜¯åˆçº¦åœ°å€ï¼Œä¼šè¦æ±‚å®ç°<code>ERC721Receiver</code>æ¥å£ï¼‰ã€‚å‚æ•°ä¸ºè½¬å‡ºåœ°å€<code>from</code>ï¼Œæ¥æ”¶åœ°å€<code>to</code>å’Œ<code>tokenId</code>ã€‚</li>
<li><code>approve</code>ï¼šæˆæƒå¦ä¸€ä¸ªåœ°å€ä½¿ç”¨ä½ çš„NFTã€‚å‚æ•°ä¸ºè¢«æˆæƒåœ°å€<code>approve</code>å’Œ<code>tokenId</code>ã€‚</li>
<li><code>getApproved</code>ï¼šæŸ¥è¯¢<code>tokenId</code>è¢«æ‰¹å‡†ç»™äº†å“ªä¸ªåœ°å€ã€‚</li>
<li><code>setApprovalForAll</code>ï¼šå°†è‡ªå·±æŒæœ‰çš„è¯¥ç³»åˆ—NFTæ‰¹é‡æˆæƒç»™æŸä¸ªåœ°å€<code>operator</code>ã€‚</li>
<li><code>isApprovedForAll</code>ï¼šæŸ¥è¯¢æŸåœ°å€çš„NFTæ˜¯å¦æ‰¹é‡æˆæƒç»™äº†å¦ä¸€ä¸ª<code>operator</code>åœ°å€ã€‚</li>
<li><code>safeTransferFrom</code>ï¼šå®‰å…¨è½¬è´¦çš„é‡è½½å‡½æ•°ï¼Œå‚æ•°é‡Œé¢åŒ…å«äº†<code>data</code>ã€‚</li>
</ul>
<h5 id="ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ</h5>
<p>å¦‚æœæˆ‘ä»¬çŸ¥é“ä¸€ä¸ªåˆçº¦å®ç°äº†<code>IERC721</code>æ¥å£ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒå…·ä½“ä»£ç å®ç°ï¼Œå°±å¯ä»¥ä¸å®ƒäº¤äº’ã€‚</p>
<p>æ— èŠçŒ¿<code>BAYC</code>å±äº<code>ERC721</code>ä»£å¸ï¼Œå®ç°äº†<code>IERC721</code>æ¥å£çš„åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸éœ€è¦çŸ¥é“å®ƒçš„æºä»£ç ï¼Œåªéœ€çŸ¥é“å®ƒçš„åˆçº¦åœ°å€ï¼Œç”¨<code>IERC721</code>æ¥å£å°±å¯ä»¥ä¸å®ƒäº¤äº’ï¼Œæ¯”å¦‚ç”¨<code>balanceOf()</code>æ¥æŸ¥è¯¢æŸä¸ªåœ°å€çš„<code>BAYC</code>ä½™é¢ï¼Œç”¨<code>safeTransferFrom()</code>æ¥è½¬è´¦<code>BAYC</code>ã€‚</p>
<pre><code class="language-solidity">contract interactBAYC {
    // åˆ©ç”¨BAYCåœ°å€åˆ›å»ºæ¥å£åˆçº¦å˜é‡ï¼ˆETHä¸»ç½‘ï¼‰
    IERC721 BAYC = IERC721(0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D);

    // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„balanceOf()æŸ¥è¯¢æŒä»“é‡
    function balanceOfBAYC(address owner) external view returns (uint256 balance){
        return BAYC.balanceOf(owner);
    }

    // é€šè¿‡æ¥å£è°ƒç”¨BAYCçš„safeTransferFrom()å®‰å…¨è½¬è´¦
    function safeTransferFromBAYC(address from, address to, uint256 tokenId) external{
        BAYC.safeTransferFrom(from, to, tokenId);
    }
}
</code></pre>
<figure data-type="image" tabindex="48"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110132218696.png" alt="æ¥å£å®ä¾‹" loading="lazy"></figure>
<h3 id="15-å¼‚å¸¸">15. å¼‚å¸¸</h3>
<h4 id="error">Error</h4>
<p><code>error</code>æ˜¯<code>solidity 0.8ç‰ˆæœ¬</code>æ–°åŠ çš„å†…å®¹ï¼Œæ–¹ä¾¿ä¸”é«˜æ•ˆï¼ˆçœ<code>gas</code>ï¼‰åœ°å‘ç”¨æˆ·è§£é‡Šæ“ä½œå¤±è´¥çš„åŸå› ã€‚äººä»¬å¯ä»¥åœ¨<code>contract</code>ä¹‹å¤–å®šä¹‰å¼‚å¸¸ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>TransferNotOwner</code>å¼‚å¸¸ï¼Œå½“ç”¨æˆ·ä¸æ˜¯ä»£å¸<code>owner</code>çš„æ—¶å€™å°è¯•è½¬è´¦ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼š</p>
<pre><code class="language-solidity">error TransferNotOwner(); // è‡ªå®šä¹‰error
</code></pre>
<p>åœ¨æ‰§è¡Œå½“ä¸­ï¼Œ<code>error</code>å¿…é¡»æ­é…<code>revert</code>ï¼ˆå›é€€ï¼‰å‘½ä»¤ä½¿ç”¨ã€‚</p>
<pre><code class="language-solidity">function transferOwner1(uint256 tokenId, address newOwner) public {
    if(_owners[tokenId] != msg.sender){
    	revert TransferNotOwner();
    }
    _owners[tokenId] = newOwner;
}
</code></pre>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>transferOwner1()</code>å‡½æ•°ï¼Œå®ƒä¼šæ£€æŸ¥ä»£å¸çš„<code>owner</code>æ˜¯ä¸æ˜¯å‘èµ·äººï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šæŠ›å‡º<code>TransferNotOwner</code>å¼‚å¸¸ï¼›å¦‚æœæ˜¯çš„è¯ï¼Œå°±ä¼šè½¬è´¦ã€‚</p>
<figure data-type="image" tabindex="49"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110134643773.png" alt="æ§åˆ¶å°æŠ›å‡ºå¼‚å¸¸ï¼Œæ˜¾ç¤ºè‡ªå®šä¹‰error" loading="lazy"></figure>
<figure data-type="image" tabindex="50"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110135132246.png" alt="gaså€¼æ¶ˆè€—" loading="lazy"></figure>
<p><strong>å®šä¹‰å‚æ•°çš„error</strong></p>
<figure data-type="image" tabindex="51"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110135457383.png" alt="å®šä¹‰å‚æ•°çš„error" loading="lazy"></figure>
<figure data-type="image" tabindex="52"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110135540337.png" alt="gaså€¼æ¶ˆè€—" loading="lazy"></figure>
<h4 id="require">Require</h4>
<p><code>require</code>å‘½ä»¤æ˜¯<code>solidity 0.8ç‰ˆæœ¬</code>ä¹‹å‰æŠ›å‡ºå¼‚å¸¸çš„å¸¸ç”¨æ–¹æ³•ï¼Œç›®å‰å¾ˆå¤šä¸»æµåˆçº¦ä»ç„¶è¿˜åœ¨ä½¿ç”¨å®ƒã€‚å®ƒå¾ˆå¥½ç”¨ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯<code>gas</code>éšç€æè¿°å¼‚å¸¸çš„å­—ç¬¦ä¸²é•¿åº¦å¢åŠ ï¼Œæ¯”<code>error</code>å‘½ä»¤è¦é«˜ã€‚ä½¿ç”¨æ–¹æ³•ï¼š<code>require(æ£€æŸ¥æ¡ä»¶ï¼Œ&quot;å¼‚å¸¸çš„æè¿°&quot;)</code>ï¼Œå½“æ£€æŸ¥æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬ç”¨<code>require</code>å‘½ä»¤é‡å†™ä¸€ä¸‹ä¸Šé¢çš„<code>transferOwner</code>å‡½æ•°ï¼š</p>
<pre><code class="language-solidity">function transferOwner2(uint256 tokenId, address newOwner) public {
    require(_owners[tokenId] == msg.sender, &quot;Transfer Not Owner&quot;);
    _owners[tokenId] = newOwner;
}
</code></pre>
<figure data-type="image" tabindex="53"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110152206293.png" alt="requireä»¥åŠgaså€¼æ¶ˆè€—" loading="lazy"></figure>
<h4 id="assert">Assert</h4>
<p><code>assert</code>å‘½ä»¤ä¸€èˆ¬ç”¨äºç¨‹åºå‘˜å†™ç¨‹åº<code>debug</code>ï¼Œå› ä¸º<strong>å®ƒä¸èƒ½è§£é‡ŠæŠ›å‡ºå¼‚å¸¸çš„åŸå› </strong>ï¼ˆæ¯”<code>require</code>å°‘ä¸ªå­—ç¬¦ä¸²ï¼‰ã€‚å®ƒçš„ç”¨æ³•å¾ˆç®€å•ï¼Œ<code>assert(æ£€æŸ¥æ¡ä»¶ï¼‰</code>ï¼Œå½“æ£€æŸ¥æ¡ä»¶ä¸æˆç«‹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æˆ‘ä»¬ç”¨<code>assert</code>å‘½ä»¤é‡å†™ä¸€ä¸‹ä¸Šé¢çš„<code>transferOwner</code>å‡½æ•°ï¼š</p>
<pre><code class="language-solidity">function transferOwner3(uint256 tokenId, address newOwner) public {
    assert(_owners[tokenId] == msg.sender);
    _owners[tokenId] = newOwner;
}
</code></pre>
<figure data-type="image" tabindex="54"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221110152306479.png" alt="assert ä¸ gas å€¼æ¶ˆè€—" loading="lazy"></figure>
<p>æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹ä¸‰ç§æŠ›å‡ºå¼‚å¸¸çš„<code>gas</code>æ¶ˆè€—ï¼Œé€šè¿‡remixæ§åˆ¶å°çš„DebugæŒ‰é’®ï¼Œèƒ½æŸ¥åˆ°æ¯æ¬¡å‡½æ•°è°ƒç”¨çš„<code>gas</code>æ¶ˆè€—åˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong><code>error</code>æ–¹æ³•<code>gas</code>æ¶ˆè€—</strong>ï¼š24457</li>
<li><strong><code>require</code>æ–¹æ³•<code>gas</code>æ¶ˆè€—</strong>ï¼š24755</li>
<li><strong><code>assert</code>æ–¹æ³•<code>gas</code>æ¶ˆè€—</strong>ï¼š24473</li>
</ol>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>error</code>æ–¹æ³•<code>gas</code>æœ€å°‘ï¼Œå…¶æ¬¡æ˜¯<code>assert</code>ï¼Œ<code>require</code>æ–¹æ³•æ¶ˆè€—<code>gas</code>æœ€å¤šï¼å› æ­¤ï¼Œ<code>error</code>æ—¢å¯ä»¥å‘ŠçŸ¥ç”¨æˆ·æŠ›å‡ºå¼‚å¸¸çš„åŸå› ï¼Œåˆèƒ½çœ<code>gas</code>ï¼Œå¤§å®¶è¦å¤šç”¨ï¼ï¼ˆæ³¨æ„ï¼Œç”±äºéƒ¨ç½²æµ‹è¯•æ—¶é—´çš„ä¸åŒï¼Œæ¯ä¸ªå‡½æ•°çš„<code>gas</code>æ¶ˆè€—ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ¯”è¾ƒç»“æœä¼šæ˜¯ä¸€è‡´çš„ã€‚ï¼‰</p>
<h2 id="solidity-è¿›é˜¶">Solidity è¿›é˜¶</h2>
<h3 id="16-å‡½æ•°é‡è½½">16. å‡½æ•°é‡è½½</h3>
<p><code>solidity</code>ä¸­å…è®¸<strong>å‡½æ•°</strong>è¿›è¡Œé‡è½½ï¼ˆ<code>overloading</code>ï¼‰ï¼Œå³<strong>åå­—ç›¸åŒä½†è¾“å…¥å‚æ•°ç±»å‹ä¸åŒ</strong>çš„å‡½æ•°å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œä»–ä»¬è¢«è§†ä¸ºä¸åŒçš„å‡½æ•°ã€‚æ³¨æ„ï¼Œ<code>solidity</code><strong>ä¸å…è®¸</strong>ä¿®é¥°å™¨ï¼ˆ<code>modifier</code>ï¼‰é‡è½½ã€‚</p>
<h4 id="å‡½æ•°é‡è½½">å‡½æ•°é‡è½½</h4>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸¤ä¸ªéƒ½å«<code>saySomething()</code>çš„å‡½æ•°ï¼Œä¸€ä¸ªæ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œè¾“å‡º<code>&quot;Nothing&quot;</code>ï¼›å¦ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª<code>string</code>å‚æ•°ï¼Œè¾“å‡ºè¿™ä¸ª<code>string</code>ã€‚</p>
<pre><code class="language-solidity">function saySomething() public pure returns(string memory){
    return(&quot;Nothing&quot;);
}

function saySomething(string memory something) public pure returns(string memory){
    return(something);
}
</code></pre>
<p>æœ€ç»ˆé‡è½½å‡½æ•°åœ¨ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘åï¼Œç”±äºä¸åŒçš„å‚æ•°ç±»å‹ï¼Œéƒ½å˜æˆäº†ä¸åŒçš„å‡½æ•°é€‰æ‹©å™¨ï¼ˆselectorï¼‰ã€‚å…³äºå‡½æ•°é€‰æ‹©å™¨çš„å…·ä½“å†…å®¹å¯å‚è€ƒ<a href="https://github.com/AmazingAng/WTFSolidity/tree/main/29_Selector">Solidityæç®€å…¥é—¨: 29. å‡½æ•°é€‰æ‹©å™¨Selector</a>ã€‚</p>
<p>ä»¥ <code>Overloading.sol</code> åˆçº¦ä¸ºä¾‹ï¼Œåœ¨ Remix ä¸Šç¼–è¯‘éƒ¨ç½²åï¼Œåˆ†åˆ«è°ƒç”¨é‡è½½å‡½æ•° <code>saySomething()</code> å’Œ <code>saySomething(string memory something)</code>ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬è¿”å›äº†ä¸åŒçš„ç»“æœï¼Œè¢«åŒºåˆ†ä¸ºä¸åŒçš„å‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="55"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221114220544651.png" alt="å‡½æ•°é‡è½½" loading="lazy"></figure>
<h4 id="å®å‚åŒ¹é…argument-matching08-å-å·²ä¿®å¤">å®å‚åŒ¹é…ï¼ˆArgument Matchingï¼‰ï¼ˆ0.8 å å·²ä¿®å¤ï¼Ÿï¼‰</h4>
<p>åœ¨è°ƒç”¨é‡è½½å‡½æ•°æ—¶ï¼Œä¼šæŠŠ<strong>è¾“å…¥çš„å®é™…å‚æ•°å’Œå‡½æ•°å‚æ•°çš„å˜é‡ç±»å‹åšåŒ¹é…</strong>ã€‚ å¦‚æœå‡ºç°<strong>å¤šä¸ªåŒ¹é…çš„é‡è½½å‡½æ•°ï¼Œåˆ™ä¼šæŠ¥é”™</strong>ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æœ‰ä¸¤ä¸ªå«<code>f()</code>çš„å‡½æ•°ï¼Œä¸€ä¸ªå‚æ•°ä¸º<code>uint8</code>ï¼Œå¦ä¸€ä¸ªä¸º<code>uint256</code>ï¼š</p>
<pre><code class="language-solidity">function f(uint8 _in) public pure returns (uint8 out) {
	out = _in;
}

function f(uint256 _in) public pure returns (uint256 out) {
	out = _in;
}
</code></pre>
<p>æˆ‘ä»¬è°ƒç”¨<code>f(50)</code>ï¼Œå› ä¸º<code>50</code>æ—¢å¯ä»¥è¢«è½¬æ¢ä¸º<code>uint8</code>ï¼Œä¹Ÿå¯ä»¥è¢«è½¬æ¢ä¸º<code>uint256</code>ï¼Œ<strong>å› æ­¤ä¼šæŠ¥é”™ã€‚</strong></p>
<h3 id="17-åº“åˆçº¦">17. åº“åˆçº¦</h3>
<p>ç”¨<code>ERC721</code>çš„å¼•ç”¨çš„åº“åˆçº¦<code>String</code>ä¸ºä¾‹ä»‹ç»<code>solidity</code>ä¸­çš„åº“åˆçº¦ï¼ˆ<code>library</code>ï¼‰ï¼Œå¹¶æ€»ç»“äº†å¸¸ç”¨çš„åº“å‡½æ•°ã€‚</p>
<h4 id="åº“å‡½æ•°">åº“å‡½æ•°</h4>
<p>åº“å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ï¼Œä¸ºäº†æå‡<code>solidity</code>ä»£ç çš„å¤ç”¨æ€§å’Œå‡å°‘<code>gas</code>è€Œå­˜åœ¨ã€‚åº“åˆçº¦ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›å¥½ç”¨çš„å‡½æ•°åˆé›†ï¼ˆ<code>åº“å‡½æ•°</code>ï¼‰ï¼Œç”±å¤§ç¥æˆ–è€…é¡¹ç›®æ–¹åˆ›ä½œï¼Œå’±ä»¬ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œä¼šç”¨å°±è¡Œäº†ã€‚</p>
<figure data-type="image" tabindex="56"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/HJC0UjkALdrL8a2BmAE2J.jpeg" alt="åº“åˆçº¦ï¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Š" loading="lazy"></figure>
<p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç”¨<code>ERC721</code>çš„å¼•ç”¨çš„åº“å‡½æ•°<code>String</code>ä¸ºä¾‹ä»‹ç»<code>solidity</code>ä¸­çš„åº“å‡½æ•°ï¼ˆ<code>Library</code>ï¼‰ã€‚99%çš„å¼€å‘è€…éƒ½ä¸éœ€è¦è‡ªå·±å»å†™åº“åˆçº¦ï¼Œä¼šç”¨å¤§ç¥å†™çš„å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬åªéœ€è¦çŸ¥é“ä»€ä¹ˆæƒ…å†µè¯¥ç”¨ä»€ä¹ˆåº“åˆçº¦ã€‚å¸¸ç”¨çš„æœ‰ï¼š</p>
<ol>
<li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Strings.sol">String</a>ï¼šå°†<code>uint256</code>è½¬æ¢ä¸º<code>String</code></li>
<li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Address.sol">Address</a>ï¼šåˆ¤æ–­æŸä¸ªåœ°å€æ˜¯å¦ä¸ºåˆçº¦åœ°å€</li>
<li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Create2.sol">Create2</a>ï¼šæ›´å®‰å…¨çš„ä½¿ç”¨<code>Create2 EVM opcode</code></li>
<li><a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/4a9cc8b4918ef3736229a5cc5a310bdc17bf759f/contracts/utils/Arrays.sol">Arrays</a>ï¼šè·Ÿæ•°ç»„ç›¸å…³çš„åº“å‡½æ•°</li>
</ol>
<p>ä»–å’Œæ™®é€šåˆçº¦ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š</p>
<ol>
<li><strong>ä¸èƒ½å­˜åœ¨çŠ¶æ€å˜é‡</strong></li>
<li><strong>ä¸èƒ½å¤Ÿç»§æ‰¿æˆ–è¢«ç»§æ‰¿</strong></li>
<li><strong>ä¸èƒ½æ¥æ”¶ä»¥å¤ªå¸</strong></li>
<li><strong>ä¸å¯ä»¥è¢«é”€æ¯</strong></li>
</ol>
<h4 id="stringåº“åˆçº¦">Stringåº“åˆçº¦</h4>
<p><code>Stringåº“åˆçº¦</code>æ˜¯å°†<code>uint256</code>ç±»å‹è½¬æ¢ä¸ºç›¸åº”çš„<code>string</code>ç±»å‹çš„ä»£ç åº“ï¼Œæ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-solidity">library Strings {
    bytes16 private constant _HEX_SYMBOLS = &quot;0123456789abcdef&quot;;

    /**
     * @dev Converts a `uint256` to its ASCII `string` decimal representation.
     */
    function toString(uint256 value) public pure returns (string memory) {
        // Inspired by OraclizeAPI's implementation - MIT licence
        // https://github.com/oraclize/ethereum-api/blob/b42146b063c7d6ee1358846c198246239e9360e8/oraclizeAPI_0.4.25.sol

        if (value == 0) {
            return &quot;0&quot;;
        }
        uint256 temp = value;
        uint256 digits;
        while (temp != 0) {
            digits++;
            temp /= 10;
        }
        bytes memory buffer = new bytes(digits);
        while (value != 0) {
            digits -= 1;
            buffer[digits] = bytes1(uint8(48 + uint256(value % 10)));
            value /= 10;
        }
        return string(buffer);
    }

    /**
     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation.
     */
    function toHexString(uint256 value) public pure returns (string memory) {
        if (value == 0) {
            return &quot;0x00&quot;;
        }
        uint256 temp = value;
        uint256 length = 0;
        while (temp != 0) {
            length++;
            temp &gt;&gt;= 8;
        }
        return toHexString(value, length);
    }

    /**
     * @dev Converts a `uint256` to its ASCII `string` hexadecimal representation with fixed length.
     */
    function toHexString(uint256 value, uint256 length) public pure returns (string memory) {
        bytes memory buffer = new bytes(2 * length + 2);
        buffer[0] = &quot;0&quot;;
        buffer[1] = &quot;x&quot;;
        for (uint256 i = 2 * length + 1; i &gt; 1; --i) {
            buffer[i] = _HEX_SYMBOLS[value &amp; 0xf];
            value &gt;&gt;= 4;
        }
        require(value == 0, &quot;Strings: hex length insufficient&quot;);
        return string(buffer);
    }
}
</code></pre>
<p>ä»–ä¸»è¦åŒ…å«ä¸¤ä¸ªå‡½æ•°ï¼Œ<code>toString()</code>å°†<code>uint256</code>è½¬ä¸º<code>string</code>ï¼Œ<code>toHexString()</code>å°†<code>uint256</code>è½¬æ¢ä¸º<code>16è¿›åˆ¶</code>ï¼Œå†è½¬æ¢ä¸º<code>string</code>ã€‚</p>
<p>æˆ‘ä»¬ç”¨Stringåº“å‡½æ•°çš„**toHexString()**æ¥æ¼”ç¤ºä¸¤ç§ä½¿ç”¨åº“åˆçº¦ä¸­å‡½æ•°çš„åŠæ³•ã€‚</p>
<p><strong>1. åˆ©ç”¨using foræŒ‡ä»¤</strong></p>
<p>æŒ‡ä»¤<code>using A for B;</code>å¯ç”¨äºé™„åŠ åº“å‡½æ•°ï¼ˆä»åº“ Aï¼‰åˆ°ä»»ä½•ç±»å‹ï¼ˆBï¼‰ã€‚æ·»åŠ å®ŒæŒ‡ä»¤åï¼Œåº“<code>A</code>ä¸­çš„å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸º<code>B</code>ç±»å‹å˜é‡çš„æˆå‘˜ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚æ³¨æ„ï¼šåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œ<strong>è¿™ä¸ªå˜é‡ä¼šè¢«å½“ä½œç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å‡½æ•°</strong>ï¼š</p>
<pre><code class="language-solidity">// åˆ©ç”¨using foræŒ‡ä»¤
using Strings for uint256;
function getString1(uint256 _number) public pure returns(string memory){
    // åº“å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ ä¸ºuint256å‹å˜é‡çš„æˆå‘˜
    return _number.toHexString();
}
</code></pre>
<p><strong>2. é€šè¿‡åº“åˆçº¦åç§°è°ƒç”¨åº“å‡½æ•°</strong></p>
<pre><code class="language-solidity">// ç›´æ¥é€šè¿‡åº“åˆçº¦åè°ƒç”¨
function getString2(uint256 _number) public pure returns(string memory){
    return Strings.toHexString(_number);
}
</code></pre>
<p>æˆ‘ä»¬éƒ¨ç½²åˆçº¦å¹¶è¾“å…¥<code>170</code>æµ‹è¯•ä¸€ä¸‹ï¼Œä¸¤ç§æ–¹æ³•å‡èƒ½è¿”å›æ­£ç¡®çš„<code>16è¿›åˆ¶string</code> â€œ0xaaâ€ã€‚è¯æ˜æˆ‘ä»¬è°ƒç”¨åº“å‡½æ•°æˆåŠŸï¼</p>
<figure data-type="image" tabindex="57"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115101057935.png" alt="è°ƒç”¨åº“å‡½æ•°æµ‹è¯•" loading="lazy"></figure>
<h3 id="18-import">18. Import</h3>
<p><code>solidity</code>æ”¯æŒåˆ©ç”¨<code>import</code>å…³é”®å­—å¯¼å…¥å…¶ä»–æºä»£ç ä¸­çš„åˆçº¦ï¼Œè®©å¼€å‘æ›´åŠ æ¨¡å—åŒ–ã€‚</p>
<p>Solidityä¸­importçš„ä½œç”¨æ˜¯ï¼šå¯¼å…¥å…¶ä»–åˆçº¦ä¸­çš„<strong>å…¨å±€ç¬¦å·</strong>ã€‚åŒ…æ‹¬ï¼šåˆçº¦ã€çº¯å‡½æ•°ã€ç»“æ„ä½“ç±»å‹ã€‚</p>
<p>è¢«å¯¼å…¥æ–‡ä»¶ä¸­çš„å…¨å±€ç¬¦å·æƒ³è¦è¢«å…¶ä»–åˆçº¦å•ç‹¬å¯¼å…¥ï¼Œå°†åˆçº¦å¹¶åˆ—åœ¨æ–‡ä»¶ç»“æ„ä¸­</p>
<h4 id="importç”¨æ³•"><code>import</code>ç”¨æ³•</h4>
<ul>
<li>é€šè¿‡æºæ–‡ä»¶<strong>ç›¸å¯¹ä½ç½®</strong>å¯¼å…¥ï¼Œä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-text">æ–‡ä»¶ç»“æ„
â”œâ”€â”€ Import.sol
â””â”€â”€ Yeye.sol

// é€šè¿‡æ–‡ä»¶ç›¸å¯¹ä½ç½®import
import './Yeye.sol';
</code></pre>
<ul>
<li>é€šè¿‡æºæ–‡ä»¶ç½‘å€å¯¼å…¥ç½‘ä¸Šçš„åˆçº¦ï¼Œä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-text">// é€šè¿‡ç½‘å€å¼•ç”¨
import 'https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/Address.sol';
</code></pre>
<ul>
<li>é€šè¿‡<code>npm</code>çš„ç›®å½•å¯¼å…¥ï¼Œä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-solidity">import '@openzeppelin/contracts/access/Ownable.sol';
</code></pre>
<ul>
<li>é€šè¿‡<code>å…¨å±€ç¬¦å·</code>å¯¼å…¥ç‰¹å®šçš„åˆçº¦ï¼Œä¾‹å­ï¼š</li>
</ul>
<pre><code class="language-solidity">import {Yeye} from './Yeye.sol';
</code></pre>
<ul>
<li>å¼•ç”¨(<code>import</code>)åœ¨ä»£ç ä¸­çš„ä½ç½®ä¸ºï¼šåœ¨å£°æ˜ç‰ˆæœ¬å·ä¹‹åï¼Œåœ¨å…¶ä½™ä»£ç ä¹‹å‰ã€‚</li>
</ul>
<figure data-type="image" tabindex="58"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115104033293.png" alt="å¯¼å…¥æµ‹è¯•ç»“æœ" loading="lazy"></figure>
<h3 id="19-æ¥å—eth">19. æ¥å—ETH</h3>
<p><code>Solidity</code>æ”¯æŒä¸¤ç§ç‰¹æ®Šçš„å›è°ƒå‡½æ•°ï¼Œ<code>receive()</code>å’Œ<code>fallback()</code>ï¼Œä»–ä»¬ä¸»è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹è¢«ä½¿ç”¨ï¼š</p>
<ol>
<li>æ¥æ”¶ETH</li>
<li>å¤„ç†åˆçº¦ä¸­ä¸å­˜åœ¨çš„å‡½æ•°è°ƒç”¨ï¼ˆä»£ç†åˆçº¦proxy contractï¼‰</li>
</ol>
<p>æ³¨æ„âš ï¸ï¼šåœ¨solidity <strong>0.6.xç‰ˆæœ¬ä¹‹å‰</strong>ï¼Œè¯­æ³•ä¸Šåªæœ‰ <code>fallback()</code> å‡½æ•°ï¼Œç”¨æ¥æ¥æ”¶ç”¨æˆ·å‘é€çš„ETHæ—¶è°ƒç”¨ä»¥åŠåœ¨è¢«è°ƒç”¨å‡½æ•°ç­¾åæ²¡æœ‰åŒ¹é…åˆ°æ—¶ï¼Œæ¥è°ƒç”¨ã€‚ 0.6ç‰ˆæœ¬ä¹‹åï¼Œsolidityæ‰å°† <code>fallback()</code> å‡½æ•°æ‹†åˆ†æˆ <code>receive()</code> å’Œ <code>fallback()</code> ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<p>æˆ‘ä»¬è¿™ä¸€è®²ä¸»è¦è®²æ¥æ”¶ETHçš„æƒ…å†µã€‚</p>
<h4 id="æ¥æ”¶ethå‡½æ•°-receive">æ¥æ”¶ETHå‡½æ•° receive</h4>
<p><code>receive()</code>åªç”¨äºå¤„ç†<strong>æ¥æ”¶</strong><code>ETH</code>ã€‚ä¸€ä¸ªåˆçº¦<strong>æœ€å¤šæœ‰ä¸€ä¸ª</strong><code>receive()</code>å‡½æ•°ï¼Œå£°æ˜æ–¹å¼ä¸ä¸€èˆ¬å‡½æ•°ä¸ä¸€æ ·ï¼Œ<strong>ä¸éœ€è¦</strong><code>function</code>å…³é”®å­—ï¼š<code>receive() external payable { ... }</code>ã€‚<code>receive()</code>å‡½æ•°<strong>ä¸èƒ½æœ‰ä»»ä½•çš„å‚æ•°ï¼Œä¸èƒ½è¿”å›ä»»ä½•å€¼</strong>ï¼Œå¿…é¡»åŒ…å«<code>external</code>å’Œ<code>payable</code>ã€‚</p>
<p>å½“åˆçº¦æ¥æ”¶ETHçš„æ—¶å€™ï¼Œ<code>receive()</code>ä¼šè¢«è§¦å‘ã€‚<code>receive()</code>æœ€å¥½ä¸è¦æ‰§è¡Œå¤ªå¤šçš„é€»è¾‘å› ä¸ºå¦‚æœåˆ«äººç”¨<code>send</code>å’Œ<code>transfer</code>æ–¹æ³•å‘é€<code>ETH</code>çš„è¯ï¼Œ<code>gas</code>ä¼šé™åˆ¶åœ¨<code>2300</code>ï¼Œ<code>receive()</code>å¤ªå¤æ‚å¯èƒ½ä¼šè§¦å‘<code>Out of Gas</code>æŠ¥é”™ï¼›å¦‚æœç”¨<code>call</code>å°±å¯ä»¥è‡ªå®šä¹‰<code>gas</code>æ‰§è¡Œæ›´å¤æ‚çš„é€»è¾‘ï¼ˆè¿™ä¸‰ç§å‘é€ETHçš„æ–¹æ³•æˆ‘ä»¬ä¹‹åä¼šè®²åˆ°ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨<code>receive()</code>é‡Œå‘é€ä¸€ä¸ª<code>event</code>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-solidity">// å®šä¹‰äº‹ä»¶
event Received(address Sender, uint Value);
// æ¥æ”¶ETHæ—¶é‡Šæ”¾Receivedäº‹ä»¶
receive() external payable {
	emit Received(msg.sender, msg.value);
}
</code></pre>
<p>æœ‰äº›æ¶æ„åˆçº¦ï¼Œä¼šåœ¨<code>receive()</code> å‡½æ•°ï¼ˆè€ç‰ˆæœ¬çš„è¯ï¼Œå°±æ˜¯ <code>fallback()</code> å‡½æ•°ï¼‰åµŒå…¥æ¶æ„æ¶ˆè€—<code>gas</code>çš„å†…å®¹æˆ–è€…ä½¿å¾—æ‰§è¡Œæ•…æ„å¤±è´¥çš„ä»£ç ï¼Œå¯¼è‡´ä¸€äº›åŒ…å«é€€æ¬¾å’Œè½¬è´¦é€»è¾‘çš„åˆçº¦ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œå› æ­¤å†™åŒ…å«é€€æ¬¾ç­‰é€»è¾‘çš„åˆçº¦æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„è¿™ç§æƒ…å†µã€‚</p>
<h4 id="å›é€€å‡½æ•°-fallback">å›é€€å‡½æ•° fallback</h4>
<p><code>fallback()</code>å‡½æ•°ä¼š<strong>åœ¨è°ƒç”¨åˆçº¦ä¸å­˜åœ¨çš„å‡½æ•°æ—¶è¢«è§¦å‘</strong>ã€‚å¯ç”¨äºæ¥æ”¶ETHï¼Œä¹Ÿå¯ä»¥ç”¨äºä»£ç†åˆçº¦<code>proxy contract</code>ã€‚<code>fallback()</code>å£°æ˜æ—¶ä¸éœ€è¦<code>function</code>å…³é”®å­—ï¼Œå¿…é¡»ç”±<code>external</code>ä¿®é¥°ï¼Œä¸€èˆ¬ä¹Ÿä¼šç”¨<code>payable</code>ä¿®é¥°ï¼Œç”¨äºæ¥æ”¶ETH:<code>fallback() external payable { ... }</code>ã€‚</p>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>fallback()</code>å‡½æ•°ï¼Œè¢«è§¦å‘æ—¶å€™ä¼šé‡Šæ”¾<code>fallbackCalled</code>äº‹ä»¶ï¼Œå¹¶è¾“å‡º<code>msg.sender</code>ï¼Œ<code>msg.value</code>å’Œ<code>msg.data</code>:</p>
<pre><code class="language-solidity">// fallback
fallback() external payable{
    emit fallbackCalled(msg.sender, msg.value, msg.data);
}
</code></pre>
<h4 id="receiveå’Œfallbackçš„åŒºåˆ«">receiveå’Œfallbackçš„åŒºåˆ«</h4>
<p><code>receive</code>å’Œ<code>fallback</code>éƒ½èƒ½å¤Ÿç”¨äºæ¥æ”¶<code>ETH</code>ï¼Œä»–ä»¬è§¦å‘çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">è§¦å‘fallback() è¿˜æ˜¯ receive()?
           æ¥æ”¶ETH
              |
         msg.dataæ˜¯ç©ºï¼Ÿ
            /  \
          æ˜¯    å¦
          /      \
receive()å­˜åœ¨?   fallback()
        / \
       æ˜¯  å¦
      /     \
receive()   fallback()
</code></pre>
<p>ç®€å•æ¥è¯´ï¼Œåˆçº¦æ¥æ”¶<code>ETH</code>æ—¶ï¼Œ<code>msg.data</code>ä¸ºç©ºä¸”å­˜åœ¨<code>receive()</code>æ—¶ï¼Œä¼šè§¦å‘<code>receive()</code>ï¼›<code>msg.data</code>ä¸ä¸ºç©ºæˆ–ä¸å­˜åœ¨<code>receive()</code>æ—¶ï¼Œä¼šè§¦å‘<code>fallback()</code>ï¼Œæ­¤æ—¶<code>fallback()</code>å¿…é¡»ä¸º<code>payable</code>ã€‚</p>
<p><code>receive()</code>å’Œ<code>payable fallback()</code>å‡ä¸å­˜åœ¨çš„æ—¶å€™ï¼Œå‘åˆçº¦å‘é€<code>ETH</code>å°†ä¼šæŠ¥é”™ã€‚</p>
<h4 id="remix-æ¼”ç¤º">remix æ¼”ç¤º</h4>
<ol>
<li>
<p>é¦–å…ˆremixéƒ¨ç½²</p>
</li>
<li>
<p>&quot;VALUE&quot; æ ä¸­å¡«å…¥è¦å‘é€ç»™åˆçº¦çš„é‡‘é¢ï¼ˆå•ä½æ˜¯ Weiï¼‰ï¼Œç„¶åç‚¹å‡» &quot;Transact&quot;ã€‚</p>
<figure data-type="image" tabindex="59"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115105904995.png" alt="transact" loading="lazy"></figure>
</li>
<li>
<p>å¯ä»¥çœ‹åˆ°äº¤æ˜“æˆåŠŸï¼Œå¹¶ä¸”è§¦å‘äº† &quot;received&quot; äº‹ä»¶ã€‚</p>
</li>
</ol>
<figure data-type="image" tabindex="60"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115122804262.png" alt="receivedäº‹ä»¶" loading="lazy"></figure>
<ol start="4">
<li>&quot;VALUE&quot; æ ä¸­å¡«å…¥è¦å‘é€ç»™åˆçº¦çš„é‡‘é¢ï¼ˆå•ä½æ˜¯ Weiï¼‰ï¼Œ&quot;CALLDATA&quot; æ ä¸­å¡«å…¥éšæ„ç¼–å†™çš„<code>msg.data</code>ï¼Œç„¶åç‚¹å‡» &quot;Transact&quot;ã€‚</li>
<li>å¯ä»¥çœ‹åˆ°äº¤æ˜“æˆåŠŸï¼Œå¹¶ä¸”è§¦å‘äº† &quot;fallbackCalled&quot; äº‹ä»¶ã€‚</li>
</ol>
<figure data-type="image" tabindex="61"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115123025710.png" alt="fallbackCalled äº‹ä»¶è¢«è§¦å‘" loading="lazy"></figure>
<h3 id="20-å‘é€eth">20. å‘é€ETH</h3>
<p><code>Solidity</code>æœ‰ä¸‰ç§æ–¹æ³•å‘å…¶ä»–åˆçº¦å‘é€<code>ETH</code>ï¼Œä»–ä»¬æ˜¯ï¼š<code>transfer()</code>ï¼Œ<code>send()</code>å’Œ<code>call()</code>ï¼Œå…¶ä¸­<code>call()</code>æ˜¯è¢«é¼“åŠ±çš„ç”¨æ³•ã€‚</p>
<ul>
<li><code>call</code>æ²¡æœ‰<code>gas</code>é™åˆ¶ï¼Œæœ€ä¸ºçµæ´»ï¼Œæ˜¯æœ€æå€¡çš„æ–¹æ³•ï¼›</li>
<li><code>transfer</code>æœ‰<code>2300 gas</code>é™åˆ¶ï¼Œä½†æ˜¯å‘é€å¤±è´¥ä¼šè‡ªåŠ¨<code>revert</code>äº¤æ˜“ï¼Œæ˜¯æ¬¡ä¼˜é€‰æ‹©ï¼›</li>
<li><code>send</code>æœ‰<code>2300 gas</code>é™åˆ¶ï¼Œè€Œä¸”å‘é€å¤±è´¥ä¸ä¼šè‡ªåŠ¨<code>revert</code>äº¤æ˜“ï¼Œå‡ ä¹æ²¡æœ‰äººç”¨å®ƒã€‚</li>
</ul>
<p>æˆ‘ä»¬å…ˆéƒ¨ç½²ä¸€ä¸ªæ¥æ”¶<code>ETH</code>åˆçº¦<code>ReceiveETH</code>ã€‚<code>ReceiveETH</code>åˆçº¦é‡Œæœ‰ä¸€ä¸ªäº‹ä»¶<code>Log</code>ï¼Œè®°å½•æ”¶åˆ°çš„<code>ETH</code>æ•°é‡å’Œ<code>gas</code>å‰©ä½™ã€‚è¿˜æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªæ˜¯<code>receive()</code>å‡½æ•°ï¼Œæ”¶åˆ°<code>ETH</code>è¢«è§¦å‘ï¼Œå¹¶å‘é€<code>Log</code>äº‹ä»¶ï¼›å¦ä¸€ä¸ªæ˜¯æŸ¥è¯¢åˆçº¦<code>ETH</code>ä½™é¢çš„<code>getBalance()</code>å‡½æ•°ã€‚</p>
<pre><code class="language-solidity">contract ReceiveETH {
    // æ”¶åˆ°ethäº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);
    
    // receiveæ–¹æ³•ï¼Œæ¥æ”¶ethæ—¶è¢«è§¦å‘
    receive() external payable{
        emit Log(msg.value, gasleft());
    }
    
    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }
}
</code></pre>
<p>éƒ¨ç½²<code>ReceiveETH</code>åˆçº¦åï¼Œè¿è¡Œ<code>getBalance()</code>å‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰åˆçº¦çš„<code>ETH</code>ä½™é¢ä¸º<code>0</code>ã€‚</p>
<figure data-type="image" tabindex="62"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115124043096.png" alt="ethä½™é¢" loading="lazy"></figure>
<p>æˆ‘ä»¬å°†å®ç°ä¸‰ç§æ–¹æ³•å‘<code>ReceiveETH</code>åˆçº¦å‘é€<code>ETH</code>ã€‚é¦–å…ˆï¼Œå…ˆåœ¨å‘é€ETHåˆçº¦<code>SendETH</code>ä¸­å®ç°<code>payable</code>çš„<code>æ„é€ å‡½æ•°</code>å’Œ<code>receive()</code>ï¼Œ<strong>è®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨éƒ¨ç½²æ—¶å’Œéƒ¨ç½²åå‘åˆçº¦è½¬è´¦</strong>ã€‚</p>
<pre><code class="language-solidity">contract SendETH {
    // æ„é€ å‡½æ•°ï¼Œpayableä½¿å¾—éƒ¨ç½²çš„æ—¶å€™å¯ä»¥è½¬ethè¿›å»
    constructor() payable{}
    // receiveæ–¹æ³•ï¼Œæ¥æ”¶ethæ—¶è¢«è§¦å‘
    receive() external payable{}
}
</code></pre>
<h4 id="transfer">transfer</h4>
<ul>
<li>ç”¨æ³•æ˜¯<code>æ¥æ”¶æ–¹åœ°å€.transfer(å‘é€ETHæ•°é¢)</code>ã€‚</li>
<li><code>transfer()</code>çš„<code>gas</code>é™åˆ¶æ˜¯<code>2300</code>ï¼Œè¶³å¤Ÿç”¨äºè½¬è´¦ï¼Œä½†å¯¹æ–¹åˆçº¦çš„<code>fallback()</code>æˆ–<code>receive()</code>å‡½æ•°ä¸èƒ½å®ç°å¤ªå¤æ‚çš„é€»è¾‘ã€‚</li>
<li><code>transfer()</code>å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¼šè‡ªåŠ¨<code>revert</code>ï¼ˆå›æ»šäº¤æ˜“ï¼‰ã€‚</li>
</ul>
<p>ä»£ç æ ·ä¾‹ï¼Œæ³¨æ„é‡Œé¢çš„<code>_to</code>å¡«<code>ReceiveETH</code>åˆçº¦çš„åœ°å€ï¼Œ<code>amount</code>æ˜¯<code>ETH</code>è½¬è´¦é‡‘é¢ï¼š</p>
<pre><code class="language-solidity">// ç”¨transfer()å‘é€ETH
function transferETH(address payable _to, uint256 amount) external payable{
    _to.transfer(amount);
}
</code></pre>
<p>éƒ¨ç½²<code>SendETH</code>åˆçº¦åï¼Œå¯¹<code>ReceiveETH</code>åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º0ï¼Œ<code>amount</code>&gt;<code>value</code>ï¼Œè½¬è´¦å¤±è´¥ï¼Œå‘ç”Ÿ<code>revert</code>ã€‚</p>
<figure data-type="image" tabindex="63"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115124545643.png" alt="amount å¤§äº valueï¼Œè½¬è´¦å¤±è´¥" loading="lazy"></figure>
<p>æ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º10ï¼Œ<code>amount</code>&lt;=<code>value</code>ï¼Œè½¬è´¦æˆåŠŸã€‚</p>
<figure data-type="image" tabindex="64"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115125019477.png" alt="è½¬è´¦æˆåŠŸ" loading="lazy"></figure>
<h4 id="send">send</h4>
<ul>
<li>ç”¨æ³•æ˜¯<code>æ¥æ”¶æ–¹åœ°å€.send(å‘é€ETHæ•°é¢)</code>ã€‚</li>
<li><code>send()</code>çš„<code>gas</code>é™åˆ¶æ˜¯<code>2300</code>ï¼Œè¶³å¤Ÿç”¨äºè½¬è´¦ï¼Œä½†å¯¹æ–¹åˆçº¦çš„<code>fallback()</code>æˆ–<code>receive()</code>å‡½æ•°ä¸èƒ½å®ç°å¤ªå¤æ‚çš„é€»è¾‘ã€‚</li>
<li><code>send()</code>å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¸ä¼š<code>revert</code>ã€‚</li>
<li><code>send()</code>çš„è¿”å›å€¼æ˜¯<code>bool</code>ï¼Œä»£è¡¨ç€è½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéœ€è¦é¢å¤–ä»£ç å¤„ç†ä¸€ä¸‹ã€‚</li>
</ul>
<p>ä»£ç æ ·ä¾‹ï¼š</p>
<pre><code class="language-solidity">// send()å‘é€ETH
function sendETH(address payable _to, uint256 amount) external payable{
    // å¤„ç†ä¸‹sendçš„è¿”å›å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œrevertäº¤æ˜“å¹¶å‘é€error
    bool success = _to.send(amount);
    if(!success){
        revert SendFailed();
    }
}
</code></pre>
<p>å¯¹<code>ReceiveETH</code>åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º0ï¼Œ<code>amount</code>&gt;<code>value</code>ï¼Œè½¬è´¦å¤±è´¥ï¼Œå› ä¸ºç»è¿‡å¤„ç†ï¼Œæ‰€ä»¥å‘ç”Ÿ<code>revert</code>ã€‚</p>
<figure data-type="image" tabindex="65"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115131454004.png" alt="sendå‘é€å¤±è´¥" loading="lazy"></figure>
<p>æ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º11ï¼Œ<code>amount</code>&lt;=<code>value</code>ï¼Œè½¬è´¦æˆåŠŸã€‚</p>
<figure data-type="image" tabindex="66"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115131639448.png" alt="sendå‘é€æˆåŠŸ" loading="lazy"></figure>
<h4 id="call">call</h4>
<ul>
<li>ç”¨æ³•æ˜¯<code>æ¥æ”¶æ–¹åœ°å€.call{value: å‘é€ETHæ•°é¢}(&quot;&quot;)</code>ã€‚</li>
<li><code>call()</code>æ²¡æœ‰<code>gas</code>é™åˆ¶ï¼Œå¯ä»¥æ”¯æŒå¯¹æ–¹åˆçº¦<code>fallback()</code>æˆ–<code>receive()</code>å‡½æ•°å®ç°å¤æ‚é€»è¾‘ã€‚</li>
<li><code>call()</code>å¦‚æœè½¬è´¦å¤±è´¥ï¼Œä¸ä¼š<code>revert</code>ã€‚</li>
<li><code>call()</code>çš„è¿”å›å€¼æ˜¯<code>(bool, data)</code>ï¼Œå…¶ä¸­<code>bool</code>ä»£è¡¨ç€è½¬è´¦æˆåŠŸæˆ–å¤±è´¥ï¼Œéœ€è¦é¢å¤–ä»£ç å¤„ç†ä¸€ä¸‹ã€‚</li>
</ul>
<p>ä»£ç æ ·ä¾‹ï¼š</p>
<pre><code class="language-solidity">// call()å‘é€ETH
function callETH(address payable _to, uint256 amount) external payable{
    // å¤„ç†ä¸‹callçš„è¿”å›å€¼ï¼Œå¦‚æœå¤±è´¥ï¼Œrevertäº¤æ˜“å¹¶å‘é€error
    (bool success,) = _to.call{value: amount}(&quot;&quot;);
    if(!success){
        revert CallFailed();
    }
}
</code></pre>
<p>å¯¹<code>ReceiveETH</code>åˆçº¦å‘é€ETHï¼Œæ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º0ï¼Œ<code>amount</code>&gt;<code>value</code>ï¼Œè½¬è´¦å¤±è´¥ï¼Œå› ä¸ºç»è¿‡å¤„ç†ï¼Œæ‰€ä»¥å‘ç”Ÿ<code>revert</code>ã€‚</p>
<figure data-type="image" tabindex="67"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115125523238.png" alt="callè°ƒç”¨å¤±è´¥" loading="lazy"></figure>
<p>æ­¤æ—¶<code>amount</code>ä¸º10ï¼Œ<code>value</code>ä¸º11ï¼Œ<code>amount</code>&lt;=<code>value</code>ï¼Œè½¬è´¦æˆåŠŸã€‚</p>
<figure data-type="image" tabindex="68"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115131004187.png" alt="callè½¬è´¦æˆåŠŸ" loading="lazy"></figure>
<h3 id="21-è°ƒç”¨å…¶ä»–åˆçº¦">21. è°ƒç”¨å…¶ä»–åˆçº¦</h3>
<p>å¼€å‘è€…å†™æ™ºèƒ½åˆçº¦æ¥è°ƒç”¨å…¶ä»–åˆçº¦ï¼Œè¿™è®©ä»¥å¤ªåŠç½‘ç»œä¸Šçš„ç¨‹åº<strong>å¯ä»¥å¤ç”¨</strong>ï¼Œä»è€Œå»ºç«‹ç¹è£çš„ç”Ÿæ€ã€‚å¾ˆå¤š<code>web3</code>é¡¹ç›®ä¾èµ–äºè°ƒç”¨å…¶ä»–åˆçº¦ï¼Œæ¯”å¦‚æ”¶ç›Šå†œåœºï¼ˆ<code>yield farming</code>ï¼‰ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»å¦‚ä½•åœ¨å·²çŸ¥åˆçº¦ä»£ç ï¼ˆæˆ–æ¥å£ï¼‰å’Œåœ°å€æƒ…å†µä¸‹è°ƒç”¨ç›®æ ‡åˆçº¦çš„å‡½æ•°ã€‚</p>
<h4 id="ç›®æ ‡åˆçº¦">ç›®æ ‡åˆçº¦</h4>
<p>è¿™ä¸ªåˆçº¦åŒ…å«ä¸€ä¸ªçŠ¶æ€å˜é‡<code>_x</code>ï¼Œä¸€ä¸ªäº‹ä»¶<code>Log</code>åœ¨æ”¶åˆ°<code>ETH</code>æ—¶è§¦å‘ï¼Œä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li><code>getBalance()</code>: è¿”å›åˆçº¦<code>ETH</code>ä½™é¢ã€‚</li>
<li><code>setX()</code>: <code>external payable</code>å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®<code>_x</code>çš„å€¼ï¼Œå¹¶å‘åˆçº¦å‘é€<code>ETH</code>ã€‚</li>
<li><code>getX()</code>: è¯»å–<code>_x</code>çš„å€¼</li>
</ul>
<pre><code class="language-solidity">contract OtherContract {
    uint256 private _x = 0; // çŠ¶æ€å˜é‡_x
    // æ”¶åˆ°ethçš„äº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);
    
    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }

    // å¯ä»¥è°ƒæ•´çŠ¶æ€å˜é‡_xçš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¾€åˆçº¦è½¬ETH (payable)
    function setX(uint256 x) external payable{
        _x = x;
        // å¦‚æœè½¬å…¥ETHï¼Œåˆ™é‡Šæ”¾Logäº‹ä»¶
        if(msg.value &gt; 0){
            emit Log(msg.value, gasleft());
        }
    }

    // è¯»å–_x
    function getX() external view returns(uint x){
        x = _x;
    }
}
</code></pre>
<h4 id="è°ƒç”¨othercontractåˆçº¦">è°ƒç”¨OtherContractåˆçº¦</h4>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆçº¦çš„åœ°å€å’Œåˆçº¦ä»£ç ï¼ˆæˆ–æ¥å£ï¼‰æ¥åˆ›å»ºåˆçº¦çš„å¼•ç”¨ï¼š<code>_Name(_Address)</code>ï¼Œå…¶ä¸­<code>_Name</code>æ˜¯åˆçº¦åï¼Œ<code>_Address</code>æ˜¯åˆçº¦åœ°å€ã€‚ç„¶åç”¨åˆçº¦çš„å¼•ç”¨æ¥è°ƒç”¨å®ƒçš„å‡½æ•°ï¼š<code>_Name(_Address).f()</code>ï¼Œå…¶ä¸­<code>f()</code>æ˜¯è¦è°ƒç”¨çš„å‡½æ•°ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ä»‹ç»4ä¸ªè°ƒç”¨åˆçº¦çš„ä¾‹å­ï¼Œåœ¨remixä¸­ç¼–è¯‘åˆçº¦åï¼Œåˆ†åˆ«éƒ¨ç½²<code>OtherContract</code>å’Œ<code>CallContract</code>ï¼š</p>
<h5 id="1-ä¼ å…¥åˆçº¦åœ°å€">1. ä¼ å…¥åˆçº¦åœ°å€</h5>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œä¼ å…¥ç›®æ ‡åˆçº¦åœ°å€ï¼Œç”Ÿæˆç›®æ ‡åˆçº¦çš„å¼•ç”¨ï¼Œç„¶åè°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä»¥è°ƒç”¨<code>OtherContract</code>åˆçº¦çš„<code>setX</code>å‡½æ•°ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨æ–°åˆçº¦ä¸­å†™ä¸€ä¸ª<code>callSetX</code>å‡½æ•°ï¼Œä¼ å…¥å·²éƒ¨ç½²å¥½çš„<code>OtherContract</code>åˆçº¦åœ°å€<code>_Address</code>å’Œ<code>setX</code>çš„å‚æ•°<code>x</code>ï¼š</p>
<pre><code class="language-solidity">function callSetX(address _Address, uint256 x) external{
    OtherContract(_Address).setX(x);
}
</code></pre>
<p>å¤åˆ¶<code>OtherContract</code>åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥<code>callSetX</code>å‡½æ•°çš„å‚æ•°ä¸­</p>
<figure data-type="image" tabindex="69"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115133953897.png" alt="image-20221115133953897" loading="lazy"></figure>
<p>æˆåŠŸè°ƒç”¨åï¼Œè°ƒç”¨<code>OtherContract</code>åˆçº¦ä¸­çš„<code>getX</code>éªŒè¯<code>x</code>å˜ä¸º123</p>
<figure data-type="image" tabindex="70"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115134253074.png" alt="éªŒè¯x" loading="lazy"></figure>
<h5 id="2-ä¼ å…¥åˆçº¦å˜é‡">2. ä¼ å…¥åˆçº¦å˜é‡</h5>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨å‡½æ•°é‡Œä¼ å…¥åˆçº¦çš„å¼•ç”¨ï¼Œåªéœ€è¦æŠŠä¸Šé¢å‚æ•°çš„<code>address</code>ç±»å‹æ”¹ä¸ºç›®æ ‡åˆçº¦åï¼Œæ¯”å¦‚<code>OtherContract</code>ã€‚ä¸‹é¢ä¾‹å­å®ç°äº†è°ƒç”¨ç›®æ ‡åˆçº¦çš„<code>getX()</code>å‡½æ•°ã€‚</p>
<p><strong>æ³¨æ„</strong>è¯¥å‡½æ•°å‚æ•°<code>OtherContract _Address</code>åº•å±‚ç±»å‹ä»ç„¶æ˜¯<code>address</code>ï¼Œç”Ÿæˆçš„<code>ABI</code>ä¸­ã€è°ƒç”¨<code>callGetX</code>æ—¶ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯<code>address</code>ç±»å‹</p>
<pre><code class="language-solidity">function callGetX(OtherContract _Address) external view returns(uint x){
	x = _Address.getX();
}
</code></pre>
<p>å¤åˆ¶<code>OtherContract</code>åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥<code>callGetX</code>å‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–<code>x</code>çš„å€¼</p>
<figure data-type="image" tabindex="71"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115134728806.png" alt="è·å–xçš„å€¼" loading="lazy"></figure>
<h5 id="3-åˆ›å»ºåˆçº¦å˜é‡">3. åˆ›å»ºåˆçº¦å˜é‡</h5>
<p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºåˆçº¦å˜é‡ï¼Œç„¶åé€šè¿‡å®ƒæ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä¸‹é¢ä¾‹å­ï¼Œæˆ‘ä»¬ç»™å˜é‡<code>oc</code>å­˜å‚¨äº†<code>OtherContract</code>åˆçº¦çš„å¼•ç”¨ï¼š</p>
<pre><code class="language-solidity">function callGetX2(address _Address) external view returns(uint x){
    OtherContract oc = OtherContract(_Address);
    x = oc.getX();
}
</code></pre>
<p>å¤åˆ¶<code>OtherContract</code>åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥<code>callGetX2</code>å‡½æ•°çš„å‚æ•°ä¸­ï¼Œè°ƒç”¨åæˆåŠŸè·å–<code>x</code>çš„å€¼</p>
<figure data-type="image" tabindex="72"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115135110265.png" alt="æˆåŠŸè·å–xçš„å€¼" loading="lazy"></figure>
<h5 id="4-è°ƒç”¨åˆçº¦å¹¶å‘é€eth">4. è°ƒç”¨åˆçº¦å¹¶å‘é€<code>ETH</code></h5>
<p>å¦‚æœç›®æ ‡åˆçº¦çš„å‡½æ•°æ˜¯<code>payable</code>çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ƒæ¥ç»™åˆçº¦è½¬è´¦ï¼š<code>_Name(_Address).f{value: _Value}()</code>ï¼Œå…¶ä¸­<code>_Name</code>æ˜¯åˆçº¦åï¼Œ<code>_Address</code>æ˜¯åˆçº¦åœ°å€ï¼Œ<code>f</code>æ˜¯ç›®æ ‡å‡½æ•°åï¼Œ<code>_Value</code>æ˜¯è¦è½¬çš„<code>ETH</code>æ•°é¢ï¼ˆä»¥<code>wei</code>ä¸ºå•ä½ï¼‰ã€‚</p>
<p><code>OtherContract</code>åˆçº¦çš„<code>setX</code>å‡½æ•°æ˜¯<code>payable</code>çš„ï¼Œåœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>setX</code>æ¥å¾€ç›®æ ‡åˆçº¦è½¬è´¦ã€‚</p>
<pre><code class="language-solidity">function setXTransferETH(address otherContract, uint256 x) payable external{
    OtherContract(otherContract).setX{value: msg.value}(x);
}
</code></pre>
<p>å¤åˆ¶<code>OtherContract</code>åˆçº¦çš„åœ°å€ï¼Œå¡«å…¥<code>setXTransferETH</code>å‡½æ•°çš„å‚æ•°ä¸­ï¼Œå¹¶è½¬å…¥10ETH</p>
<figure data-type="image" tabindex="73"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115140121469.png" alt="setXTransferETHå‡½æ•°" loading="lazy"></figure>
<p>è½¬è´¦åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Log</code>äº‹ä»¶å’Œ<code>getBalance()</code>å‡½æ•°è§‚å¯Ÿç›®æ ‡åˆçº¦<code>ETH</code>ä½™é¢çš„å˜åŒ–ã€‚</p>
<figure data-type="image" tabindex="74"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115140237100.png" alt="getBalanceå˜åŒ–" loading="lazy"></figure>
<h3 id="22-call">22. Call</h3>
<p>åˆ©ç”¨<code>call</code>æ¥è°ƒç”¨åˆçº¦ã€‚</p>
<p><code>call</code> æ˜¯<code>address</code>ç±»å‹çš„ä½çº§æˆå‘˜å‡½æ•°ï¼Œå®ƒç”¨æ¥ä¸å…¶ä»–åˆçº¦äº¤äº’ã€‚å®ƒçš„è¿”å›å€¼ä¸º<code>(bool, data)</code>ï¼Œåˆ†åˆ«å¯¹åº”<code>call</code>æ˜¯å¦æˆåŠŸä»¥åŠç›®æ ‡å‡½æ•°çš„è¿”å›å€¼ã€‚</p>
<ul>
<li><code>call</code>æ˜¯<code>solidity</code>å®˜æ–¹æ¨èçš„é€šè¿‡è§¦å‘<code>fallback</code>æˆ–<code>receive</code>å‡½æ•°å‘é€<code>ETH</code>çš„æ–¹æ³•ã€‚</li>
<li>ä¸æ¨èç”¨<code>call</code>æ¥è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ï¼Œå› ä¸ºå½“ä½ è°ƒç”¨ä¸å®‰å…¨åˆçº¦çš„å‡½æ•°æ—¶ï¼Œä½ å°±æŠŠä¸»åŠ¨æƒäº¤ç»™äº†å®ƒã€‚<strong>æ¨èçš„æ–¹æ³•ä»æ˜¯å£°æ˜åˆçº¦å˜é‡åè°ƒç”¨å‡½æ•°</strong>ï¼Œè§<a href="https://github.com/AmazingAng/WTFSolidity/tree/main/21_CallContract">ç¬¬21è®²ï¼šè°ƒç”¨å…¶ä»–åˆçº¦</a></li>
<li>å½“æˆ‘ä»¬ä¸çŸ¥é“å¯¹æ–¹åˆçº¦çš„æºä»£ç æˆ–<code>ABI</code>ï¼Œå°±æ²¡æ³•ç”Ÿæˆåˆçº¦å˜é‡ï¼›è¿™æ—¶ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡<code>call</code>è°ƒç”¨å¯¹æ–¹åˆçº¦çš„å‡½æ•°ã€‚</li>
</ul>
<h4 id="callçš„ä½¿ç”¨è§„åˆ™"><code>call</code>çš„ä½¿ç”¨è§„åˆ™</h4>
<p><code>call</code>çš„ä½¿ç”¨è§„åˆ™å¦‚ä¸‹ï¼š</p>
<pre><code class="language-text">ç›®æ ‡åˆçº¦åœ°å€.call(äºŒè¿›åˆ¶ç¼–ç );
</code></pre>
<p>å…¶ä¸­<code>äºŒè¿›åˆ¶ç¼–ç </code>åˆ©ç”¨ç»“æ„åŒ–ç¼–ç å‡½æ•°<code>abi.encodeWithSignature</code>è·å¾—ï¼š</p>
<pre><code class="language-text">abi.encodeWithSignature(&quot;å‡½æ•°ç­¾å&quot;, é€—å·åˆ†éš”çš„å…·ä½“å‚æ•°)
</code></pre>
<p><code>å‡½æ•°ç­¾å</code>ä¸º<code>&quot;å‡½æ•°åï¼ˆé€—å·åˆ†éš”çš„å‚æ•°ç±»å‹)&quot;</code>ã€‚ä¾‹å¦‚<code>abi.encodeWithSignature(&quot;f(uint256,address)&quot;, _x, _addr)</code>ã€‚</p>
<p>å¦å¤–<code>call</code>åœ¨è°ƒç”¨åˆçº¦æ—¶å¯ä»¥æŒ‡å®šäº¤æ˜“å‘é€çš„<code>ETH</code>æ•°é¢å’Œ<code>gas</code>ï¼š</p>
<pre><code class="language-text">ç›®æ ‡åˆçº¦åœ°å€.call{value:å‘é€æ•°é¢, gas:gasæ•°é¢}(äºŒè¿›åˆ¶ç¼–ç );
</code></pre>
<p>çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œä¸‹é¢æˆ‘ä»¬ä¸¾ä¸ª<code>call</code>åº”ç”¨çš„ä¾‹å­ã€‚</p>
<h4 id="ç›®æ ‡åˆçº¦-2">ç›®æ ‡åˆçº¦</h4>
<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ç›®æ ‡åˆçº¦<code>OtherContract</code>å¹¶éƒ¨ç½²ï¼Œä»£ç ä¸ç¬¬19è®²ä¸­åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯å¤šäº†<code>fallback</code>å‡½æ•°ã€‚</p>
<pre><code class="language-solidity">contract OtherContract {
    uint256 private _x = 0; // çŠ¶æ€å˜é‡x
    // æ”¶åˆ°ethçš„äº‹ä»¶ï¼Œè®°å½•amountå’Œgas
    event Log(uint amount, uint gas);
    
    fallback() external payable{}

    // è¿”å›åˆçº¦ETHä½™é¢
    function getBalance() view public returns(uint) {
        return address(this).balance;
    }

    // å¯ä»¥è°ƒæ•´çŠ¶æ€å˜é‡_xçš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥å¾€åˆçº¦è½¬ETH (payable)
    function setX(uint256 x) external payable{
        _x = x;
        // å¦‚æœè½¬å…¥ETHï¼Œåˆ™é‡Šæ”¾Logäº‹ä»¶
        if(msg.value &gt; 0){
            emit Log(msg.value, gasleft());
        }
    }

    // è¯»å–x
    function getX() external view returns(uint x){
        x = _x;
    }
}
</code></pre>
<p>è¿™ä¸ªåˆçº¦åŒ…å«ä¸€ä¸ªçŠ¶æ€å˜é‡<code>x</code>ï¼Œä¸€ä¸ªåœ¨æ”¶åˆ°<code>ETH</code>æ—¶è§¦å‘çš„äº‹ä»¶<code>Log</code>ï¼Œä¸‰ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li><code>getBalance()</code>: è¿”å›åˆçº¦<code>ETH</code>ä½™é¢ã€‚</li>
<li><code>setX()</code>: <code>external payable</code>å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®<code>x</code>çš„å€¼ï¼Œå¹¶å‘åˆçº¦å‘é€<code>ETH</code>ã€‚</li>
<li><code>getX()</code>: è¯»å–<code>x</code>çš„å€¼ã€‚</li>
</ul>
<h4 id="åˆ©ç”¨callè°ƒç”¨ç›®æ ‡åˆçº¦">åˆ©ç”¨<code>call</code>è°ƒç”¨ç›®æ ‡åˆçº¦</h4>
<p><strong>1. Responseäº‹ä»¶</strong></p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ª<code>Call</code>åˆçº¦æ¥è°ƒç”¨ç›®æ ‡åˆçº¦å‡½æ•°ã€‚é¦–å…ˆå®šä¹‰ä¸€ä¸ª<code>Response</code>äº‹ä»¶ï¼Œè¾“å‡º<code>call</code>è¿”å›çš„<code>success</code>å’Œ<code>data</code>ï¼Œæ–¹ä¾¿æˆ‘ä»¬è§‚å¯Ÿè¿”å›å€¼ã€‚</p>
<pre><code class="language-solidity">// å®šä¹‰Responseäº‹ä»¶ï¼Œè¾“å‡ºcallè¿”å›çš„ç»“æœsuccesså’Œdata
event Response(bool success, bytes data);
</code></pre>
<p><strong>2. è°ƒç”¨setXå‡½æ•°</strong></p>
<p>æˆ‘ä»¬å®šä¹‰<code>callSetX</code>å‡½æ•°æ¥è°ƒç”¨ç›®æ ‡åˆçº¦çš„<code>setX()</code>ï¼Œè½¬å…¥<code>msg.value</code>æ•°é¢çš„<code>ETH</code>ï¼Œå¹¶é‡Šæ”¾<code>Response</code>äº‹ä»¶è¾“å‡º<code>success</code>å’Œ<code>data</code>ï¼š</p>
<pre><code class="language-solidity">function callSetX(address payable _addr, uint256 x) public payable {
    // call setX()ï¼ŒåŒæ—¶å¯ä»¥å‘é€ETH
    (bool success, bytes memory data) = _addr.call{value: msg.value}(
        abi.encodeWithSignature(&quot;setX(uint256)&quot;, x)
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
}
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨<code>callSetX</code>æŠŠçŠ¶æ€å˜é‡<code>_x</code>æ”¹ä¸º5ï¼Œå‚æ•°ä¸º<code>OtherContract</code>åœ°å€å’Œ<code>5</code>ï¼Œç”±äºç›®æ ‡å‡½æ•°<code>setX()</code>æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤<code>Response</code>äº‹ä»¶è¾“å‡ºçš„<code>data</code>ä¸º<code>0x</code>ï¼Œä¹Ÿå°±æ˜¯ç©ºã€‚</p>
<figure data-type="image" tabindex="75"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115143818700.png" alt="è°ƒç”¨setå‡½æ•°æˆåŠŸ" loading="lazy"></figure>
<p><strong>3. è°ƒç”¨getXå‡½æ•°</strong></p>
<p>ä¸‹é¢æˆ‘ä»¬è°ƒç”¨<code>getX()</code>å‡½æ•°ï¼Œå®ƒå°†è¿”å›ç›®æ ‡åˆçº¦<code>_x</code>çš„å€¼ï¼Œç±»å‹ä¸º<code>uint256</code>ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>abi.decode</code>æ¥è§£ç <code>call</code>çš„è¿”å›å€¼<code>data</code>ï¼Œå¹¶è¯»å‡ºæ•°å€¼ã€‚</p>
<pre><code class="language-solidity">function callGetX(address _addr) external returns(uint256){
    // call getX()
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature(&quot;getX()&quot;)
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
    return abi.decode(data, (uint256));
}
</code></pre>
<p>ä»<code>Response</code>äº‹ä»¶çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>data</code>ä¸º<code>0x0000000000000000000000000000000000000000000000000000000000000005</code>ã€‚è€Œç»è¿‡<code>abi.decode</code>ï¼Œæœ€ç»ˆè¿”å›å€¼ä¸º<code>5</code>ã€‚</p>
<figure data-type="image" tabindex="76"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115144414577.png" alt="callè°ƒç”¨getXå‡½æ•°" loading="lazy"></figure>
<p><strong>4. è°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°</strong></p>
<p>å¦‚æœæˆ‘ä»¬ç»™<code>call</code>è¾“å…¥çš„å‡½æ•°ä¸å­˜åœ¨äºç›®æ ‡åˆçº¦ï¼Œé‚£ä¹ˆç›®æ ‡åˆçº¦çš„<code>fallback</code>å‡½æ•°ä¼šè¢«è§¦å‘ã€‚</p>
<pre><code class="language-solidity">function callNonExist(address _addr) external{
    // call getX()
    (bool success, bytes memory data) = _addr.call(
        abi.encodeWithSignature(&quot;foo(uint256)&quot;)
    );

    emit Response(success, data); //é‡Šæ”¾äº‹ä»¶
}
</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬<code>call</code>äº†ä¸å­˜åœ¨çš„<code>foo</code>å‡½æ•°ã€‚<code>call</code>ä»èƒ½æ‰§è¡ŒæˆåŠŸï¼Œå¹¶è¿”å›<code>success</code>ï¼Œä½†å…¶å®è°ƒç”¨çš„ç›®æ ‡åˆçº¦<code>fallback</code>å‡½æ•°ã€‚</p>
<figure data-type="image" tabindex="77"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115144610997.png" alt="callè°ƒç”¨ä¸å­˜åœ¨çš„å‡½æ•°" loading="lazy"></figure>
<h3 id="23-delegatecall">23. Delegatecall</h3>
<p><code>delegatecall</code>ä¸<code>call</code>ç±»ä¼¼ï¼Œæ˜¯<code>solidity</code>ä¸­åœ°å€ç±»å‹çš„<strong>ä½çº§æˆå‘˜å‡½æ•°</strong>ã€‚<code>delegate</code>ä¸­æ˜¯å§”æ‰˜/ä»£è¡¨çš„æ„æ€ï¼Œé‚£ä¹ˆ<code>delegatecall</code>å§”æ‰˜äº†ä»€ä¹ˆï¼Ÿ<code>B call C</code>ï¼Œè¯­å¢ƒä¸º<code>C</code>ï¼›è€Œ<code>B delegatecall C</code>ï¼Œè¯­å¢ƒä¸º<code>B</code>ã€‚</p>
<p>å½“ç”¨æˆ·<code>A</code>é€šè¿‡åˆçº¦<code>B</code>æ¥<code>call</code>åˆçº¦<code>C</code>çš„æ—¶å€™ï¼Œæ‰§è¡Œçš„æ˜¯åˆçº¦<code>C</code>çš„å‡½æ•°ï¼Œ<code>è¯­å¢ƒ</code>(<code>Context</code>ï¼Œå¯ä»¥ç†è§£ä¸ºåŒ…å«å˜é‡å’ŒçŠ¶æ€çš„ç¯å¢ƒ)ä¹Ÿæ˜¯åˆçº¦<code>C</code>çš„ï¼š<code>msg.sender</code>æ˜¯<code>B</code>çš„åœ°å€ï¼Œå¹¶ä¸”å¦‚æœå‡½æ•°æ”¹å˜ä¸€äº›çŠ¶æ€å˜é‡ï¼Œäº§ç”Ÿçš„æ•ˆæœä¼šä½œç”¨äºåˆçº¦<code>C</code>çš„å˜é‡ä¸Šã€‚</p>
<figure data-type="image" tabindex="78"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115150244163.png" alt="æ™®é€šcall" loading="lazy"></figure>
<p>è€Œå½“ç”¨æˆ·<code>A</code>é€šè¿‡åˆçº¦<code>B</code>æ¥<code>delegatecall</code>åˆçº¦<code>C</code>çš„æ—¶å€™ï¼Œæ‰§è¡Œçš„æ˜¯åˆçº¦<code>C</code>çš„å‡½æ•°ï¼Œä½†æ˜¯<code>è¯­å¢ƒ</code>ä»æ˜¯åˆçº¦<code>B</code>çš„ï¼š<code>msg.sender</code>æ˜¯<code>A</code>çš„åœ°å€ï¼Œå¹¶ä¸”å¦‚æœå‡½æ•°æ”¹å˜ä¸€äº›çŠ¶æ€å˜é‡ï¼Œäº§ç”Ÿçš„æ•ˆæœä¼šä½œç”¨äºåˆçº¦<code>B</code>çš„å˜é‡ä¸Šã€‚</p>
<figure data-type="image" tabindex="79"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115150344469.png" alt="delegatecall" loading="lazy"></figure>
<p>å¤§å®¶å¯ä»¥è¿™æ ·ç†è§£ï¼šä¸€ä¸ª<code>å¯Œå•†</code>æŠŠå®ƒçš„èµ„äº§ï¼ˆ<code>çŠ¶æ€å˜é‡</code>ï¼‰éƒ½äº¤ç»™ä¸€ä¸ª<code>VC</code>ä»£ç†ï¼ˆ<code>ç›®æ ‡åˆçº¦</code>çš„å‡½æ•°ï¼‰æ¥æ‰“ç†ã€‚æ‰§è¡Œçš„æ˜¯<code>VC</code>çš„å‡½æ•°ï¼Œä½†æ˜¯æ”¹å˜çš„æ˜¯<code>å¯Œå•†</code>çš„çŠ¶æ€ã€‚</p>
<p><code>delegatecall</code>è¯­æ³•å’Œ<code>call</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ï¼š</p>
<pre><code class="language-solidity">ç›®æ ‡åˆçº¦åœ°å€.delegatecall(äºŒè¿›åˆ¶ç¼–ç );
</code></pre>
<p>å…¶ä¸­<code>äºŒè¿›åˆ¶ç¼–ç </code>åˆ©ç”¨ç»“æ„åŒ–ç¼–ç å‡½æ•°<code>abi.encodeWithSignature</code>è·å¾—ï¼š</p>
<pre><code class="language-solidity">abi.encodeWithSignature(&quot;å‡½æ•°ç­¾å&quot;, é€—å·åˆ†éš”çš„å…·ä½“å‚æ•°)
</code></pre>
<p><code>å‡½æ•°ç­¾å</code>ä¸º<code>&quot;å‡½æ•°åï¼ˆé€—å·åˆ†éš”çš„å‚æ•°ç±»å‹)&quot;</code>ã€‚ä¾‹å¦‚<code>abi.encodeWithSignature(&quot;f(uint256,address)&quot;, _x, _addr)</code>ã€‚</p>
<p>å’Œ<code>call</code>ä¸ä¸€æ ·ï¼Œ<code>delegatecall</code>åœ¨è°ƒç”¨åˆçº¦æ—¶å¯ä»¥<strong>æŒ‡å®šäº¤æ˜“å‘é€çš„</strong><code>gas</code>ï¼Œä½†ä¸èƒ½æŒ‡å®šå‘é€çš„<code>ETH</code>æ•°é¢</p>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼š<code>delegatecall</code>æœ‰å®‰å…¨éšæ‚£ï¼Œä½¿ç”¨æ—¶è¦ä¿è¯å½“å‰åˆçº¦å’Œç›®æ ‡åˆçº¦çš„<strong>çŠ¶æ€å˜é‡å­˜å‚¨ç»“æ„ç›¸åŒ</strong>ï¼Œå¹¶ä¸”ç›®æ ‡åˆçº¦å®‰å…¨ï¼Œä¸ç„¶ä¼šé€ æˆèµ„äº§æŸå¤±ã€‚<strong>(å˜é‡åå¯ä»¥ä¸åŒï¼Œå˜é‡ç±»å‹ã€å£°æ˜é¡ºåºå¿…é¡»ç›¸åŒ)</strong></p>
</blockquote>
<h4 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°delegatecall">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°<code>delegatecall</code>?</h4>
<p>ç›®å‰<code>delegatecall</code>ä¸»è¦æœ‰ä¸¤ä¸ªåº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>ä»£ç†åˆçº¦ï¼ˆ<code>Proxy Contract</code>ï¼‰ï¼šå°†æ™ºèƒ½åˆçº¦çš„å­˜å‚¨åˆçº¦å’Œé€»è¾‘åˆçº¦åˆ†å¼€ï¼šä»£ç†åˆçº¦ï¼ˆ<code>Proxy Contract</code>ï¼‰å­˜å‚¨æ‰€æœ‰ç›¸å…³çš„å˜é‡ï¼Œå¹¶ä¸”ä¿å­˜é€»è¾‘åˆçº¦çš„åœ°å€ï¼›æ‰€æœ‰å‡½æ•°å­˜åœ¨é€»è¾‘åˆçº¦ï¼ˆ<code>Logic Contract</code>ï¼‰é‡Œï¼Œé€šè¿‡<code>delegatecall</code>æ‰§è¡Œã€‚å½“å‡çº§æ—¶ï¼Œåªéœ€è¦å°†ä»£ç†åˆçº¦æŒ‡å‘æ–°çš„é€»è¾‘åˆçº¦å³å¯ã€‚</li>
<li>EIP-2535 Diamondsï¼ˆé’»çŸ³ï¼‰ï¼šé’»çŸ³æ˜¯ä¸€ä¸ªæ”¯æŒæ„å»ºå¯åœ¨ç”Ÿäº§ä¸­æ‰©å±•çš„æ¨¡å—åŒ–æ™ºèƒ½åˆçº¦ç³»ç»Ÿçš„æ ‡å‡†ã€‚é’»çŸ³æ˜¯å…·æœ‰å¤šä¸ªå®æ–½åˆåŒçš„ä»£ç†åˆåŒã€‚ æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ï¼š<a href="https://eip2535diamonds.substack.com/p/introduction-to-the-diamond-standard">é’»çŸ³æ ‡å‡†ç®€ä»‹</a>ã€‚</li>
</ol>
<h4 id="delegatecallä¾‹å­"><code>delegatecall</code>ä¾‹å­</h4>
<p>è°ƒç”¨ç»“æ„ï¼šä½ ï¼ˆ<code>A</code>ï¼‰é€šè¿‡åˆçº¦<code>B</code>è°ƒç”¨ç›®æ ‡åˆçº¦<code>C</code>ã€‚</p>
<h5 id="è¢«è°ƒç”¨çš„åˆçº¦c">è¢«è°ƒç”¨çš„åˆçº¦C</h5>
<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ç›®æ ‡åˆçº¦<code>C</code>ï¼šæœ‰ä¸¤ä¸ª<code>public</code>å˜é‡ï¼š<code>num</code>å’Œ<code>sender</code>ï¼Œåˆ†åˆ«æ˜¯<code>uint256</code>å’Œ<code>address</code>ç±»å‹ï¼›æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å°†<code>num</code>è®¾å®šä¸ºä¼ å…¥çš„<code>_num</code>ï¼Œå¹¶ä¸”å°†<code>sender</code>è®¾ä¸º<code>msg.sender</code>ã€‚</p>
<pre><code class="language-solidity">// è¢«è°ƒç”¨çš„åˆçº¦C
contract C {
    uint public num;
    address public sender;

    function setVars(uint _num) public payable {
        num = _num;
        sender = msg.sender;
    }
}
</code></pre>
<h5 id="å‘èµ·è°ƒç”¨çš„åˆçº¦b">å‘èµ·è°ƒç”¨çš„åˆçº¦B</h5>
<p>é¦–å…ˆï¼Œåˆçº¦<code>B</code>å¿…é¡»å’Œç›®æ ‡åˆçº¦<code>C</code>çš„å˜é‡å­˜å‚¨å¸ƒå±€å¿…é¡»ç›¸åŒï¼Œä¸¤ä¸ªå˜é‡ï¼Œå¹¶ä¸”é¡ºåºä¸º<code>num</code>å’Œ<code>sender</code></p>
<pre><code class="language-solidity">contract B {
    uint public num;
    address public sender;
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨<code>call</code>å’Œ<code>delegatecall</code>æ¥è°ƒç”¨åˆçº¦<code>C</code>çš„<code>setVars</code>å‡½æ•°ï¼Œæ›´å¥½çš„ç†è§£å®ƒä»¬çš„åŒºåˆ«ã€‚</p>
<p><code>callSetVars</code>å‡½æ•°é€šè¿‡<code>call</code>æ¥è°ƒç”¨<code>setVars</code>ã€‚å®ƒæœ‰ä¸¤ä¸ªå‚æ•°<code>_addr</code>å’Œ<code>_num</code>ï¼Œåˆ†åˆ«å¯¹åº”åˆçº¦<code>C</code>çš„åœ°å€å’Œ<code>setVars</code>çš„å‚æ•°ã€‚</p>
<pre><code class="language-solidity">    // é€šè¿‡callæ¥è°ƒç”¨Cçš„setVars()å‡½æ•°ï¼Œå°†æ”¹å˜åˆçº¦Cé‡Œçš„çŠ¶æ€å˜é‡
    function callSetVars(address _addr, uint _num) external payable{
        // call setVars()
        (bool success, bytes memory data) = _addr.call(
            abi.encodeWithSignature(&quot;setVars(uint256)&quot;, _num)
        );
    }
</code></pre>
<p>è€Œ<code>delegatecallSetVars</code>å‡½æ•°é€šè¿‡<code>delegatecall</code>æ¥è°ƒç”¨<code>setVars</code>ã€‚ä¸ä¸Šé¢çš„<code>callSetVars</code>å‡½æ•°ç›¸åŒï¼Œæœ‰ä¸¤ä¸ªå‚æ•°<code>_addr</code>å’Œ<code>_num</code>ï¼Œåˆ†åˆ«å¯¹åº”åˆçº¦<code>C</code>çš„åœ°å€å’Œ<code>setVars</code>çš„å‚æ•°ã€‚</p>
<pre><code class="language-solidity">    // é€šè¿‡delegatecallæ¥è°ƒç”¨Cçš„setVars()å‡½æ•°ï¼Œå°†æ”¹å˜åˆçº¦Bé‡Œçš„çŠ¶æ€å˜é‡
    function delegatecallSetVars(address _addr, uint _num) external payable{
        // delegatecall setVars()
        (bool success, bytes memory data) = _addr.delegatecall(
            abi.encodeWithSignature(&quot;setVars(uint256)&quot;, _num)
        );
    }
}
</code></pre>
<h5 id="remix-éªŒè¯">remix éªŒè¯</h5>
<ol>
<li>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠåˆçº¦<code>B</code>å’Œ<code>C</code>éƒ½éƒ¨ç½²å¥½</li>
</ol>
<figure data-type="image" tabindex="80"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115151932843.png" alt="éƒ¨ç½²B C" loading="lazy"></figure>
<ol start="2">
<li>éƒ¨ç½²ä¹‹åï¼ŒæŸ¥çœ‹<code>C</code>åˆçº¦çŠ¶æ€å˜é‡çš„åˆå§‹å€¼ï¼Œ<code>B</code>åˆçº¦çš„çŠ¶æ€å˜é‡ä¹Ÿæ˜¯ä¸€æ ·ã€‚</li>
</ol>
<figure data-type="image" tabindex="81"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115152046534.png" alt="B C åˆçº¦çš„åˆå§‹å€¼å’ŒçŠ¶æ€å˜é‡" loading="lazy"></figure>
<ol start="3">
<li>æ­¤æ—¶ï¼Œè°ƒç”¨åˆçº¦<code>B</code>ä¸­çš„<code>callSetVars</code>ï¼Œä¼ å…¥å‚æ•°ä¸ºåˆçº¦<code>C</code>åœ°å€å’Œ<code>10</code>ï¼Œè¿è¡Œåï¼Œåˆçº¦<code>C</code>ä¸­çš„çŠ¶æ€å˜é‡å°†è¢«ä¿®æ”¹ï¼š<code>num</code>è¢«æ”¹ä¸º<code>10</code>ï¼Œ<code>sender</code>å˜ä¸ºåˆçº¦<code>B</code>çš„åœ°å€</li>
</ol>
<figure data-type="image" tabindex="82"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115152539058.png" alt="call" loading="lazy"></figure>
<ol start="4">
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨åˆçº¦<code>B</code>ä¸­çš„<code>delegatecallSetVars</code>ï¼Œä¼ å…¥å‚æ•°ä¸ºåˆçº¦<code>C</code>åœ°å€å’Œ<code>123</code>ã€‚ç”±äºæ˜¯<code>delegatecall</code>ï¼Œè¯­å¢ƒä¸ºåˆçº¦<code>B</code>ã€‚åœ¨è¿è¡Œåï¼Œåˆçº¦<code>B</code>ä¸­çš„çŠ¶æ€å˜é‡å°†è¢«ä¿®æ”¹ï¼š<code>num</code>è¢«æ”¹ä¸º<code>123</code>ï¼Œ<code>sender</code>å˜ä¸ºä½ çš„é’±åŒ…åœ°å€ã€‚åˆçº¦<code>C</code>ä¸­çš„çŠ¶æ€å˜é‡ä¸ä¼šè¢«ä¿®æ”¹ã€‚</li>
</ol>
<figure data-type="image" tabindex="83"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115152925951.png" alt="delegatecall" loading="lazy"></figure>
<h3 id="24-create">24. Create</h3>
<p>åœ¨ä»¥å¤ªåŠé“¾ä¸Šï¼Œç”¨æˆ·ï¼ˆå¤–éƒ¨è´¦æˆ·ï¼Œ<code>EOA</code>ï¼‰å¯ä»¥åˆ›å»ºæ™ºèƒ½åˆçº¦ï¼Œæ™ºèƒ½åˆçº¦åŒæ ·ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„æ™ºèƒ½åˆçº¦ã€‚å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€<code>uniswap</code>å°±æ˜¯åˆ©ç”¨å·¥å‚åˆçº¦ï¼ˆ<code>Factory</code>ï¼‰åˆ›å»ºäº†æ— æ•°ä¸ªå¸å¯¹åˆçº¦ï¼ˆ<code>Pair</code>ï¼‰ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä¼šç”¨ç®€åŒ–ç‰ˆçš„<code>uniswap</code>è®²å¦‚ä½•é€šè¿‡åˆçº¦åˆ›å»ºåˆçº¦ã€‚</p>
<h4 id="createå’Œcreate2"><code>create</code>å’Œ<code>create2</code></h4>
<p>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åœ¨åˆçº¦ä¸­åˆ›å»ºæ–°åˆçº¦ï¼Œ<code>create</code>å’Œ<code>create2</code>ï¼Œè¿™é‡Œæˆ‘ä»¬è®²<code>create</code>ï¼Œä¸‹ä¸€è®²ä¼šä»‹ç»<code>create2</code>ã€‚</p>
<p><code>create</code>çš„ç”¨æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯<code>new</code>ä¸€ä¸ªåˆçº¦ï¼Œå¹¶ä¼ å…¥æ–°åˆçº¦æ„é€ å‡½æ•°æ‰€éœ€çš„å‚æ•°ï¼š</p>
<pre><code class="language-solidity">Contract x = new Contract{value: _value}(params)
</code></pre>
<p>å…¶ä¸­<code>Contract</code>æ˜¯è¦åˆ›å»ºçš„åˆçº¦åï¼Œ<code>x</code>æ˜¯åˆçº¦å¯¹è±¡ï¼ˆåœ°å€ï¼‰ï¼Œå¦‚æœæ„é€ å‡½æ•°æ˜¯<code>payable</code>ï¼Œå¯ä»¥åˆ›å»ºæ—¶è½¬å…¥<code>_value</code>æ•°é‡çš„<code>ETH</code>ï¼Œ<code>params</code>æ˜¯<strong>æ–°åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</strong></p>
<h4 id="æç®€uniswap">æç®€Uniswap</h4>
<p><code>Uniswap V2</code><a href="https://github.com/Uniswap/v2-core/tree/master/contracts">æ ¸å¿ƒåˆçº¦</a>ä¸­åŒ…å«ä¸¤ä¸ªåˆçº¦ï¼š</p>
<ol>
<li>UniswapV2Pair: <strong>å¸å¯¹åˆçº¦</strong>ï¼Œç”¨äºç®¡ç†å¸å¯¹åœ°å€ã€æµåŠ¨æ€§ã€ä¹°å–ã€‚</li>
<li>UniswapV2Factory: <strong>å·¥å‚åˆçº¦</strong>ï¼Œç”¨äº<strong>åˆ›å»ºæ–°çš„å¸å¯¹</strong>ï¼Œå¹¶ç®¡ç†å¸å¯¹åœ°å€ã€‚</li>
</ol>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨<code>create</code>æ–¹æ³•å®ç°ä¸€ä¸ªæç®€ç‰ˆçš„<code>Uniswap</code>ï¼š<code>Pair</code>å¸å¯¹åˆçº¦è´Ÿ<strong>è´£ç®¡ç†å¸å¯¹åœ°å€</strong>ï¼Œ<code>PairFactory</code>å·¥å‚åˆçº¦<strong>ç”¨äºåˆ›å»ºæ–°çš„å¸å¯¹</strong>ï¼Œå¹¶ç®¡ç†å¸å¯¹åœ°å€ã€‚</p>
<h4 id="pairåˆçº¦"><code>Pair</code>åˆçº¦</h4>
<pre><code class="language-solidity">contract Pair{
    address public factory; // å·¥å‚åˆçº¦åœ°å€
    address public token0; // ä»£å¸1
    address public token1; // ä»£å¸2

    constructor() payable {
        factory = msg.sender;
    }

    // called once by the factory at time of deployment
    function initialize(address _token0, address _token1) external {
        require(msg.sender == factory, 'UniswapV2: FORBIDDEN'); // sufficient check
        token0 = _token0;
        token1 = _token1;
    }
}
</code></pre>
<p><code>Pair</code>åˆçº¦å¾ˆç®€å•ï¼ŒåŒ…å«3ä¸ªçŠ¶æ€å˜é‡ï¼š<code>factory</code>ï¼Œ<code>token0</code>å’Œ<code>token1</code>ã€‚</p>
<p>æ„é€ å‡½æ•°<code>constructor</code>åœ¨éƒ¨ç½²æ—¶å°†<code>factory</code>èµ‹å€¼<strong>ä¸ºå·¥å‚åˆçº¦åœ°å€</strong>ã€‚<code>initialize</code>å‡½æ•°ä¼šåœ¨<code>Pair</code>åˆçº¦åˆ›å»ºçš„æ—¶å€™è¢«å·¥å‚åˆçº¦è°ƒç”¨ä¸€æ¬¡ï¼Œå°†<code>token0</code>å’Œ<code>token1</code>æ›´æ–°ä¸ºå¸å¯¹ä¸­ä¸¤ç§ä»£å¸çš„åœ°å€ã€‚</p>
<blockquote>
<p><strong>æé—®</strong>ï¼šä¸ºä»€ä¹ˆ<code>uniswap</code>ä¸åœ¨<code>constructor</code>ä¸­å°†<code>token0</code>å’Œ<code>token1</code>åœ°å€æ›´æ–°å¥½ï¼Ÿ</p>
<p><strong>ç­”</strong>ï¼šå› ä¸º<code>uniswap</code>ä½¿ç”¨çš„æ˜¯<code>create2</code>åˆ›å»ºåˆçº¦ï¼Œé™åˆ¶æ„é€ å‡½æ•°ä¸èƒ½æœ‰å‚æ•°ã€‚å½“ä½¿ç”¨<code>create</code>æ—¶ï¼Œ<code>Pair</code>åˆçº¦å…è®¸æ„é€ å‡½æ•°æœ‰å‚æ•°ï¼Œå¯ä»¥åœ¨<code>constructor</code>ä¸­å°†<code>token0</code>å’Œ<code>token1</code>åœ°å€æ›´æ–°å¥½ã€‚</p>
</blockquote>
<h4 id="pairfactory"><code>PairFactory</code></h4>
<p>1ä¸ªå·¥å‚åˆçº¦PairFactoryåˆ›å»ºPairåˆçº¦çš„æœ€å¤§æ•°é‡ä¸€èˆ¬ç”±ä»€ä¹ˆå†³å®šï¼Ÿ<strong>PairFactoryåˆçº¦é€»è¾‘</strong></p>
<pre><code class="language-solidity">contract PairFactory{
    mapping(address =&gt; mapping(address =&gt; address)) public getPair; // é€šè¿‡ä¸¤ä¸ªä»£å¸åœ°å€æŸ¥Pairåœ°å€
    address[] public allPairs; // ä¿å­˜æ‰€æœ‰Pairåœ°å€

    function createPair(address tokenA, address tokenB) external returns (address pairAddr) {
        // åˆ›å»ºæ–°åˆçº¦
        Pair pair = new Pair(); 
        // è°ƒç”¨æ–°åˆçº¦çš„initializeæ–¹æ³•
        pair.initialize(tokenA, tokenB);
        // æ›´æ–°åœ°å€map
        pairAddr = address(pair);
        allPairs.push(pairAddr);
        getPair[tokenA][tokenB] = pairAddr;
        getPair[tokenB][tokenA] = pairAddr;
    }
}
</code></pre>
<p>å·¥å‚åˆçº¦ï¼ˆ<code>PairFactory</code>ï¼‰æœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡<code>getPair</code>æ˜¯ä¸¤ä¸ªä»£å¸åœ°å€åˆ°å¸å¯¹åœ°å€çš„<code>map</code>ï¼Œæ–¹ä¾¿æ ¹æ®ä»£å¸æ‰¾åˆ°å¸å¯¹åœ°å€ï¼›<code>allPairs</code>æ˜¯å¸å¯¹åœ°å€çš„æ•°ç»„ï¼Œå­˜å‚¨äº†æ‰€æœ‰ä»£å¸åœ°å€ã€‚</p>
<p><code>PairFactory</code>åˆçº¦åªæœ‰ä¸€ä¸ª<code>createPair</code>å‡½æ•°ï¼Œæ ¹æ®è¾“å…¥çš„ä¸¤ä¸ªä»£å¸åœ°å€<code>tokenA</code>å’Œ<code>tokenB</code>æ¥åˆ›å»ºæ–°çš„<code>Pair</code>åˆçº¦ã€‚å…¶ä¸­</p>
<pre><code class="language-solidity">Pair pair = new Pair(); 
</code></pre>
<p>å°±æ˜¯åˆ›å»ºåˆçº¦çš„ä»£ç ï¼Œéå¸¸ç®€å•ã€‚å¤§å®¶å¯ä»¥éƒ¨ç½²å¥½<code>PairFactory</code>åˆçº¦ï¼Œç„¶åç”¨ä¸‹é¢ä¸¤ä¸ªåœ°å€ä½œä¸ºå‚æ•°è°ƒç”¨<code>createPair</code>ï¼Œçœ‹çœ‹åˆ›å»ºçš„å¸å¯¹åœ°å€æ˜¯ä»€ä¹ˆï¼š</p>
<pre><code class="language-text">WBNBåœ°å€: 0x2c44b726ADF1963cA47Af88B284C06f30380fC78
BSCé“¾ä¸Šçš„PEOPLEåœ°å€:
0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c
</code></pre>
<h4 id="åœ¨remixä¸ŠéªŒè¯-2">åœ¨remixä¸ŠéªŒè¯</h4>
<ol>
<li>ä½¿ç”¨<code>WBNB</code>å’Œ<code>PEOPLE</code>çš„åœ°å€ä½œä¸ºå‚æ•°è°ƒç”¨<code>createPair</code>,å¾—åˆ°<code>Pair</code>åˆçº¦åœ°å€ï¼š{ &quot;0&quot;: &quot;address: pairAddr 0x72986C3fE625a2a6908327F96b681422C528E754&quot; }</li>
</ol>
<figure data-type="image" tabindex="84"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115163115424.png" alt="pairåœ°å€" loading="lazy"></figure>
<ol start="2">
<li>æŸ¥çœ‹<code>Pair</code>åˆçº¦å˜é‡</li>
</ol>
<figure data-type="image" tabindex="85"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115163149873.png" alt="éƒ¨ç½²pairåˆçº¦" loading="lazy"></figure>
<ol start="3">
<li>æŸ¥çœ‹pairåˆçº¦å˜é‡</li>
</ol>
<figure data-type="image" tabindex="86"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115163259762.png" alt="æŸ¥çœ‹pariåˆçº¦å˜é‡" loading="lazy"></figure>
<ol start="5">
<li>debug æŸ¥çœ‹æ“ä½œç </li>
</ol>
<figure data-type="image" tabindex="87"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115163653380.png" alt="æ“ä½œç " loading="lazy"></figure>
<h3 id="25-create2">25. Create2</h3>
<p><code>CREATE2</code> æ“ä½œç ä½¿æˆ‘ä»¬åœ¨æ™ºèƒ½åˆçº¦éƒ¨ç½²åœ¨ä»¥å¤ªåŠç½‘ç»œä¹‹å‰å°±èƒ½é¢„æµ‹åˆçº¦çš„åœ°å€ã€‚<code>Uniswap</code>åˆ›å»º<code>Pair</code>åˆçº¦ç”¨çš„å°±æ˜¯<code>CREATE2</code>è€Œä¸æ˜¯<code>CREATE</code>ã€‚</p>
<h4 id="createå¦‚ä½•è®¡ç®—åœ°å€">CREATEå¦‚ä½•è®¡ç®—åœ°å€</h4>
<p>æ™ºèƒ½åˆçº¦å¯ä»¥ç”±å…¶ä»–åˆçº¦å’Œæ™®é€šè´¦æˆ·åˆ©ç”¨<code>CREATE</code>æ“ä½œç åˆ›å»ºã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ–°åˆçº¦çš„åœ°å€éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è®¡ç®—ï¼šåˆ›å»ºè€…çš„åœ°å€(é€šå¸¸ä¸ºéƒ¨ç½²çš„é’±åŒ…åœ°å€æˆ–è€…åˆçº¦åœ°å€)å’Œ<code>nonce</code>(è¯¥åœ°å€å‘é€äº¤æ˜“çš„æ€»æ•°,å¯¹äºåˆçº¦è´¦æˆ·æ˜¯åˆ›å»ºçš„åˆçº¦æ€»æ•°,æ¯åˆ›å»ºä¸€ä¸ªåˆçº¦nonce+1))çš„å“ˆå¸Œã€‚</p>
<pre><code class="language-text">æ–°åœ°å€ = hash(åˆ›å»ºè€…åœ°å€, nonce)
</code></pre>
<p>åˆ›å»ºè€…åœ°å€ä¸ä¼šå˜ï¼Œä½†<code>nonce</code>å¯èƒ½ä¼šéšæ—¶é—´è€Œæ”¹å˜ï¼Œå› æ­¤ç”¨<code>CREATE</code>åˆ›å»ºçš„åˆçº¦åœ°å€ä¸å¥½é¢„æµ‹ã€‚</p>
<h4 id="create2å¦‚ä½•è®¡ç®—åœ°å€">CREATE2å¦‚ä½•è®¡ç®—åœ°å€</h4>
<p><code>CREATE2</code>çš„ç›®çš„æ˜¯ä¸ºäº†è®©åˆçº¦åœ°å€ç‹¬ç«‹äºæœªæ¥çš„äº‹ä»¶ã€‚ä¸ç®¡æœªæ¥åŒºå—é“¾ä¸Šå‘ç”Ÿäº†ä»€ä¹ˆï¼Œä½ éƒ½å¯ä»¥æŠŠåˆçº¦éƒ¨ç½²åœ¨äº‹å…ˆè®¡ç®—å¥½çš„åœ°å€ä¸Šã€‚ç”¨<code>CREATE2</code>åˆ›å»ºçš„åˆçº¦åœ°å€ç”±4ä¸ªéƒ¨åˆ†å†³å®šï¼š</p>
<ul>
<li><code>0xFF</code>ï¼šä¸€ä¸ªå¸¸æ•°ï¼Œé¿å…å’Œ<code>CREATE</code>å†²çª</li>
<li>åˆ›å»ºè€…åœ°å€</li>
<li><code>salt</code>ï¼ˆç›ï¼‰ï¼š<strong>ä¸€ä¸ªåˆ›å»ºè€…ç»™å®šçš„æ•°å€¼</strong></li>
<li><strong>å¾…éƒ¨ç½²åˆçº¦çš„å­—èŠ‚ç </strong>ï¼ˆ<code>bytecode</code>ï¼‰</li>
</ul>
<pre><code class="language-text">æ–°åœ°å€ = hash(&quot;0xFF&quot;,åˆ›å»ºè€…åœ°å€, salt, bytecode)
</code></pre>
<p><code>CREATE2</code> ç¡®ä¿ï¼Œå¦‚æœåˆ›å»ºè€…ä½¿ç”¨ <code>CREATE2</code> å’Œæä¾›çš„ <code>salt</code> éƒ¨ç½²ç»™å®šçš„åˆçº¦<code>bytecode</code>ï¼Œå®ƒå°†å­˜å‚¨åœ¨ <code>æ–°åœ°å€</code> ä¸­ã€‚</p>
<h4 id="å¦‚ä½•ä½¿ç”¨create2">å¦‚ä½•ä½¿ç”¨<code>CREATE2</code></h4>
<p><code>CREATE2</code>çš„ç”¨æ³•å’Œä¹‹å‰è®²çš„<code>Create</code>ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯<code>new</code>ä¸€ä¸ªåˆçº¦ï¼Œå¹¶ä¼ å…¥æ–°åˆçº¦æ„é€ å‡½æ•°æ‰€éœ€çš„å‚æ•°ï¼Œåªä¸è¿‡è¦å¤šä¼ ä¸€ä¸ª<code>salt</code>å‚æ•°ï¼š</p>
<pre><code class="language-text">Contract x = new Contract{salt: _salt, value: _value}(params)
</code></pre>
<p>å…¶ä¸­<code>Contract</code>æ˜¯è¦åˆ›å»ºçš„åˆçº¦åï¼Œ<code>x</code>æ˜¯åˆçº¦å¯¹è±¡ï¼ˆåœ°å€ï¼‰ï¼Œ<code>_salt</code>æ˜¯æŒ‡å®šçš„ç›ï¼›å¦‚æœæ„é€ å‡½æ•°æ˜¯<code>payable</code>ï¼Œå¯ä»¥åˆ›å»ºæ—¶è½¬å…¥<code>_value</code>æ•°é‡çš„<code>ETH</code>ï¼Œ<code>params</code>æ˜¯æ–°åˆçº¦æ„é€ å‡½æ•°çš„å‚æ•°ã€‚</p>
<h5 id="æç®€uniswap2">æç®€Uniswap2</h5>
<p>è·Ÿ<a href="https://mirror.xyz/dashboard/edit/kojopp2CgDK3ehHxXc_2fkZe87uM0O5OmsEU6y83eJs">ä¸Šä¸€è®²</a>ç±»ä¼¼ï¼Œæˆ‘ä»¬ç”¨<code>Create2</code>æ¥å®ç°æç®€<code>Uniswap</code>ã€‚</p>
<h5 id="pair"><code>Pair</code></h5>
<pre><code class="language-solidity">contract Pair{
    address public factory; // å·¥å‚åˆçº¦åœ°å€
    address public token0; // ä»£å¸1
    address public token1; // ä»£å¸2

    constructor() payable {
        factory = msg.sender;
    }

    // called once by the factory at time of deployment
    function initialize(address _token0, address _token1) external {
        require(msg.sender == factory, 'UniswapV2: FORBIDDEN'); // sufficient check
        token0 = _token0;
        token1 = _token1;
    }
}
</code></pre>
<p><code>Pair</code>åˆçº¦å¾ˆç®€å•ï¼ŒåŒ…å«3ä¸ªçŠ¶æ€å˜é‡ï¼š<code>factory</code>ï¼Œ<code>token0</code>å’Œ<code>token1</code>ã€‚</p>
<p>æ„é€ å‡½æ•°<code>constructor</code>åœ¨éƒ¨ç½²æ—¶å°†<code>factory</code>èµ‹å€¼ä¸ºå·¥å‚åˆçº¦åœ°å€ã€‚<code>initialize</code>å‡½æ•°ä¼šåœ¨<code>Pair</code>åˆçº¦åˆ›å»ºçš„æ—¶å€™è¢«å·¥å‚åˆçº¦è°ƒç”¨ä¸€æ¬¡ï¼Œå°†<code>token0</code>å’Œ<code>token1</code>æ›´æ–°ä¸ºå¸å¯¹ä¸­ä¸¤ç§ä»£å¸çš„åœ°å€ã€‚</p>
<h5 id="pairfactory2"><code>PairFactory2</code></h5>
<pre><code class="language-solidity">contract PairFactory2{
    mapping(address =&gt; mapping(address =&gt; address)) public getPair; // é€šè¿‡ä¸¤ä¸ªä»£å¸åœ°å€æŸ¥Pairåœ°å€
    address[] public allPairs; // ä¿å­˜æ‰€æœ‰Pairåœ°å€

    function createPair2(address tokenA, address tokenB) external returns (address pairAddr) {
        require(tokenA != tokenB, 'IDENTICAL_ADDRESSES'); //é¿å…tokenAå’ŒtokenBç›¸åŒäº§ç”Ÿçš„å†²çª
        // è®¡ç®—ç”¨tokenAå’ŒtokenBåœ°å€è®¡ç®—salt
        (address token0, address token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : (tokenB, tokenA); 
        //å°†tokenAå’ŒtokenBæŒ‰å¤§å°æ’åº
        bytes32 salt = keccak256(abi.encodePacked(token0, token1));
        // ç”¨create2éƒ¨ç½²æ–°åˆçº¦
        Pair pair = new Pair{salt: salt}(); 
        // è°ƒç”¨æ–°åˆçº¦çš„initializeæ–¹æ³•
        pair.initialize(tokenA, tokenB);
        // æ›´æ–°åœ°å€map
        pairAddr = address(pair);
        allPairs.push(pairAddr);
        getPair[tokenA][tokenB] = pairAddr;
        getPair[tokenB][tokenA] = pairAddr;
	}
</code></pre>
<p>å·¥å‚åˆçº¦ï¼ˆ<code>PairFactory2</code>ï¼‰æœ‰ä¸¤ä¸ªçŠ¶æ€å˜é‡<code>getPair</code>æ˜¯ä¸¤ä¸ªä»£å¸åœ°å€åˆ°å¸å¯¹åœ°å€çš„<code>map</code>ï¼Œæ–¹ä¾¿æ ¹æ®ä»£å¸æ‰¾åˆ°å¸å¯¹åœ°å€ï¼›<code>allPairs</code>æ˜¯å¸å¯¹åœ°å€çš„æ•°ç»„ï¼Œå­˜å‚¨äº†æ‰€æœ‰å¸å¯¹åœ°å€ã€‚</p>
<p><code>PairFactory2</code>åˆçº¦åªæœ‰ä¸€ä¸ª<code>createPair2</code>å‡½æ•°ï¼Œä½¿ç”¨<code>CREATE2</code>æ ¹æ®è¾“å…¥çš„ä¸¤ä¸ªä»£å¸åœ°å€<code>tokenA</code>å’Œ<code>tokenB</code>æ¥åˆ›å»ºæ–°çš„<code>Pair</code>åˆçº¦ã€‚å…¶ä¸­</p>
<pre><code class="language-solidity">    Pair pair = new Pair{salt: salt}(); 
</code></pre>
<p>å°±æ˜¯åˆ©ç”¨<code>CREATE2</code>åˆ›å»ºåˆçº¦çš„ä»£ç ï¼Œéå¸¸ç®€å•ï¼Œè€Œ<code>salt</code>ä¸º<code>token1</code>å’Œ<code>token2</code>çš„<code>hash</code>ï¼š</p>
<pre><code class="language-solidity">	bytes32 salt = keccak256(abi.encodePacked(token0, token1));
</code></pre>
<h5 id="äº‹å…ˆè®¡ç®—pairåœ°å€">äº‹å…ˆè®¡ç®—<code>Pair</code>åœ°å€</h5>
<pre><code class="language-solidity">// æå‰è®¡ç®—pairåˆçº¦åœ°å€
function calculateAddr(address tokenA, address tokenB) public view returns(address predictedAddress){
    require(tokenA != tokenB, 'IDENTICAL_ADDRESSES'); //é¿å…tokenAå’ŒtokenBç›¸åŒäº§ç”Ÿçš„å†²çª
    // è®¡ç®—ç”¨tokenAå’ŒtokenBåœ°å€è®¡ç®—salt
    (address token0, address token1) = tokenA &lt; tokenB ? (tokenA, tokenB) : (tokenB, tokenA); 
    //å°†tokenAå’ŒtokenBæŒ‰å¤§å°æ’åº
    bytes32 salt = keccak256(abi.encodePacked(token0, token1));
    // è®¡ç®—åˆçº¦åœ°å€æ–¹æ³• hash()
    predictedAddress = address(uint160(uint(keccak256(abi.encodePacked(
        bytes1(0xff),
        address(this),
        salt,
        keccak256(type(Pair).creationCode)
    )))));
}
</code></pre>
<p>æˆ‘ä»¬å†™äº†ä¸€ä¸ª<code>calculateAddr</code>å‡½æ•°æ¥äº‹å…ˆè®¡ç®—<code>tokenA</code>å’Œ<code>tokenB</code>å°†ä¼šç”Ÿæˆçš„<code>Pair</code>åœ°å€ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥éªŒè¯æˆ‘ä»¬äº‹å…ˆè®¡ç®—çš„åœ°å€å’Œå®é™…åœ°å€æ˜¯å¦ç›¸åŒã€‚</p>
<p>å¤§å®¶å¯ä»¥éƒ¨ç½²å¥½<code>PairFactory2</code>åˆçº¦ï¼Œç„¶åç”¨ä¸‹é¢ä¸¤ä¸ªåœ°å€ä½œä¸ºå‚æ•°è°ƒç”¨<code>createPair2</code>ï¼Œçœ‹çœ‹åˆ›å»ºçš„å¸å¯¹åœ°å€æ˜¯ä»€ä¹ˆï¼Œæ˜¯å¦ä¸äº‹å…ˆè®¡ç®—çš„åœ°å€ä¸€æ ·ï¼š</p>
<pre><code class="language-text">WBNBåœ°å€: 0x2c44b726ADF1963cA47Af88B284C06f30380fC78
BSCé“¾ä¸Šçš„PEOPLEåœ°å€:
0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c
</code></pre>
<h4 id="åœ¨remixä¸ŠéªŒè¯-3">åœ¨remixä¸ŠéªŒè¯</h4>
<ol>
<li>é¦–å…ˆç”¨<code>WBNB</code>å’Œ<code>PEOPLE</code>çš„åœ°å€å“ˆå¸Œä½œä¸º<code>salt</code>æ¥è®¡ç®—å‡º<code>Pair</code>åˆçº¦çš„åœ°å€ï¼ˆï¼‰</li>
<li>è°ƒç”¨<code>PairFactory2.createPair2</code>ä¼ å…¥å‚æ•°ä¸º<code>WBNB</code>å’Œ<code>PEOPLE</code>çš„åœ°å€ï¼Œè·å–å‡ºåˆ›å»ºçš„<code>pair</code>åˆçº¦åœ°å€</li>
<li>å¯¹æ¯”åˆçº¦åœ°å€</li>
</ol>
<figure data-type="image" tabindex="88"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115171028495.png" alt="create2äº¤æ˜“å¯¹åœ°å€" loading="lazy"></figure>
<h4 id="create2çš„å®é™…åº”ç”¨åœºæ™¯">create2çš„å®é™…åº”ç”¨åœºæ™¯</h4>
<ol>
<li>äº¤æ˜“æ‰€ä¸ºæ–°ç”¨æˆ·é¢„ç•™åˆ›å»ºé’±åŒ…åˆçº¦åœ°å€ã€‚</li>
<li>ç”± <code>CREATE2</code> é©±åŠ¨çš„ <code>factory</code> åˆçº¦ï¼Œåœ¨<code>uniswapV2</code>ä¸­äº¤æ˜“å¯¹çš„åˆ›å»ºæ˜¯åœ¨ <code>Factory</code>ä¸­è°ƒç”¨<code>create2</code>å®Œæˆã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯: å®ƒå¯ä»¥å¾—åˆ°ä¸€ä¸ªç¡®å®šçš„<code>pair</code>åœ°å€, ä½¿å¾— <code>Router</code>ä¸­å°±å¯ä»¥é€šè¿‡ <code>(tokenA, tokenB)</code> è®¡ç®—å‡º<code>pair</code>åœ°å€, ä¸å†éœ€è¦æ‰§è¡Œä¸€æ¬¡ <code>Factory.getPair(tokenA, tokenB)</code> çš„è·¨åˆçº¦è°ƒç”¨ã€‚</li>
</ol>
<h3 id="26-åˆ é™¤åˆçº¦">26. åˆ é™¤åˆçº¦</h3>
<p><code>selfdestruct</code>å‘½ä»¤å¯ä»¥ç”¨æ¥åˆ é™¤æ™ºèƒ½åˆçº¦ï¼Œå¹¶å°†è¯¥åˆçº¦å‰©ä½™<code>ETH</code>è½¬åˆ°æŒ‡å®šåœ°å€ã€‚<code>selfdestruct</code>æ˜¯ä¸ºäº†åº”å¯¹åˆçº¦å‡ºé”™çš„æç«¯æƒ…å†µè€Œè®¾è®¡çš„ã€‚å®ƒæœ€æ—©è¢«å‘½åä¸º<code>suicide</code>ï¼ˆè‡ªæ€ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ªè¯å¤ªæ•æ„Ÿã€‚ä¸ºäº†ä¿æŠ¤æŠ‘éƒçš„ç¨‹åºå‘˜ï¼Œæ”¹åä¸º<code>selfdestruct</code>ã€‚</p>
<h4 id="å¦‚ä½•ä½¿ç”¨selfdestruct">å¦‚ä½•ä½¿ç”¨<code>selfdestruct</code></h4>
<p><code>selfdestruct</code>ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼š</p>
<pre><code class="language-solidity">selfdestruct(_addr)ï¼›
</code></pre>
<p>å…¶ä¸­<code>_addr</code>æ˜¯<strong>æ¥æ”¶åˆçº¦</strong>ä¸­å‰©ä½™<code>ETH</code>çš„åœ°å€ã€‚</p>
<h4 id="ä¾‹å­">ä¾‹å­</h4>
<pre><code class="language-solidity">contract DeleteContract {

    uint public value = 10;

    constructor() payable {}

    receive() external payable {}

    function deleteContract() external {
        // è°ƒç”¨selfdestructé”€æ¯åˆçº¦ï¼Œå¹¶æŠŠå‰©ä½™çš„ETHè½¬ç»™msg.sender
        selfdestruct(payable(msg.sender));
    }

    function getBalance() external view returns(uint balance){
        balance = address(this).balance;
    }
}
</code></pre>
<p>åœ¨<code>DeleteContract</code>åˆçº¦ä¸­ï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ª<code>public</code>çŠ¶æ€å˜é‡<code>value</code>ï¼Œä¸¤ä¸ªå‡½æ•°ï¼š<code>getBalance()</code>ç”¨äºè·å–åˆçº¦<code>ETH</code>ä½™é¢ï¼Œ<code>deleteContract()</code>ç”¨äºè‡ªæ¯åˆçº¦ï¼Œå¹¶æŠŠ<code>ETH</code>è½¬å…¥ç»™å‘èµ·äººã€‚</p>
<p>éƒ¨ç½²å¥½åˆçº¦åï¼Œæˆ‘ä»¬å‘<code>DeleteContract</code>åˆçº¦è½¬å…¥1 <code>ETH</code>ã€‚è¿™æ—¶ï¼Œ<code>getBalance()</code>ä¼šè¿”å›1 <code>ETH</code>ï¼Œ<code>value</code>å˜é‡æ˜¯10ã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>deleteContract()</code>å‡½æ•°ï¼Œåˆçº¦å°†è‡ªæ¯ï¼Œæ‰€æœ‰å˜é‡éƒ½æ¸…ç©ºï¼Œæ­¤æ—¶<code>value</code>å˜ä¸ºé»˜è®¤å€¼<code>0</code>ï¼Œ<code>getBalance()</code>ä¹Ÿè¿”å›ç©ºå€¼ã€‚</p>
<h4 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h4>
<ol>
<li>å¯¹å¤–æä¾›åˆçº¦é”€æ¯æ¥å£æ—¶ï¼Œæœ€å¥½è®¾ç½®ä¸ºåªæœ‰åˆçº¦æ‰€æœ‰è€…å¯ä»¥è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°ä¿®é¥°ç¬¦<code>onlyOwner</code>è¿›è¡Œå‡½æ•°å£°æ˜ã€‚</li>
<li>å½“åˆçº¦è¢«é”€æ¯åä¸æ™ºèƒ½åˆçº¦çš„äº¤äº’ä¹Ÿèƒ½æˆåŠŸï¼Œå¹¶ä¸”è¿”å›0ã€‚</li>
<li>å½“åˆçº¦ä¸­æœ‰<code>selfdestruct</code>åŠŸèƒ½æ—¶å¸¸å¸¸ä¼šå¸¦æ¥å®‰å…¨é—®é¢˜å’Œä¿¡ä»»é—®é¢˜ï¼Œåˆçº¦ä¸­çš„SelfdestructåŠŸèƒ½ä¼šä¸ºæ”»å‡»è€…æ‰“å¼€æ”»å‡»å‘é‡(ä¾‹å¦‚ä½¿ç”¨<code>selfdestruct</code>å‘ä¸€ä¸ªåˆçº¦é¢‘ç¹è½¬å…¥tokenè¿›è¡Œæ”»å‡»ï¼Œè¿™å°†å¤§å¤§èŠ‚çœäº†GASçš„è´¹ç”¨ï¼Œè™½ç„¶å¾ˆå°‘äººè¿™ä¹ˆåš)ï¼Œæ­¤å¤–ï¼Œæ­¤åŠŸèƒ½è¿˜ä¼šé™ä½ç”¨æˆ·å¯¹åˆçº¦çš„ä¿¡å¿ƒã€‚</li>
</ol>
<h4 id="åœ¨remixä¸ŠéªŒè¯-4">åœ¨remixä¸ŠéªŒè¯</h4>
<ol>
<li>éƒ¨ç½²åˆçº¦å¹¶ä¸”è½¬å…¥1ETHï¼ŒæŸ¥çœ‹åˆçº¦çŠ¶æ€</li>
</ol>
<figure data-type="image" tabindex="89"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115182843256.png" alt="è½¬1ETH" loading="lazy"></figure>
<ol start="2">
<li>é”€æ¯åˆçº¦ï¼ŒæŸ¥çœ‹åˆçº¦çŠ¶æ€</li>
</ol>
<figure data-type="image" tabindex="90"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115183016707.png" alt="è°ƒç”¨åˆçº¦" loading="lazy"></figure>
<h3 id="27-abi-ç¼–ç è§£ç ">27. ABI ç¼–ç è§£ç </h3>
<p><code>ABI</code> (Application Binary Interfaceï¼Œåº”ç”¨äºŒè¿›åˆ¶æ¥å£)æ˜¯ä¸ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦äº¤äº’çš„æ ‡å‡†ã€‚æ•°æ®åŸºäºä»–ä»¬çš„ç±»å‹ç¼–ç ï¼›å¹¶ä¸”ç”±äºç¼–ç åä¸åŒ…å«ç±»å‹ä¿¡æ¯ï¼Œè§£ç æ—¶éœ€è¦æ³¨æ˜å®ƒä»¬çš„ç±»å‹ã€‚</p>
<p><code>Solidity</code>ä¸­ï¼Œ<code>ABIç¼–ç </code>æœ‰4ä¸ªå‡½æ•°ï¼š<code>abi.encode</code>, <code>abi.encodePacked</code>, <code>abi.encodeWithSignature</code>, <code>abi.encodeWithSelector</code>ã€‚è€Œ<code>ABIè§£ç </code>æœ‰1ä¸ªå‡½æ•°ï¼š<code>abi.decode</code>ï¼Œç”¨äºè§£ç <code>abi.encode</code>çš„æ•°æ®ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚</p>
<h4 id="abiç¼–ç ">ABIç¼–ç </h4>
<p>æˆ‘ä»¬å°†ç”¨ç¼–ç 4ä¸ªå˜é‡ï¼Œä»–ä»¬çš„ç±»å‹åˆ†åˆ«æ˜¯<code>uint256</code>, <code>address</code>, <code>string</code>, <code>uint256[2]</code>ï¼š</p>
<pre><code class="language-solidity">uint x = 10;
address addr = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;
string name = &quot;0xAA&quot;;
uint[2] array = [5, 6]; 
</code></pre>
<h5 id="abiencode"><code>abi.encode</code></h5>
<p>å°†ç»™å®šå‚æ•°åˆ©ç”¨<a href="https://learnblockchain.cn/docs/solidity/abi-spec.html">ABIè§„åˆ™</a>ç¼–ç ã€‚<code>ABI</code>è¢«è®¾è®¡å‡ºæ¥è·Ÿæ™ºèƒ½åˆçº¦äº¤äº’ï¼Œä»–å°†æ¯ä¸ªå‚æ•°å¡«å……ä¸º32å­—èŠ‚çš„æ•°æ®ï¼Œå¹¶æ‹¼æ¥åœ¨ä¸€èµ·ã€‚å¦‚æœä½ è¦å’Œåˆçº¦äº¤äº’ï¼Œä½ è¦ç”¨çš„å°±æ˜¯<code>abi.encode</code>ã€‚</p>
<pre><code class="language-solidity">function encode() public view returns(bytes memory result) {
	result = abi.encode(x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0x000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œç”±äº<code>abi.encode</code>å°†æ¯ä¸ªæ•°æ®éƒ½å¡«å……ä¸º32å­—èŠ‚ï¼Œä¸­é—´æœ‰å¾ˆå¤š<code>0</code>ã€‚</p>
<h5 id="abiencodepacked"><code>abi.encodePacked</code></h5>
<p>å°†ç»™å®šå‚æ•°æ ¹æ®å…¶æ‰€éœ€æœ€ä½ç©ºé—´ç¼–ç ã€‚å®ƒç±»ä¼¼ <code>abi.encode</code>ï¼Œä½†æ˜¯ä¼šæŠŠå…¶ä¸­å¡«å……çš„å¾ˆå¤š<code>0</code>çœç•¥ã€‚æ¯”å¦‚ï¼Œåªç”¨1å­—èŠ‚æ¥ç¼–ç <code>uint</code>ç±»å‹ã€‚å½“ä½ æƒ³çœç©ºé—´ï¼Œå¹¶ä¸”<strong>ä¸ä¸åˆçº¦äº¤äº’çš„æ—¶å€™</strong>ï¼Œå¯ä»¥ä½¿ç”¨<code>abi.encodePacked</code>ï¼Œä¾‹å¦‚ç®—ä¸€äº›æ•°æ®çš„<code>hash</code>æ—¶ã€‚</p>
<pre><code class="language-solidity">function encodePacked() public view returns(bytes memory result) {
	result = abi.encodePacked(x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0x000000000000000000000000000000000000000000000000000000000000000a7a58c0be72be218b41c608b7fe7c5bb630736c713078414100000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000006</code>ï¼Œç”±äº<code>abi.encodePacked</code>å¯¹ç¼–ç è¿›è¡Œäº†å‹ç¼©ï¼Œé•¿åº¦æ¯”<code>abi.encode</code>çŸ­å¾ˆå¤šã€‚</p>
<h5 id="abiencodewithsignature"><code>abi.encodeWithSignature</code></h5>
<p>ä¸<code>abi.encode</code>åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>å‡½æ•°ç­¾å</code>ï¼Œæ¯”å¦‚<code>&quot;foo(uint256,address)&quot;</code>ã€‚å½“è°ƒç”¨å…¶ä»–åˆçº¦çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ã€‚</p>
<pre><code class="language-solidity">function encodeWithSignature() public view returns(bytes memory result) {
	result = abi.encodeWithSignature(&quot;foo(uint256,address,string,uint256[2])&quot;, x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œç­‰åŒäºåœ¨<code>abi.encode</code>ç¼–ç ç»“æœå‰åŠ ä¸Šäº†4å­—èŠ‚çš„<code>å‡½æ•°é€‰æ‹©å™¨</code><a href="https://wtf.academy/solidity-advanced/ABIEncode/#fn-%E8%AF%B4%E6%98%8E">è¯´æ˜</a>ã€‚ <a href="https://wtf.academy/solidity-advanced/ABIEncode/#fn-%E8%AF%B4%E6%98%8E">è¯´æ˜</a>: å‡½æ•°é€‰æ‹©å™¨å°±æ˜¯é€šè¿‡å‡½æ•°åå’Œå‚æ•°è¿›è¡Œç­¾åå¤„ç†(Keccakâ€“Sha3)æ¥æ ‡è¯†å‡½æ•°ï¼Œå¯ä»¥ç”¨äºä¸åŒåˆçº¦ä¹‹é—´çš„å‡½æ•°è°ƒç”¨</p>
<h5 id="abiencodewithselector"><code>abi.encodeWithSelector</code></h5>
<p>ä¸<code>abi.encodeWithSignature</code>åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡ç¬¬ä¸€ä¸ªå‚æ•°ä¸º<code>å‡½æ•°é€‰æ‹©å™¨</code>ï¼Œä¸º<code>å‡½æ•°ç­¾å</code>Keccakå“ˆå¸Œ<strong>çš„å‰4ä¸ªå­—èŠ‚ã€‚</strong></p>
<pre><code class="language-solidity">function encodeWithSelector() public view returns(bytes memory result) {
	result = abi.encodeWithSelector(bytes4(keccak256(&quot;foo(uint256,address,string,uint256[2])&quot;)), x, addr, name, array);
}
</code></pre>
<p>ç¼–ç çš„ç»“æœä¸º<code>0xe87082f1000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000007a58c0be72be218b41c608b7fe7c5bb630736c7100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000043078414100000000000000000000000000000000000000000000000000000000</code>ï¼Œä¸<code>abi.encodeWithSignature</code>ç»“æœä¸€æ ·ã€‚</p>
<h4 id="abiè§£ç ">ABIè§£ç </h4>
<h5 id="abidecode"><code>abi.decode</code></h5>
<p><code>abi.decode</code>ç”¨äºè§£ç <code>abi.encode</code>ç”Ÿæˆçš„äºŒè¿›åˆ¶ç¼–ç ï¼Œå°†å®ƒè¿˜åŸæˆåŸæœ¬çš„å‚æ•°ã€‚</p>
<pre><code class="language-solidity">function decode(bytes memory data) public pure returns(uint dx, address daddr, string memory dname, uint[2] memory darray) {
	(dx, daddr, dname, darray) = abi.decode(data, (uint, address, string, uint[2]));
}
</code></pre>
<p>æˆ‘ä»¬å°†<code>abi.encode</code>çš„äºŒè¿›åˆ¶ç¼–ç è¾“å…¥ç»™<code>decode</code>ï¼Œå°†è§£ç å‡ºåŸæ¥çš„å‚æ•°ï¼š</p>
<figure data-type="image" tabindex="91"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115184805769.png" alt="decode" loading="lazy"></figure>
<h4 id="abiçš„ä½¿ç”¨åœºæ™¯">ABIçš„ä½¿ç”¨åœºæ™¯</h4>
<ol>
<li>åœ¨åˆçº¦å¼€å‘ä¸­ï¼ŒABIå¸¸é…åˆcallæ¥å®ç°å¯¹åˆçº¦çš„åº•å±‚è°ƒç”¨ã€‚</li>
</ol>
<pre><code class="language-solidity">bytes4 selector = contract.getValue.selector;

bytes memory data = abi.encodeWithSelector(selector, _x);
(bool success, bytes memory returnedData) = address(contract).staticcall(data);
require(success);

return abi.decode(returnedData, (uint256));
</code></pre>
<ol start="2">
<li>ethers.jsä¸­å¸¸ç”¨ABIå®ç°åˆçº¦çš„å¯¼å…¥å’Œå‡½æ•°è°ƒç”¨ã€‚</li>
</ol>
<pre><code class="language-solidity">const wavePortalContract = new ethers.Contract(contractAddress, contractABI, signer);
/*
* Call the getAllWaves method from your Smart Contract
*/
const waves = await wavePortalContract.getAllWaves();
</code></pre>
<h3 id="28-hash">28. Hash</h3>
<p>å“ˆå¸Œå‡½æ•°ï¼ˆhash functionï¼‰æ˜¯ä¸€ä¸ªå¯†ç å­¦æ¦‚å¿µï¼Œå®ƒå¯ä»¥å°†ä»»æ„é•¿åº¦çš„æ¶ˆæ¯è½¬æ¢ä¸ºä¸€ä¸ªå›ºå®šé•¿åº¦çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¹Ÿç§°ä½œå“ˆå¸Œï¼ˆhashï¼‰ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸€ä¸‹å“ˆå¸Œå‡½æ•°åŠåœ¨<code>solidity</code>çš„åº”ç”¨</p>
<h4 id="hashçš„æ€§è´¨">Hashçš„æ€§è´¨</h4>
<p>ä¸€ä¸ªå¥½çš„å“ˆå¸Œå‡½æ•°åº”è¯¥å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š</p>
<ul>
<li>å•å‘æ€§ï¼šä»è¾“å…¥çš„æ¶ˆæ¯åˆ°å®ƒçš„å“ˆå¸Œçš„æ­£å‘è¿ç®—ç®€å•ä¸”å”¯ä¸€ç¡®å®šï¼Œè€Œåè¿‡æ¥éå¸¸éš¾ï¼Œåªèƒ½é æš´åŠ›æšä¸¾ã€‚</li>
<li>çµæ•æ€§ï¼šè¾“å…¥çš„æ¶ˆæ¯<strong>æ”¹å˜ä¸€ç‚¹å¯¹å®ƒçš„å“ˆå¸Œæ”¹å˜å¾ˆå¤§</strong>ã€‚</li>
<li>é«˜æ•ˆæ€§ï¼šä»è¾“å…¥çš„æ¶ˆæ¯åˆ°å“ˆå¸Œçš„<strong>è¿ç®—é«˜æ•ˆ</strong>ã€‚</li>
<li>å‡ä¸€æ€§ï¼š<strong>æ¯ä¸ªå“ˆå¸Œå€¼è¢«å–åˆ°çš„æ¦‚ç‡åº”è¯¥åŸºæœ¬ç›¸ç­‰</strong>ã€‚</li>
<li>æŠ—ç¢°æ’æ€§ï¼š
<ul>
<li>å¼±æŠ—ç¢°æ’æ€§ï¼šç»™å®šä¸€ä¸ªæ¶ˆæ¯<code>x</code>ï¼Œæ‰¾åˆ°å¦ä¸€ä¸ªæ¶ˆæ¯<code>x'</code>ä½¿å¾—<code>hash(x) = hash(x')</code>æ˜¯å›°éš¾çš„ã€‚</li>
<li>å¼ºæŠ—ç¢°æ’æ€§ï¼šæ‰¾åˆ°ä»»æ„<code>x</code>å’Œ<code>x'</code>ï¼Œä½¿å¾—<code>hash(x) = hash(x')</code>æ˜¯å›°éš¾çš„ã€‚</li>
</ul>
</li>
</ul>
<h4 id="hashçš„åº”ç”¨">Hashçš„åº”ç”¨</h4>
<ul>
<li>ç”Ÿæˆæ•°æ®å”¯ä¸€æ ‡è¯†</li>
<li>åŠ å¯†ç­¾å</li>
<li>å®‰å…¨åŠ å¯†</li>
</ul>
<h4 id="keccak256">Keccak256</h4>
<p><code>Keccak256</code>å‡½æ•°æ˜¯<code>solidity</code>ä¸­æœ€å¸¸ç”¨çš„å“ˆå¸Œå‡½æ•°ï¼Œç”¨æ³•éå¸¸ç®€å•ï¼š</p>
<pre><code class="language-solidity">å“ˆå¸Œ = keccak256(æ•°æ®);
</code></pre>
<h4 id="keccak256å’Œsha3">Keccak256å’Œsha3</h4>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼š</p>
<ol>
<li>sha3ç”±keccakæ ‡å‡†åŒ–è€Œæ¥ï¼Œåœ¨å¾ˆå¤šåœºåˆä¸‹Keccakå’ŒSHA3æ˜¯åŒä¹‰è¯ï¼Œä½†åœ¨2015å¹´8æœˆSHA3æœ€ç»ˆå®Œæˆæ ‡å‡†åŒ–æ—¶ï¼ŒNISTè°ƒæ•´äº†å¡«å……ç®—æ³•ã€‚<strong>æ‰€ä»¥SHA3å°±å’Œkeccakè®¡ç®—çš„ç»“æœä¸ä¸€æ ·</strong>ï¼Œè¿™ç‚¹åœ¨å®é™…å¼€å‘ä¸­è¦æ³¨æ„ã€‚</li>
<li>ä»¥å¤ªåŠåœ¨å¼€å‘çš„æ—¶å€™sha3è¿˜åœ¨æ ‡å‡†åŒ–ä¸­ï¼Œæ‰€ä»¥é‡‡ç”¨äº†keccakï¼Œæ‰€ä»¥Ethereumå’ŒSolidityæ™ºèƒ½åˆçº¦ä»£ç ä¸­çš„SHA3æ˜¯æŒ‡Keccak256ï¼Œè€Œä¸æ˜¯æ ‡å‡†çš„NIST-SHA3ï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œç›´æ¥åœ¨åˆçº¦ä»£ç ä¸­å†™æˆKeccak256æ˜¯æœ€æ¸…æ™°çš„ã€‚</li>
</ol>
<h4 id="ç”Ÿæˆæ•°æ®å”¯ä¸€æ ‡è¯†">ç”Ÿæˆæ•°æ®å”¯ä¸€æ ‡è¯†</h4>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>keccak256</code>æ¥ç”Ÿæˆä¸€äº›æ•°æ®çš„å”¯ä¸€æ ‡è¯†ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰å‡ ä¸ªä¸åŒç±»å‹çš„æ•°æ®ï¼š<code>uint</code>ï¼Œ<code>string</code>ï¼Œ<code>address</code>ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨<code>abi.encodePacked</code>æ–¹æ³•å°†ä»–ä»¬æ‰“åŒ…ç¼–ç ï¼Œç„¶åå†ç”¨<code>keccak256</code>æ¥ç”Ÿæˆå”¯ä¸€æ ‡è¯†ï¼š</p>
<pre><code class="language-solidity">function hash(
	uint _num,
	string memory _string,
	address _addr
) public pure returns (bytes32) {
	return keccak256(abi.encodePacked(_num, _string, _addr));
}
</code></pre>
<h4 id="å¼±æŠ—ç¢°æ’æ€§">å¼±æŠ—ç¢°æ’æ€§</h4>
<p>æˆ‘ä»¬ç”¨<code>keccak256</code>æ¼”ç¤ºä¸€ä¸‹ä¹‹å‰è®²åˆ°çš„å¼±æŠ—ç¢°æ’æ€§ï¼Œå³ç»™å®šä¸€ä¸ªæ¶ˆæ¯<code>x</code>ï¼Œæ‰¾åˆ°å¦ä¸€ä¸ªæ¶ˆæ¯<code>x'</code>ä½¿å¾—<code>hash(x) = hash(x')</code>æ˜¯å›°éš¾çš„ã€‚</p>
<p>æˆ‘ä»¬ç»™å®šä¸€ä¸ªæ¶ˆæ¯<code>0xAA</code>ï¼Œè¯•å›¾å»æ‰¾å¦ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½¿å¾—å®ƒä»¬çš„å“ˆå¸Œå€¼ç›¸ç­‰ï¼š</p>
<pre><code class="language-solidity">// å¼±æŠ—ç¢°æ’æ€§
function weak(
	string memory string1
)public view returns (bool){
	return keccak256(abi.encodePacked(string1)) == _msg;
}
</code></pre>
<p>å¤§å®¶å¯ä»¥è¯•ä¸ª10æ¬¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¹¸è¿çš„ç¢°æ’ä¸Šã€‚</p>
<h4 id="å¼ºæŠ—ç¢°æ’æ€§">å¼ºæŠ—ç¢°æ’æ€§</h4>
<p>æˆ‘ä»¬ç”¨<code>keccak256</code>æ¼”ç¤ºä¸€ä¸‹ä¹‹å‰è®²åˆ°çš„å¼ºæŠ—ç¢°æ’æ€§ï¼Œå³æ‰¾åˆ°ä»»æ„ä¸åŒçš„<code>x</code>å’Œ<code>x'</code>ï¼Œä½¿å¾—<code>hash(x) = hash(x')</code>æ˜¯å›°éš¾çš„ã€‚</p>
<p>æˆ‘ä»¬æ„é€ ä¸€ä¸ªå‡½æ•°<code>strong</code>ï¼Œæ¥æ”¶ä¸¤ä¸ªä¸åŒçš„<code>string</code>å‚æ•°<code>string1</code>å’Œ<code>string2</code>ï¼Œç„¶ååˆ¤æ–­å®ƒä»¬çš„å“ˆå¸Œæ˜¯å¦ç›¸åŒï¼š</p>
<pre><code class="language-solidity">// å¼ºæŠ—ç¢°æ’æ€§
function strong(
    string memory string1,
    string memory string2
)public pure returns (bool){
	return keccak256(abi.encodePacked(string1)) == keccak256(abi.encodePacked(string2));
}
</code></pre>
<p>å¤§å®¶å¯ä»¥è¯•ä¸ª10æ¬¡ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å¹¸è¿çš„ç¢°æ’ä¸Šã€‚</p>
<h4 id="åœ¨remixä¸ŠéªŒè¯-5">åœ¨remixä¸ŠéªŒè¯</h4>
<ol>
<li>éƒ¨ç½²åˆçº¦æŸ¥çœ‹å”¯ä¸€æ ‡è¯†ç”Ÿæˆç»“æœ</li>
</ol>
<figure data-type="image" tabindex="92"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115190728397.png" alt="æŸ¥çœ‹å”¯ä¸€æ ‡è¯†ç”Ÿæˆç»“æœ" loading="lazy"></figure>
<ol start="2">
<li>éªŒè¯å“ˆå¸Œå‡½æ•°çš„çµæ•æ€§ã€å¼ºå¼±ç¢°æ’æ€§</li>
</ol>
<figure data-type="image" tabindex="93"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115191131973.png" alt="å“ˆå¸Œå‡½æ•°æµ‹è¯•" loading="lazy"></figure>
<h3 id="29-é€‰æ‹©å™¨">29. é€‰æ‹©å™¨</h3>
<p>å½“æˆ‘ä»¬è°ƒç”¨æ™ºèƒ½åˆçº¦æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯å‘ç›®æ ‡åˆçº¦å‘é€äº†ä¸€æ®µ<code>calldata</code>ï¼Œåœ¨remixä¸­å‘é€ä¸€æ¬¡äº¤æ˜“åï¼Œå¯ä»¥åœ¨è¯¦ç»†ä¿¡æ¯ä¸­çœ‹è§<code>input</code>å³ä¸ºæ­¤æ¬¡äº¤æ˜“çš„<code>calldata</code></p>
<p>å‘é€çš„<code>calldata</code>ä¸­å‰4ä¸ªå­—èŠ‚æ˜¯<code>selector</code>ï¼ˆå‡½æ•°é€‰æ‹©å™¨ï¼‰ã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä»‹ç»<code>selector</code>æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 id="msgdata"><code>msg.data</code></h4>
<p><code>msg.data</code>æ˜¯<code>solidity</code>ä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå€¼ä¸ºå®Œæ•´çš„<code>calldata</code>ï¼ˆè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥çš„æ•°æ®ï¼‰ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>Log</code>äº‹ä»¶æ¥è¾“å‡ºè°ƒç”¨<code>mint</code>å‡½æ•°çš„<code>calldata</code>ï¼š</p>
<pre><code class="language-solidity">// event è¿”å›msg.data
event Log(bytes data);

function mint(address to) external{
	emit Log(msg.data);
}
</code></pre>
<p>å½“å‚æ•°ä¸º<code>0x2c44b726ADF1963cA47Af88B284C06f30380fC78</code>æ—¶ï¼Œè¾“å‡ºçš„<code>calldata</code>ä¸º</p>
<pre><code class="language-text">0x6a6278420000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>è¿™æ®µå¾ˆä¹±çš„å­—èŠ‚ç å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼š</p>
<pre><code class="language-text">å‰4ä¸ªå­—èŠ‚ä¸ºå‡½æ•°é€‰æ‹©å™¨selectorï¼š
0x6a627842

åé¢32ä¸ªå­—èŠ‚ä¸ºè¾“å…¥çš„å‚æ•°ï¼š
0x0000000000000000000000002c44b726adf1963ca47af88b284c06f30380fc78
</code></pre>
<p>å…¶å®<code>calldata</code>å°±æ˜¯å‘Šè¯‰æ™ºèƒ½åˆçº¦ï¼Œæˆ‘è¦è°ƒç”¨<strong>å“ªä¸ªå‡½æ•°ï¼Œä»¥åŠå‚æ•°æ˜¯ä»€ä¹ˆ</strong>ã€‚</p>
<figure data-type="image" tabindex="94"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115193859938.png" alt="calldata" loading="lazy"></figure>
<h4 id="method-id-selectorå’Œå‡½æ•°ç­¾å"><code>method id</code>ã€<code>selector</code>å’Œ<code>å‡½æ•°ç­¾å</code></h4>
<p><code>method id</code>å®šä¹‰ä¸º<code>å‡½æ•°ç­¾å</code>çš„<code>Keccak</code>å“ˆå¸Œåçš„å‰4ä¸ªå­—èŠ‚ï¼Œå½“<code>selector</code>ä¸<code>method id</code>ç›¸åŒ¹é…æ—¶ï¼Œå³è¡¨ç¤ºè°ƒç”¨è¯¥å‡½æ•°ï¼Œé‚£ä¹ˆ<code>å‡½æ•°ç­¾å</code>æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å…¶å®åœ¨ç¬¬21è®²ä¸­ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»äº†å‡½æ•°ç­¾åï¼Œä¸º<code>&quot;å‡½æ•°åï¼ˆé€—å·åˆ†éš”çš„å‚æ•°ç±»å‹)&quot;</code>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢ä»£ç ä¸­<code>mint</code>çš„å‡½æ•°ç­¾åä¸º<code>&quot;mint(address)&quot;</code>ã€‚åœ¨åŒä¸€ä¸ªæ™ºèƒ½åˆçº¦ä¸­ï¼Œä¸åŒçš„å‡½æ•°æœ‰ä¸åŒçš„å‡½æ•°ç­¾åï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡å‡½æ•°ç­¾åæ¥ç¡®å®šè¦è°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼Œåœ¨å‡½æ•°ç­¾åä¸­ï¼Œ<code>uint</code>å’Œ<code>int</code>è¦å†™ä¸º<code>uint256</code>å’Œ<code>int256</code>ã€‚</p>
<p>æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°ï¼Œæ¥éªŒè¯<code>mint</code>å‡½æ•°çš„<code>method id</code>æ˜¯å¦ä¸º<code>0x6a627842</code>ã€‚å¤§å®¶å¯ä»¥è¿è¡Œä¸‹é¢çš„å‡½æ•°ï¼Œçœ‹çœ‹ç»“æœã€‚</p>
<pre><code class="language-solidity">function mintSelector() external pure returns(bytes4 mSelector){
	return bytes4(keccak256(&quot;mint(address)&quot;));
}
</code></pre>
<p>ç»“æœæ­£æ˜¯<code>0x6a627842</code>ï¼š</p>
<figure data-type="image" tabindex="95"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115194447412.png" alt="method idéªŒè¯" loading="lazy"></figure>
<h4 id="ä½¿ç”¨selector">ä½¿ç”¨<code>selector</code></h4>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>selector</code>æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°ã€‚ä¾‹å¦‚æˆ‘æƒ³è°ƒç”¨<code>mint</code>å‡½æ•°ï¼Œæˆ‘åªéœ€è¦åˆ©ç”¨<code>abi.encodeWithSelector</code>å°†<code>mint</code>å‡½æ•°çš„<code>method id</code>ä½œä¸º<code>selector</code>å’Œå‚æ•°æ‰“åŒ…ç¼–ç ï¼Œä¼ ç»™<code>call</code>å‡½æ•°ï¼š</p>
<pre><code class="language-solidity">function callWithSignature() external returns(bool, bytes memory){
    (bool success, bytes memory data) = address(this).call(abi.encodeWithSelector(0x6a627842, &quot;0x2c44b726ADF1963cA47Af88B284C06f30380fC78&quot;));
    return(success, data);
}
</code></pre>
<p>åœ¨æ—¥å¿—ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>mint</code>å‡½æ•°è¢«æˆåŠŸè°ƒç”¨ï¼Œå¹¶è¾“å‡º<code>Log</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="96"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115194938520.png" alt="ä½¿ç”¨selector" loading="lazy"></figure>
<h3 id="30-try-catch">30. try-catch</h3>
<p><code>try-catch</code>æ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€å‡ ä¹éƒ½æœ‰çš„å¤„ç†å¼‚å¸¸çš„ä¸€ç§æ ‡å‡†æ–¹å¼ï¼Œ<code>solidity</code>0.6ç‰ˆæœ¬ä¹Ÿæ·»åŠ äº†å®ƒã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åˆ©ç”¨<code>try-catch</code>å¤„ç†æ™ºèƒ½åˆçº¦ä¸­çš„å¼‚å¸¸ã€‚</p>
<p>åœ¨<code>solidity</code>ä¸­ï¼Œ<code>try-catch</code>åªèƒ½è¢«ç”¨äº<code>external</code>å‡½æ•°æˆ–åˆ›å»ºåˆçº¦æ—¶<code>constructor</code>ï¼ˆè¢«è§†ä¸º<code>external</code>å‡½æ•°ï¼‰çš„è°ƒç”¨ã€‚åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-solidity">try externalContract.f() {
    // callæˆåŠŸçš„æƒ…å†µä¸‹ è¿è¡Œä¸€äº›ä»£ç 
} catch {
    // callå¤±è´¥çš„æƒ…å†µä¸‹ è¿è¡Œä¸€äº›ä»£ç 
}
</code></pre>
<p>å…¶ä¸­<code>externalContract.f()</code>æ˜¯æŸä¸ªå¤–éƒ¨åˆçº¦çš„å‡½æ•°è°ƒç”¨ï¼Œ<code>try</code>æ¨¡å—åœ¨è°ƒç”¨æˆåŠŸçš„æƒ…å†µä¸‹è¿è¡Œï¼Œè€Œ<code>catch</code>æ¨¡å—åˆ™åœ¨è°ƒç”¨å¤±è´¥æ—¶è¿è¡Œã€‚</p>
<p>åŒæ ·å¯ä»¥ä½¿ç”¨<code>this.f()</code>æ¥æ›¿ä»£<code>externalContract.f()</code>ï¼Œ<code>this.f()</code>ä¹Ÿè¢«è§†ä½œä¸ºå¤–éƒ¨è°ƒç”¨ï¼Œ<strong>ä½†ä¸å¯åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨</strong>ï¼Œå› ä¸ºæ­¤æ—¶åˆçº¦è¿˜æœªåˆ›å»ºã€‚</p>
<p>å¦‚æœè°ƒç”¨çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨<code>try</code>ä¹‹åå£°æ˜<code>returns(returnType val)</code>ï¼Œå¹¶ä¸”åœ¨<code>try</code>æ¨¡å—ä¸­å¯ä»¥ä½¿ç”¨è¿”å›çš„å˜é‡ï¼›å¦‚æœæ˜¯åˆ›å»ºåˆçº¦ï¼Œé‚£ä¹ˆè¿”å›å€¼æ˜¯æ–°åˆ›å»ºçš„åˆçº¦å˜é‡ã€‚</p>
<pre><code class="language-solidity">try externalContract.f() returns(returnType val){
    // callæˆåŠŸçš„æƒ…å†µä¸‹ è¿è¡Œä¸€äº›ä»£ç 
} catch {
    // callå¤±è´¥çš„æƒ…å†µä¸‹ è¿è¡Œä¸€äº›ä»£ç 
}
</code></pre>
<p>å¦å¤–ï¼Œ<code>catch</code>æ¨¡å—æ”¯æŒæ•è·ç‰¹æ®Šçš„å¼‚å¸¸åŸå› ï¼š</p>
<pre><code class="language-solidity">try externalContract.f() returns(returnType){
    // callæˆåŠŸçš„æƒ…å†µä¸‹ è¿è¡Œä¸€äº›ä»£ç 
} catch Error(string memory reason) {
    // æ•è·å¤±è´¥çš„ revert() å’Œ require()
} catch (bytes memory reason) {
    // æ•è·å¤±è´¥çš„ assert()
}
</code></pre>
<h4 id="try-catchå®æˆ˜"><code>try-catch</code>å®æˆ˜</h4>
<h5 id="onlyeven"><code>OnlyEven</code></h5>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤–éƒ¨åˆçº¦<code>OnlyEven</code>ï¼Œå¹¶ä½¿ç”¨<code>try-catch</code>æ¥å¤„ç†å¼‚å¸¸ï¼š</p>
<pre><code class="language-solidity">contract OnlyEven{
    constructor(uint a){
        require(a != 0, &quot;invalid number&quot;);
        assert(a != 1);
    }

    function onlyEven(uint256 b) external pure returns(bool success){
        // è¾“å…¥å¥‡æ•°æ—¶revert
        require(b % 2 == 0, &quot;Ups! Reverting&quot;);
        success = true;
    }
}
</code></pre>
<p><code>OnlyEven</code>åˆçº¦åŒ…å«ä¸€ä¸ªæ„é€ å‡½æ•°å’Œä¸€ä¸ª<code>onlyEven</code>å‡½æ•°ã€‚</p>
<ul>
<li>æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°<code>a</code>ï¼Œå½“<code>a=0</code>æ—¶ï¼Œ<code>require</code>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›å½“<code>a=1</code>æ—¶ï¼Œ<code>assert</code>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›å…¶ä»–æƒ…å†µå‡æ­£å¸¸ã€‚</li>
<li><code>onlyEven</code>å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°<code>b</code>ï¼Œå½“<code>b</code>ä¸ºå¥‡æ•°æ—¶ï¼Œ<code>require</code>ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<h5 id="å¤„ç†å¤–éƒ¨å‡½æ•°è°ƒç”¨å¼‚å¸¸">å¤„ç†å¤–éƒ¨å‡½æ•°è°ƒç”¨å¼‚å¸¸</h5>
<p>é¦–å…ˆï¼Œåœ¨<code>TryCatch</code>åˆçº¦ä¸­å®šä¹‰ä¸€äº›äº‹ä»¶å’ŒçŠ¶æ€å˜é‡ï¼š</p>
<pre><code class="language-solidity">// æˆåŠŸevent
event SuccessEvent();

// å¤±è´¥event
event CatchEvent(string message);
event CatchByte(bytes data);

// å£°æ˜OnlyEvenåˆçº¦å˜é‡
OnlyEven even;

constructor() {
	even = new OnlyEven(2);
}
</code></pre>
<p><code>SuccessEvent</code>æ˜¯è°ƒç”¨æˆåŠŸä¼šé‡Šæ”¾çš„äº‹ä»¶ï¼Œè€Œ<code>CatchEvent</code>å’Œ<code>CatchByte</code>æ˜¯æŠ›å‡ºå¼‚å¸¸æ—¶ä¼šé‡Šæ”¾çš„äº‹ä»¶ï¼Œåˆ†åˆ«å¯¹åº”<code>require/revert</code>å’Œ<code>assert</code>å¼‚å¸¸çš„æƒ…å†µã€‚<code>even</code>æ˜¯ä¸ª<code>OnlyEven</code>åˆçº¦ç±»å‹çš„çŠ¶æ€å˜é‡ã€‚</p>
<p>ç„¶åæˆ‘ä»¬åœ¨<code>execute</code>å‡½æ•°ä¸­ä½¿ç”¨<code>try-catch</code>å¤„ç†è°ƒç”¨å¤–éƒ¨å‡½æ•°<code>onlyEven</code>ä¸­çš„å¼‚å¸¸ï¼š</p>
<pre><code class="language-solidity">// åœ¨external callä¸­ä½¿ç”¨try-catch
function execute(uint amount) external returns (bool success) {
    try even.onlyEven(amount) returns(bool _success){
        // callæˆåŠŸçš„æƒ…å†µä¸‹
        emit SuccessEvent();
        return _success;
    } catch Error(string memory reason){
        // callä¸æˆåŠŸçš„æƒ…å†µä¸‹
        emit CatchEvent(reason);
    }
}
</code></pre>
<h5 id="åœ¨remixä¸ŠéªŒè¯-6">åœ¨remixä¸ŠéªŒè¯<a href="https://wtf.academy/solidity-advanced/TryCatch/#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81"></a></h5>
<p>å½“è¿è¡Œ<code>execute(0)</code>çš„æ—¶å€™ï¼Œå› ä¸º<code>0</code>ä¸ºå¶æ•°ï¼Œæ»¡è¶³<code>require(b % 2 == 0, &quot;Ups! Reverting&quot;);</code>ï¼Œæ²¡æœ‰å¼‚å¸¸æŠ›å‡ºï¼Œè°ƒç”¨æˆåŠŸå¹¶é‡Šæ”¾<code>SuccessEvent</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="97"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115200048618.png" alt="æˆåŠŸï¼Œé‡Šæ”¾successäº‹ä»¶" loading="lazy"></figure>
<p>å½“è¿è¡Œ<code>execute(1)</code>çš„æ—¶å€™ï¼Œå› ä¸º<code>1</code>ä¸ºå¥‡æ•°ï¼Œä¸æ»¡è¶³<code>require(b % 2 == 0, &quot;Ups! Reverting&quot;);</code>ï¼Œå¼‚å¸¸æŠ›å‡ºï¼Œè°ƒç”¨å¤±è´¥å¹¶é‡Šæ”¾<code>CatchEvent</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="98"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115200158797.png" alt="å¤±è´¥ï¼Œé‡Šæ”¾catcheventäº‹ä»¶" loading="lazy"></figure>
<h5 id="å¤„ç†åˆçº¦åˆ›å»ºå¼‚å¸¸">å¤„ç†åˆçº¦åˆ›å»ºå¼‚å¸¸</h5>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ©ç”¨<code>try-catch</code>æ¥å¤„ç†åˆçº¦åˆ›å»ºæ—¶çš„å¼‚å¸¸ã€‚åªéœ€è¦æŠŠ<code>try</code>æ¨¡å—æ”¹å†™ä¸º<code>OnlyEven</code>åˆçº¦çš„åˆ›å»ºå°±è¡Œï¼š</p>
<pre><code class="language-solidity">    // åœ¨åˆ›å»ºæ–°åˆçº¦ä¸­ä½¿ç”¨try-catch ï¼ˆåˆçº¦åˆ›å»ºè¢«è§†ä¸ºexternal callï¼‰
    // executeNew(0)ä¼šå¤±è´¥å¹¶é‡Šæ”¾`CatchEvent`
    // executeNew(1)ä¼šå¤±è´¥å¹¶é‡Šæ”¾`CatchByte`
    // executeNew(2)ä¼šæˆåŠŸå¹¶é‡Šæ”¾`SuccessEvent`
    function executeNew(uint a) external returns (bool success) {
        try new OnlyEven(a) returns(OnlyEven _even){
            // callæˆåŠŸçš„æƒ…å†µä¸‹
            emit SuccessEvent();
            success = _even.onlyEven(a);
        } catch Error(string memory reason) {
            // catchå¤±è´¥çš„ revert() å’Œ require()
            emit CatchEvent(reason);
        } catch (bytes memory reason) {
            // catchå¤±è´¥çš„ assert()
            emit CatchByte(reason);
        }
    }
</code></pre>
<h5 id="åœ¨remixä¸ŠéªŒè¯-7">åœ¨remixä¸ŠéªŒè¯</h5>
<p>å½“è¿è¡Œ<code>executeNew(0)</code>æ—¶ï¼Œå› ä¸º<code>0</code>ä¸æ»¡è¶³<code>require(a != 0, &quot;invalid number&quot;);</code>ï¼Œä¼šå¤±è´¥å¹¶é‡Šæ”¾<code>CatchEvent</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="99"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115200505157.png" alt="require ä¸æ»¡è¶³" loading="lazy"></figure>
<p>å½“è¿è¡Œ<code>executeNew(1)</code>æ—¶ï¼Œå› ä¸º<code>1</code>ä¸æ»¡è¶³<code>assert(a != 1);</code>ï¼Œä¼šå¤±è´¥å¹¶é‡Šæ”¾<code>CatchByte</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="100"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115200626634.png" alt="assert ä¸æ»¡è¶³" loading="lazy"></figure>
<p>å½“è¿è¡Œ<code>executeNew(2)</code>æ—¶ï¼Œå› ä¸º<code>2</code>æ»¡è¶³<code>require(a != 0, &quot;invalid number&quot;);</code>å’Œ<code>assert(a != 1);</code>ï¼Œä¼šæˆåŠŸå¹¶é‡Šæ”¾<code>SuccessEvent</code>äº‹ä»¶ã€‚</p>
<figure data-type="image" tabindex="101"><img src="https://raw.githubusercontent.com/CNZedChou/ForPicGo/master/image-20221115200724485.png" alt="æˆåŠŸé‡Šæ”¾success äº‹ä»¶" loading="lazy"></figure>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#solidity-study">Solidity Study</a>
<ul>
<li><a href="#solidity-%E5%B7%A5%E5%85%B7">Solidity å·¥å…·</a>
<ul>
<li><a href="#remix">Remix</a>
<ul>
<li><a href="#1-%E6%89%93%E5%BC%80remix">1. æ‰“å¼€remix</a></li>
<li><a href="#2-%E5%9B%BE%E6%A0%87%E9%9D%A2%E6%9D%BF">2. å›¾æ ‡é¢æ¿</a></li>
<li><a href="#3-%E9%83%A8%E7%BD%B2%E7%AE%80%E5%8D%95%E5%90%88%E7%BA%A6">3. éƒ¨ç½²ç®€å•åˆçº¦</a>
<ul>
<li><a href="#%E7%BC%96%E8%AF%91">ç¼–è¯‘</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2"><strong>éƒ¨ç½²</strong></a></li>
<li><a href="#%E8%B0%83%E7%94%A8">è°ƒç”¨</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#solidity-%E5%85%A5%E9%97%A8">Solidity å…¥é—¨</a>
<ul>
<li><a href="#1-helloweb3">1. HelloWeb3</a>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E4%B8%AAsolidity%E7%A8%8B%E5%BA%8F">ç¬¬ä¸€ä¸ªsolidityç¨‹åº</a></li>
<li><a href="#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%83%A8%E7%BD%B2%E4%BB%A3%E7%A0%81">ç¼–è¯‘å¹¶éƒ¨ç½²ä»£ç </a></li>
</ul>
</li>
<li><a href="#2-%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B">2. æ•°å€¼ç±»å‹</a>
<ul>
<li><a href="#solidity-%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B">solidity ä¸­çš„å˜é‡ç±»å‹</a></li>
<li><a href="#1-%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8Bvalue-type">1. æ•°å€¼ç±»å‹Value type</a>
<ul>
<li><a href="#1-%E5%B8%83%E5%B0%94%E5%9E%8B">1. å¸ƒå°”å‹</a></li>
<li><a href="#2-%E6%95%B4%E5%9E%8B">2. æ•´å‹</a></li>
<li><a href="#3-%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B">3. åœ°å€ç±»å‹</a></li>
<li><a href="#4-%E5%AE%9A%E9%95%BF%E5%AD%97%E8%8A%82%E6%95%B0%E7%BB%84">4. å®šé•¿å­—èŠ‚æ•°ç»„</a></li>
<li><a href="#5-%E6%9E%9A%E4%B8%BE-enum">5. æšä¸¾ enum</a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81">åœ¨remixä¸ŠéªŒè¯</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#3-%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B">3. å‡½æ•°ç±»å‹</a>
<ul>
<li><a href="#solidity%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0">Solidityä¸­çš„å‡½æ•°</a>
<ul>
<li><a href="#1-pure-vs-view">1. pure v.s. view</a></li>
<li><a href="#2-internal-vs-external">2. internal v.s. external</a></li>
<li><a href="#3-payable">3. payable</a></li>
</ul>
</li>
<li><a href="#%E6%80%BB%E7%BB%93-2">æ€»ç»“</a></li>
</ul>
</li>
<li><a href="#4-%E5%87%BD%E6%95%B0%E8%BE%93%E5%87%BA">4. å‡½æ•°è¾“å‡º</a>
<ul>
<li><a href="#%E8%BF%94%E5%9B%9E%E5%80%BC-return%E5%92%8Creturns">è¿”å›å€¼ returnå’Œreturns</a></li>
<li><a href="#%E5%91%BD%E5%90%8D%E5%BC%8F%E8%BF%94%E5%9B%9E">å‘½åå¼è¿”å›</a></li>
<li><a href="#%E8%A7%A3%E6%9E%84%E5%BC%8F%E8%B5%8B%E5%80%BC">è§£æ„å¼èµ‹å€¼</a></li>
</ul>
</li>
<li><a href="#5-%E5%8F%98%E9%87%8F%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%92%8C%E4%BD%9C%E7%94%A8%E5%9F%9F">5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ</a>
<ul>
<li><a href="#solidity%E4%B8%AD%E7%9A%84%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">Solidityä¸­çš„å¼•ç”¨ç±»å‹</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E4%BD%8D%E7%BD%AE">æ•°æ®ä½ç½®</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E4%BD%8D%E7%BD%AE%E5%92%8C%E8%B5%8B%E5%80%BC%E8%A7%84%E5%88%99">æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™</a></li>
<li><a href="#%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F">å˜é‡çš„ä½œç”¨åŸŸ</a>
<ul>
<li><a href="#1-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F">1. çŠ¶æ€å˜é‡</a></li>
<li><a href="#2-%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F">2. å±€éƒ¨å˜é‡</a></li>
<li><a href="#3-%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">3. å…¨å±€å˜é‡</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B">6. å¼•ç”¨ç±»å‹</a>
<ul>
<li><a href="#%E6%95%B0%E7%BB%84array">æ•°ç»„array</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E7%BB%84%E7%9A%84%E8%A7%84%E5%88%99">åˆ›å»ºæ•°ç»„çš„è§„åˆ™</a></li>
<li><a href="#%E6%95%B0%E7%BB%84%E6%88%90%E5%91%98">æ•°ç»„æˆå‘˜</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93struct">ç»“æ„ä½“struct</a></li>
</ul>
</li>
<li><a href="#7-%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B">7. æ˜ å°„ç±»å‹</a>
<ul>
<li><a href="#%E6%98%A0%E5%B0%84mapping">æ˜ å°„Mapping</a></li>
<li><a href="#%E6%98%A0%E5%B0%84%E7%9A%84%E8%A7%84%E5%88%99">æ˜ å°„çš„è§„åˆ™</a></li>
<li><a href="#%E6%98%A0%E5%B0%84%E7%9A%84%E5%8E%9F%E7%90%86">æ˜ å°„çš„åŸç†</a></li>
</ul>
</li>
<li><a href="#8-%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%80%BC">8. å˜é‡åˆå§‹å€¼</a>
<ul>
<li><a href="#%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%80%BC">å€¼ç±»å‹åˆå§‹å€¼</a></li>
<li><a href="#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%88%9D%E5%A7%8B%E5%80%BC">å¼•ç”¨ç±»å‹åˆå§‹å€¼</a></li>
<li><a href="#delete%E6%93%8D%E4%BD%9C%E7%AC%A6"><code>delete</code>æ“ä½œç¬¦</a></li>
</ul>
</li>
<li><a href="#9-%E5%B8%B8%E6%95%B0">9. å¸¸æ•°</a>
<ul>
<li><a href="#constant">constant</a></li>
<li><a href="#immutableimmutable-variables-cannot-have-a-non-value-type">immutableï¼ˆImmutable variables cannot have a non-value typeï¼‰</a></li>
</ul>
</li>
<li><a href="#10-%E6%8E%A7%E5%88%B6%E6%B5%81">10. æ§åˆ¶æµ</a>
<ul>
<li><a href="#%E6%8E%A7%E5%88%B6%E6%B5%81%E7%B1%BB%E5%9E%8B">æ§åˆ¶æµç±»å‹</a></li>
<li><a href="#%E7%94%A8solidity%E5%AE%9E%E7%8E%B0%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F">ç”¨solidityå®ç°æ’å…¥æ’åº</a>
<ul>
<li><a href="#python%E4%BB%A3%E7%A0%81"><code>python</code>ä»£ç </a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#11-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E4%BF%AE%E9%A5%B0%E5%99%A8">11. æ„é€ å‡½æ•°å’Œä¿®é¥°å™¨</a>
<ul>
<li><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0">æ„é€ å‡½æ•°</a></li>
<li><a href="#%E4%BF%AE%E9%A5%B0%E5%99%A8">ä¿®é¥°å™¨</a></li>
</ul>
</li>
<li><a href="#12-%E4%BA%8B%E4%BB%B6">12. äº‹ä»¶</a>
<ul>
<li><a href="#%E8%A7%84%E5%88%99">è§„åˆ™</a></li>
</ul>
</li>
<li><a href="#13-%E7%BB%A7%E6%89%BF">13. ç»§æ‰¿</a>
<ul>
<li><a href="#%E8%A7%84%E5%88%99-2">è§„åˆ™</a></li>
<li><a href="#%E7%AE%80%E5%8D%95%E7%BB%A7%E6%89%BF">ç®€å•ç»§æ‰¿</a></li>
<li><a href="#%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF">å¤šé‡ç»§æ‰¿</a></li>
<li><a href="#%E4%BF%AE%E9%A5%B0%E5%99%A8%E7%9A%84%E7%BB%A7%E6%89%BF">ä¿®é¥°å™¨çš„ç»§æ‰¿</a></li>
<li><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E7%BB%A7%E6%89%BF">æ„é€ å‡½æ•°çš„ç»§æ‰¿</a></li>
<li><a href="#%E8%B0%83%E7%94%A8%E7%88%B6%E5%90%88%E7%BA%A6%E7%9A%84%E5%87%BD%E6%95%B0">è°ƒç”¨çˆ¶åˆçº¦çš„å‡½æ•°</a></li>
</ul>
</li>
<li><a href="#14-%E6%8A%BD%E8%B1%A1%E5%90%88%E7%BA%A6%E4%B8%8E%E6%8E%A5%E5%8F%A3">14. æŠ½è±¡åˆçº¦ä¸æ¥å£</a>
<ul>
<li><a href="#%E6%8A%BD%E8%B1%A1%E5%90%88%E7%BA%A6">æŠ½è±¡åˆçº¦</a></li>
<li><a href="#%E6%8E%A5%E5%8F%A3">æ¥å£</a>
<ul>
<li><a href="#ierc721%E4%BA%8B%E4%BB%B6">IERC721äº‹ä»¶</a></li>
<li><a href="#ierc721%E5%87%BD%E6%95%B0">IERC721å‡½æ•°</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£ï¼Ÿ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#15-%E5%BC%82%E5%B8%B8">15. å¼‚å¸¸</a>
<ul>
<li><a href="#error">Error</a></li>
<li><a href="#require">Require</a></li>
<li><a href="#assert">Assert</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#solidity-%E8%BF%9B%E9%98%B6">Solidity è¿›é˜¶</a>
<ul>
<li><a href="#16-%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD">16. å‡½æ•°é‡è½½</a>
<ul>
<li><a href="#%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD">å‡½æ•°é‡è½½</a></li>
<li><a href="#%E5%AE%9E%E5%8F%82%E5%8C%B9%E9%85%8Dargument-matching08-%E5%90%8E-%E5%B7%B2%E4%BF%AE%E5%A4%8D">å®å‚åŒ¹é…ï¼ˆArgument Matchingï¼‰ï¼ˆ0.8 å å·²ä¿®å¤ï¼Ÿï¼‰</a></li>
</ul>
</li>
<li><a href="#17-%E5%BA%93%E5%90%88%E7%BA%A6">17. åº“åˆçº¦</a>
<ul>
<li><a href="#%E5%BA%93%E5%87%BD%E6%95%B0">åº“å‡½æ•°</a></li>
<li><a href="#string%E5%BA%93%E5%90%88%E7%BA%A6">Stringåº“åˆçº¦</a></li>
</ul>
</li>
<li><a href="#18-import">18. Import</a>
<ul>
<li><a href="#import%E7%94%A8%E6%B3%95"><code>import</code>ç”¨æ³•</a></li>
</ul>
</li>
<li><a href="#19-%E6%8E%A5%E5%8F%97eth">19. æ¥å—ETH</a>
<ul>
<li><a href="#%E6%8E%A5%E6%94%B6eth%E5%87%BD%E6%95%B0-receive">æ¥æ”¶ETHå‡½æ•° receive</a></li>
<li><a href="#%E5%9B%9E%E9%80%80%E5%87%BD%E6%95%B0-fallback">å›é€€å‡½æ•° fallback</a></li>
<li><a href="#receive%E5%92%8Cfallback%E7%9A%84%E5%8C%BA%E5%88%AB">receiveå’Œfallbackçš„åŒºåˆ«</a></li>
<li><a href="#remix-%E6%BC%94%E7%A4%BA">remix æ¼”ç¤º</a></li>
</ul>
</li>
<li><a href="#20-%E5%8F%91%E9%80%81eth">20. å‘é€ETH</a>
<ul>
<li><a href="#transfer">transfer</a></li>
<li><a href="#send">send</a></li>
<li><a href="#call">call</a></li>
</ul>
</li>
<li><a href="#21-%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%90%88%E7%BA%A6">21. è°ƒç”¨å…¶ä»–åˆçº¦</a>
<ul>
<li><a href="#%E7%9B%AE%E6%A0%87%E5%90%88%E7%BA%A6">ç›®æ ‡åˆçº¦</a></li>
<li><a href="#%E8%B0%83%E7%94%A8othercontract%E5%90%88%E7%BA%A6">è°ƒç”¨OtherContractåˆçº¦</a>
<ul>
<li><a href="#1-%E4%BC%A0%E5%85%A5%E5%90%88%E7%BA%A6%E5%9C%B0%E5%9D%80">1. ä¼ å…¥åˆçº¦åœ°å€</a></li>
<li><a href="#2-%E4%BC%A0%E5%85%A5%E5%90%88%E7%BA%A6%E5%8F%98%E9%87%8F">2. ä¼ å…¥åˆçº¦å˜é‡</a></li>
<li><a href="#3-%E5%88%9B%E5%BB%BA%E5%90%88%E7%BA%A6%E5%8F%98%E9%87%8F">3. åˆ›å»ºåˆçº¦å˜é‡</a></li>
<li><a href="#4-%E8%B0%83%E7%94%A8%E5%90%88%E7%BA%A6%E5%B9%B6%E5%8F%91%E9%80%81eth">4. è°ƒç”¨åˆçº¦å¹¶å‘é€<code>ETH</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#22-call">22. Call</a>
<ul>
<li><a href="#call%E7%9A%84%E4%BD%BF%E7%94%A8%E8%A7%84%E5%88%99"><code>call</code>çš„ä½¿ç”¨è§„åˆ™</a></li>
<li><a href="#%E7%9B%AE%E6%A0%87%E5%90%88%E7%BA%A6-2">ç›®æ ‡åˆçº¦</a></li>
<li><a href="#%E5%88%A9%E7%94%A8call%E8%B0%83%E7%94%A8%E7%9B%AE%E6%A0%87%E5%90%88%E7%BA%A6">åˆ©ç”¨<code>call</code>è°ƒç”¨ç›®æ ‡åˆçº¦</a></li>
</ul>
</li>
<li><a href="#23-delegatecall">23. Delegatecall</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E7%94%A8%E5%88%B0delegatecall">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”¨åˆ°<code>delegatecall</code>?</a></li>
<li><a href="#delegatecall%E4%BE%8B%E5%AD%90"><code>delegatecall</code>ä¾‹å­</a>
<ul>
<li><a href="#%E8%A2%AB%E8%B0%83%E7%94%A8%E7%9A%84%E5%90%88%E7%BA%A6c">è¢«è°ƒç”¨çš„åˆçº¦C</a></li>
<li><a href="#%E5%8F%91%E8%B5%B7%E8%B0%83%E7%94%A8%E7%9A%84%E5%90%88%E7%BA%A6b">å‘èµ·è°ƒç”¨çš„åˆçº¦B</a></li>
<li><a href="#remix-%E9%AA%8C%E8%AF%81">remix éªŒè¯</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#24-create">24. Create</a>
<ul>
<li><a href="#create%E5%92%8Ccreate2"><code>create</code>å’Œ<code>create2</code></a></li>
<li><a href="#%E6%9E%81%E7%AE%80uniswap">æç®€Uniswap</a></li>
<li><a href="#pair%E5%90%88%E7%BA%A6"><code>Pair</code>åˆçº¦</a></li>
<li><a href="#pairfactory"><code>PairFactory</code></a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-2">åœ¨remixä¸ŠéªŒè¯</a></li>
</ul>
</li>
<li><a href="#25-create2">25. Create2</a>
<ul>
<li><a href="#create%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E5%9C%B0%E5%9D%80">CREATEå¦‚ä½•è®¡ç®—åœ°å€</a></li>
<li><a href="#create2%E5%A6%82%E4%BD%95%E8%AE%A1%E7%AE%97%E5%9C%B0%E5%9D%80">CREATE2å¦‚ä½•è®¡ç®—åœ°å€</a></li>
<li><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8create2">å¦‚ä½•ä½¿ç”¨<code>CREATE2</code></a>
<ul>
<li><a href="#%E6%9E%81%E7%AE%80uniswap2">æç®€Uniswap2</a></li>
<li><a href="#pair"><code>Pair</code></a></li>
<li><a href="#pairfactory2"><code>PairFactory2</code></a></li>
<li><a href="#%E4%BA%8B%E5%85%88%E8%AE%A1%E7%AE%97pair%E5%9C%B0%E5%9D%80">äº‹å…ˆè®¡ç®—<code>Pair</code>åœ°å€</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-3">åœ¨remixä¸ŠéªŒè¯</a></li>
<li><a href="#create2%E7%9A%84%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">create2çš„å®é™…åº”ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#26-%E5%88%A0%E9%99%A4%E5%90%88%E7%BA%A6">26. åˆ é™¤åˆçº¦</a>
<ul>
<li><a href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8selfdestruct">å¦‚ä½•ä½¿ç”¨<code>selfdestruct</code></a></li>
<li><a href="#%E4%BE%8B%E5%AD%90">ä¾‹å­</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">æ³¨æ„äº‹é¡¹</a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-4">åœ¨remixä¸ŠéªŒè¯</a></li>
</ul>
</li>
<li><a href="#27-abi-%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81">27. ABI ç¼–ç è§£ç </a>
<ul>
<li><a href="#abi%E7%BC%96%E7%A0%81">ABIç¼–ç </a>
<ul>
<li><a href="#abiencode"><code>abi.encode</code></a></li>
<li><a href="#abiencodepacked"><code>abi.encodePacked</code></a></li>
<li><a href="#abiencodewithsignature"><code>abi.encodeWithSignature</code></a></li>
<li><a href="#abiencodewithselector"><code>abi.encodeWithSelector</code></a></li>
</ul>
</li>
<li><a href="#abi%E8%A7%A3%E7%A0%81">ABIè§£ç </a>
<ul>
<li><a href="#abidecode"><code>abi.decode</code></a></li>
</ul>
</li>
<li><a href="#abi%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">ABIçš„ä½¿ç”¨åœºæ™¯</a></li>
</ul>
</li>
<li><a href="#28-hash">28. Hash</a>
<ul>
<li><a href="#hash%E7%9A%84%E6%80%A7%E8%B4%A8">Hashçš„æ€§è´¨</a></li>
<li><a href="#hash%E7%9A%84%E5%BA%94%E7%94%A8">Hashçš„åº”ç”¨</a></li>
<li><a href="#keccak256">Keccak256</a></li>
<li><a href="#keccak256%E5%92%8Csha3">Keccak256å’Œsha3</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86">ç”Ÿæˆæ•°æ®å”¯ä¸€æ ‡è¯†</a></li>
<li><a href="#%E5%BC%B1%E6%8A%97%E7%A2%B0%E6%92%9E%E6%80%A7">å¼±æŠ—ç¢°æ’æ€§</a></li>
<li><a href="#%E5%BC%BA%E6%8A%97%E7%A2%B0%E6%92%9E%E6%80%A7">å¼ºæŠ—ç¢°æ’æ€§</a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-5">åœ¨remixä¸ŠéªŒè¯</a></li>
</ul>
</li>
<li><a href="#29-%E9%80%89%E6%8B%A9%E5%99%A8">29. é€‰æ‹©å™¨</a>
<ul>
<li><a href="#msgdata"><code>msg.data</code></a></li>
<li><a href="#method-id-selector%E5%92%8C%E5%87%BD%E6%95%B0%E7%AD%BE%E5%90%8D"><code>method id</code>ã€<code>selector</code>å’Œ<code>å‡½æ•°ç­¾å</code></a></li>
<li><a href="#%E4%BD%BF%E7%94%A8selector">ä½¿ç”¨<code>selector</code></a></li>
</ul>
</li>
<li><a href="#30-try-catch">30. try-catch</a>
<ul>
<li><a href="#try-catch%E5%AE%9E%E6%88%98"><code>try-catch</code>å®æˆ˜</a>
<ul>
<li><a href="#onlyeven"><code>OnlyEven</code></a></li>
<li><a href="#%E5%A4%84%E7%90%86%E5%A4%96%E9%83%A8%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E5%BC%82%E5%B8%B8">å¤„ç†å¤–éƒ¨å‡½æ•°è°ƒç”¨å¼‚å¸¸</a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-6">åœ¨remixä¸ŠéªŒè¯</a></li>
<li><a href="#%E5%A4%84%E7%90%86%E5%90%88%E7%BA%A6%E5%88%9B%E5%BB%BA%E5%BC%82%E5%B8%B8">å¤„ç†åˆçº¦åˆ›å»ºå¼‚å¸¸</a></li>
<li><a href="#%E5%9C%A8remix%E4%B8%8A%E9%AA%8C%E8%AF%81-7">åœ¨remixä¸ŠéªŒè¯</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank"> Gridea </a>
  <a class="rss" href="https://CNZedChou.github.io/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
